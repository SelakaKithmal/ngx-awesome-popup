import { ButtonLayoutDisplay } from './enums';
export var GlobalClass;
(function (GlobalClass) {
    class Message {
        constructor() {
            this.Title = null;
            this.Description = null;
        }
    }
    GlobalClass.Message = Message;
    class ButtonMaker {
        constructor(Label, ID, LayoutType = ButtonLayoutDisplay.PRIMARY) {
            this.Label = Label;
            this.ID = ID;
            this.LayoutType = LayoutType;
        }
    }
    GlobalClass.ButtonMaker = ButtonMaker;
    class GlobalConfig {
        constructor() {
            this.DisplayColor = new GlobalClass.DisplayColor();
        }
    }
    GlobalClass.GlobalConfig = GlobalConfig;
    class DisplayColor {
        constructor() {
            this.Primary = null;
            this.Secondary = null;
            this.Success = null;
            this.Info = null;
            this.Warning = null;
            this.Danger = null;
            this.Light = null;
            this.Dark = null;
        }
    }
    GlobalClass.DisplayColor = DisplayColor;
    class ColorProvider {
        constructor(_Color) {
            this.Base = null;
            this.Brighten = null;
            this.BrightenForShade = null;
            this.Darken = null;
            this.DarkenForShade = null;
            this.ContrastColor = null;
            this.TransparentDarkenVariance = null;
            this.BrightShade = null;
            this.IsBaseBright = null;
            if (this.Base = this.isColor(_Color)) {
                this.Brighten = this.brightness(this.Base, 'brighten', 20);
                this.BrightenForShade = this.brightness(this.Base, 'brighten', 10);
                this.Darken = this.brightness(this.Base, 'darken', 20);
                this.DarkenForShade = this.brightness(this.Base, 'darken', 10);
                const luminance = Math.floor(this.luminance(this.Base) * 100);
                const darken = luminance > 50 ? 5 : (luminance > 40 ? 10 : (luminance > 20 ? 15 : luminance));
                const brighten = luminance > 55 ? 65 : (luminance > 45 ? 60 : (luminance > 20 ? 55 : (luminance > 10 ? 45 : 80)));
                this.BrightShade = this.brightness(this.brightness(this.Base, 'darken', darken), 'brighten', brighten);
                this.TransparentDarkenVariance = this.brightness(this.transparentize(this.Base, 80), 'darken', 40);
                if (this.isBright(this.Base)) {
                    this.ContrastColor = 'rgb(52, 58, 64)';
                    this.IsBaseBright = true;
                }
                else {
                    this.ContrastColor = 'rgb(255,255,255)';
                    this.IsBaseBright = false;
                }
                /*         console.log('%c Color ', `background: ${this.BrightShade}; color: ${this.ContrastColor}`, luminance, darken, brighten);
                           console.log('%c Brighten ', `background: ${this.Brighten}; color: ${this.ContrastColor}`, this.Brighten);
                           console.log('%c BrightenForShade ', `background: ${this.BrightenForShade}; color: ${this.ContrastColor}`, this.BrightenForShade);
                           console.log('%c Darken ', `background: ${this.Darken}; color: ${this.ContrastColor}`, this.Darken);
                           console.log('%c DarkenForShade ', `background: ${this.DarkenForShade}; color: ${this.ContrastColor}`, this.DarkenForShade);*/
            }
        }
        isBright(_Rgb) {
            return this.contrast(this.luminance(_Rgb));
        }
        brightness(_Rgb, _Action, _Percentage) {
            const rgbIntArray = this.getRGBArray(_Rgb);
            const [lowest, middle, highest] = this.getLowMidHi(rgbIntArray);
            if (_Action === 'brighten' && lowest.val === 255) {
                return _Rgb;
            }
            if (_Action === 'darken' && highest.val === 0) {
                return _Rgb;
            }
            const amount = _Percentage / 100 * 255;
            let returnList = [];
            if (_Action === 'brighten') {
                returnList[lowest.index] = Math.round(lowest.val + (Math.min(255 - lowest.val, amount)));
                const increaseFraction = (returnList[lowest.index] - lowest.val) / (255 - lowest.val);
                returnList[middle.index] = middle.val + (255 - middle.val) * increaseFraction;
                returnList[highest.index] = highest.val + (255 - highest.val) * increaseFraction;
            }
            if (_Action === 'darken') {
                returnList[highest.index] = highest.val - (Math.min(highest.val, amount));
                const decreaseFraction = (highest.val - returnList[highest.index]) / (highest.val);
                returnList[middle.index] = middle.val - middle.val * decreaseFraction;
                returnList[lowest.index] = lowest.val - lowest.val * decreaseFraction;
            }
            returnList = returnList.map(item => Math.round(item));
            if (rgbIntArray.length > 3) {
                returnList.push(rgbIntArray[3]);
                return (`rgba(${returnList.join()})`);
            }
            return (`rgb(${returnList.join()})`);
        }
        getLowMidHi(_RgbArray) {
            const rgbArrayCopy = _RgbArray.slice();
            const rgbArrayWithoutAlpha = _RgbArray.length > 3 ? rgbArrayCopy.reverse().slice(1).reverse() : _RgbArray;
            let highest = { val: -1, index: -1 };
            let lowest = { val: Infinity, index: -1 };
            rgbArrayWithoutAlpha.map((val, index) => {
                if (val > highest.val) {
                    highest = { val: val, index: index };
                }
                if (val < lowest.val) {
                    lowest = { val: val, index: index };
                }
            });
            if (lowest.index === highest.index) {
                lowest.index = highest.index + 1;
            }
            const middleIndex = (3 - highest.index - lowest.index);
            let middle = { val: rgbArrayWithoutAlpha[middleIndex], index: middleIndex };
            return [lowest, middle, highest];
        }
        contrast(_Luminance) {
            const brightest = Math.max(1.05, _Luminance + 0.05);
            const darkest = Math.min(1.05, _Luminance + 0.05);
            const contrast = (brightest) / (darkest);
            return contrast < 3;
        }
        isColor(_StrColor) {
            const CSSDeclaration = new Option().style;
            CSSDeclaration.color = _StrColor;
            return !!CSSDeclaration.color ? CSSDeclaration.color : null;
        }
        getRGBArray(_Rgb) {
            return _Rgb.replace(/^(rgb|rgba)\(/, '').replace(/\)$/, '').replace(/\s/g, '').split(',').map(x => +x);
        }
        luminance(_Rgb) {
            const rgbIntArray = this.getRGBArray(_Rgb);
            const W3algorithm = rgbIntArray.map(item => {
                item /= 255;
                return item <= 0.03928
                    ? item / 12.92
                    : Math.pow((item + 0.055) / 1.055, 2.4);
            });
            return W3algorithm[0] * 0.2126 + W3algorithm[1] * 0.7152 + W3algorithm[2] * 0.0722;
        }
        transparentize(_Rgb, _Percentage) {
            const baseArray = this.Base.replace(/^(rgb|rgba)\(/, '').replace(/\)$/, '').replace(/\s/g, '').split(',').map(x => +x);
            if (baseArray.length > 3) {
                baseArray.pop();
            }
            const amount = (100 - _Percentage) / 100;
            baseArray.push(amount);
            return (`rgb(${baseArray.join()})`);
        }
    }
    GlobalClass.ColorProvider = ColorProvider;
    class DataControl {
        /**
         * @ignore
         */
        copyValuesFrom(_Data, _DestinationObject) {
            if (typeof _Data !== 'object') {
                return _DestinationObject;
            }
            const dataKeys = Object.keys(_Data);
            const destinationObjectKeys = Object.keys(_DestinationObject);
            dataKeys.forEach(key => {
                if (destinationObjectKeys.find(tKey => tKey === key || tKey === '_' + key)) {
                    if (key.includes('Date')) {
                        const date = Date.parse(_Data[key]);
                        if (date) {
                            _DestinationObject[key] = new Date(date);
                        }
                        else {
                            if (_Data[key] !== null) {
                                _DestinationObject[key] = _Data[key];
                            }
                        }
                    }
                    else {
                        if (_Data[key] !== null) {
                            _DestinationObject[key] = _Data[key];
                        }
                    }
                }
            });
            return _DestinationObject;
        }
    }
    GlobalClass.DataControl = DataControl;
})(GlobalClass || (GlobalClass = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2xvYmFsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vbmd4LWF3ZXNvbWUtcG9wdXAvY29yZS9nbG9iYWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLG1CQUFtQixFQUFDLE1BQU0sU0FBUyxDQUFDO0FBbUc1QyxNQUFNLEtBQVcsV0FBVyxDQW1OM0I7QUFuTkQsV0FBaUIsV0FBVztJQUV4QixNQUFhLE9BQU87UUFBcEI7WUFDSSxVQUFLLEdBQWlCLElBQUksQ0FBQztZQUMzQixnQkFBVyxHQUFXLElBQUksQ0FBQztRQUMvQixDQUFDO0tBQUE7SUFIWSxtQkFBTyxVQUduQixDQUFBO0lBRUQsTUFBYSxXQUFXO1FBRXBCLFlBQW1CLEtBQWEsRUFBUyxFQUFVLEVBQVMsYUFBa0MsbUJBQW1CLENBQUMsT0FBTztZQUF0RyxVQUFLLEdBQUwsS0FBSyxDQUFRO1lBQVMsT0FBRSxHQUFGLEVBQUUsQ0FBUTtZQUFTLGVBQVUsR0FBVixVQUFVLENBQW1EO1FBQ3pILENBQUM7S0FDSjtJQUpZLHVCQUFXLGNBSXZCLENBQUE7SUFFRCxNQUFhLFlBQVk7UUFBekI7WUFDSSxpQkFBWSxHQUFpQyxJQUFJLFdBQVcsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNoRixDQUFDO0tBQUE7SUFGWSx3QkFBWSxlQUV4QixDQUFBO0lBRUQsTUFBYSxZQUFZO1FBQXpCO1lBQ0ksWUFBTyxHQUFvQixJQUFJLENBQUM7WUFDaEMsY0FBUyxHQUFrQixJQUFJLENBQUM7WUFDaEMsWUFBTyxHQUFvQixJQUFJLENBQUM7WUFDaEMsU0FBSSxHQUF1QixJQUFJLENBQUM7WUFDaEMsWUFBTyxHQUFvQixJQUFJLENBQUM7WUFDaEMsV0FBTSxHQUFxQixJQUFJLENBQUM7WUFDaEMsVUFBSyxHQUFzQixJQUFJLENBQUM7WUFDaEMsU0FBSSxHQUF1QixJQUFJLENBQUM7UUFDcEMsQ0FBQztLQUFBO0lBVFksd0JBQVksZUFTeEIsQ0FBQTtJQUVE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SyxJQUFJLEVBQUU7NEJBQ3JCLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQzt5QkFDeEM7cUJBRUo7aUJBQ0o7WUFDTCxDQUFDLENBQUMsQ0FBQztZQUVILE9BQU8sa0JBQWtCLENBQUM7UUFDOUIsQ0FBQztLQUNKO0lBckNZLHVCQUFXLGNBcUN2QixDQUFBO0FBQ0wsQ0FBQyxFQW5OZ0IsV0FBVyxLQUFYLFdBQVcsUUFtTjNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtCdXR0b25MYXlvdXREaXNwbGF5fSBmcm9tICcuL2VudW1zJztcblxuZXhwb3J0IG5hbWVzcGFjZSBHbG9iYWxJbnRlcmZhY2Uge1xuICAgIFxuICAgIC8qKlxuICAgICAqIEVhY2ggcHJvcGVydHkgb2Yge0BsaW5rIENvbG9yTGlzdH0gcmVwcmVzZW50IGEgc3RyaW5nIHdoaWNoIHJlcHJlc2VudCBhIGNvbG9yIGluIGhleCBvciByZ2IvcmdiYSBmb3JtYXQuXG4gICAgICogRm9yIGF2YWlsYWJsZSBjb2xvciB0eXBlcyhwcm9wZXJ0aWVzKSBjaGVjayB7QGxpbmsgSUNvbG9yVHlwZXN9IGludGVyZmFjZS5cbiAgICAgKiBFdmVyeSBjb2xvciBpcyBvcHRpb25hbCwgYW5kIGl0IHdpbGwgcmVmbGVjdCBvbiBkaWFsb2cgb3IgYnV0dG9uIGNvbG9yIHR5cGVzIGFuZCBpdHMgY29sb3IgY29udHJhc3Qgb3IgdmFyaWFuY2UuXG4gICAgICogICogYGBgdHlwZXNjcmlwdFxuICAgICAqIC8vIENvbG9yTGlzdCBvYmplY3QgZXhhbXBsZS5cbiAgICAgKiBjb25zdCBjb2xvckxpc3QgPSB7XG4gICAgICogICAgICAgICBDb2xvckxpc3Q6IHtcbiAgICAgKiAgICAgICAgICAgIFByaW1hcnkgIDogJyNmZjllMDAnLFxuICAgICAqICAgICAgICAgICAgU2Vjb25kYXJ5OiAnIzk4OWVhNScsXG4gICAgICogICAgICAgICAgICBJbmZvICAgICA6ICcjMmY4ZWU1JyxcbiAgICAgKiAgICAgICAgICAgIFN1Y2Nlc3MgIDogJyMzY2FlYTMnLFxuICAgICAqICAgICAgICAgICAgV2FybmluZyAgOiAnI2ZmYzEwNycsXG4gICAgICogICAgICAgICAgICBEYW5nZXIgICA6ICcjZTQ2NDY0JyxcbiAgICAgKiAgICAgICAgICAgIExpZ2h0ICAgIDogJyNmYmZiZmInLFxuICAgICAqICAgICAgICAgICAgRGFyayAgICAgOiAnIzM0M2E0MCdcbiAgICAgKiAgICAgICAgICAgfVxuICAgICAqICAgICAgICB9XG4gICAgICogYGBgXG4gICAgICovXG4gICAgZXhwb3J0IGludGVyZmFjZSBJR2xvYmFsVXNlckNvbmZpZyB7XG4gICAgICAgIENvbG9yTGlzdD86IEdsb2JhbEludGVyZmFjZS5JQ29sb3JUeXBlcztcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGludGVyZmFjZSBJR2xvYmFsQ29uZmlnIHtcbiAgICAgICAgRGlzcGxheUNvbG9yPzogR2xvYmFsSW50ZXJmYWNlLklDb2xvck9iamVjdDtcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGludGVyZmFjZSBJQ29sb3JUeXBlcyB7XG4gICAgICAgIFByaW1hcnk/OiBzdHJpbmc7XG4gICAgICAgIFNlY29uZGFyeT86IHN0cmluZztcbiAgICAgICAgU3VjY2Vzcz86IHN0cmluZztcbiAgICAgICAgSW5mbz86IHN0cmluZztcbiAgICAgICAgV2FybmluZz86IHN0cmluZztcbiAgICAgICAgRGFuZ2VyPzogc3RyaW5nO1xuICAgICAgICBMaWdodD86IHN0cmluZztcbiAgICAgICAgRGFyaz86IHN0cmluZztcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGludGVyZmFjZSBJUHJpdmF0ZVJlc3BvbnNlIHtcbiAgICAgICAgXG4gICAgICAgIHNldEJlbG9uZ2luZyhfRGlhbG9nQmVsb25naW5nKTogdm9pZFxuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBJbnRlcmZhY2UgZm9yIGN1c3RvbSBidXR0b24uXG4gICAgICpcbiAgICAgKiBFeGFtcGxlOlxuICAgICAqIGBgYHR5cGVzY3JpcHRcbiAgICAgKiAvLyBDdXN0b20gYnV0dG9uIG9iamVjdC5cbiAgICAgKiBjb25zdCBidXR0b24gPSB7XG4gICAgICogICAgICAgIElEICAgICAgICAgOiAnY29uZmlybV9idG4nLFxuICAgICAqICAgICAgICBMYWJlbDogICAgIDogJ0NvbmZpcm0nXG4gICAgICogICAgICAgIExheW91dFR5cGUgOiBCdXR0b25MYXlvdXREaXNwbGF5LlNVQ0NFU1NcbiAgICAgKiAgfVxuICAgICAqIC8vIE9yIGluc3RhbnRpYXRlZCB3aXRoIEJ1dHRvbk1ha2VyIGNsYXNzXG4gICAgICogY29uc3QgYnV0dG9uMiA9IG5ldyBCdXR0b25NYWtlcignQ29uZmlybScsICdjb25maXJtX2J0bicsIEJ1dHRvbkxheW91dERpc3BsYXkuU1VDQ0VTUylcbiAgICAgKiBgYGBcbiAgICAgKiAqIEJ1dHRvbkxheW91dERpc3BsYXk6IHtAbGluayBCdXR0b25MYXlvdXREaXNwbGF5fVxuICAgICAqL1xuICAgIGV4cG9ydCBpbnRlcmZhY2UgSUJ1dHRvbiB7XG4gICAgICAgIExhYmVsOiBzdHJpbmc7XG4gICAgICAgIExheW91dFR5cGU6IEJ1dHRvbkxheW91dERpc3BsYXkgfCBudWxsO1xuICAgICAgICBJRD86IHN0cmluZztcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGludGVyZmFjZSBJQ29sb3JPYmplY3Qge1xuICAgICAgICBQcmltYXJ5PzogR2xvYmFsSW50ZXJmYWNlLklDb2xvclByb3ZpZGVyO1xuICAgICAgICBTZWNvbmRhcnk/OiBHbG9iYWxJbnRlcmZhY2UuSUNvbG9yUHJvdmlkZXI7XG4gICAgICAgIFN1Y2Nlc3M/OiBHbG9iYWxJbnRlcmZhY2UuSUNvbG9yUHJvdmlkZXI7XG4gICAgICAgIEluZm8/OiBHbG9iYWxJbnRlcmZhY2UuSUNvbG9yUHJvdmlkZXI7XG4gICAgICAgIFdhcm5pbmc/OiBHbG9iYWxJbnRlcmZhY2UuSUNvbG9yUHJvdmlkZXI7XG4gICAgICAgIERhbmdlcj86IEdsb2JhbEludGVyZmFjZS5JQ29sb3JQcm92aWRlcjtcbiAgICAgICAgTGlnaHQ/OiBHbG9iYWxJbnRlcmZhY2UuSUNvbG9yUHJvdmlkZXI7XG4gICAgICAgIERhcms/OiBHbG9iYWxJbnRlcmZhY2UuSUNvbG9yUHJvdmlkZXI7XG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSUNvbG9yUHJvdmlkZXIge1xuICAgICAgICBcbiAgICAgICAgQmFzZTogc3RyaW5nO1xuICAgICAgICBCcmlnaHRlbjogc3RyaW5nO1xuICAgICAgICBCcmlnaHRlbkZvclNoYWRlOiBzdHJpbmc7XG4gICAgICAgIERhcmtlbjogc3RyaW5nO1xuICAgICAgICBEYXJrZW5Gb3JTaGFkZTogc3RyaW5nO1xuICAgICAgICBDb250cmFzdENvbG9yOiBzdHJpbmc7XG4gICAgICAgIEJyaWdodFNoYWRlOiBzdHJpbmc7XG4gICAgICAgIFRyYW5zcGFyZW50RGFya2VuVmFyaWFuY2U6IHN0cmluZztcbiAgICAgICAgSXNCYXNlQnJpZ2h0OiBib29sZWFuO1xuICAgIH1cbiAgICBleHBvcnQgaW50ZXJmYWNlIElNZXNzYWdlIHtcbiAgICAgICAgVGl0bGU6IHN0cmluZztcbiAgICAgICAgRGVzY3JpcHRpb246IHN0cmluZztcbiAgICB9XG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgR2xvYmFsQ2xhc3Mge1xuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBNZXNzYWdlIHtcbiAgICAgICAgVGl0bGU6IHN0cmluZyAgICAgICA9IG51bGw7XG4gICAgICAgIERlc2NyaXB0aW9uOiBzdHJpbmcgPSBudWxsO1xuICAgIH1cbiAgICBcbiAgICBleHBvcnQgY2xhc3MgQnV0dG9uTWFrZXIgaW1wbGVtZW50cyBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbiB7XG4gICAgICAgIFxuICAgICAgICBjb25zdHJ1Y3RvcihwdWJsaWMgTGFiZWw6IHN0cmluZywgcHVibGljIElEOiBzdHJpbmcsIHB1YmxpYyBMYXlvdXRUeXBlOiBCdXR0b25MYXlvdXREaXNwbGF5ID0gQnV0dG9uTGF5b3V0RGlzcGxheS5QUklNQVJZKSB7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGNsYXNzIEdsb2JhbENvbmZpZyBpbXBsZW1lbnRzIEdsb2JhbEludGVyZmFjZS5JR2xvYmFsQ29uZmlnIHtcbiAgICAgICAgRGlzcGxheUNvbG9yOiBHbG9iYWxJbnRlcmZhY2UuSUNvbG9yT2JqZWN0ID0gbmV3IEdsb2JhbENsYXNzLkRpc3BsYXlDb2xvcigpO1xuICAgIH1cbiAgICBcbiAgICBleHBvcnQgY2xhc3MgRGlzcGxheUNvbG9yIGltcGxlbWVudHMgR2xvYmFsSW50ZXJmYWNlLklDb2xvck9iamVjdCB7XG4gICAgICAgIFByaW1hcnk6IENvbG9yUHJvdmlkZXIgICA9IG51bGw7XG4gICAgICAgIFNlY29uZGFyeTogQ29sb3JQcm92aWRlciA9IG51bGw7XG4gICAgICAgIFN1Y2Nlc3M6IENvbG9yUHJvdmlkZXIgICA9IG51bGw7XG4gICAgICAgIEluZm86IENvbG9yUHJvdmlkZXIgICAgICA9IG51bGw7XG4gICAgICAgIFdhcm5pbmc6IENvbG9yUHJvdmlkZXIgICA9IG51bGw7XG4gICAgICAgIERhbmdlcjogQ29sb3JQcm92aWRlciAgICA9IG51bGw7XG4gICAgICAgIExpZ2h0OiBDb2xvclByb3ZpZGVyICAgICA9IG51bGw7XG4gICAgICAgIERhcms6IENvbG9yUHJvdmlkZXIgICAgICA9IG51bGw7XG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBDb2xvclByb3ZpZGVyIHtcbiAgICAgICAgXG4gICAgICAgIEJhc2U6IHN0cmluZyAgICAgICAgICAgICAgICAgICAgICA9IG51bGw7XG4gICAgICAgIEJyaWdodGVuOiBzdHJpbmcgICAgICAgICAgICAgICAgICA9IG51bGw7XG4gICAgICAgIEJyaWdodGVuRm9yU2hhZGU6IHN0cmluZyAgICAgICAgICA9IG51bGw7XG4gICAgICAgIERhcmtlbjogc3RyaW5nICAgICAgICAgICAgICAgICAgICA9IG51bGw7XG4gICAgICAgIERhcmtlbkZvclNoYWRlOiBzdHJpbmcgICAgICAgICAgICA9IG51bGw7XG4gICAgICAgIENvbnRyYXN0Q29sb3I6IHN0cmluZyAgICAgICAgICAgICA9IG51bGw7XG4gICAgICAgIFRyYW5zcGFyZW50RGFya2VuVmFyaWFuY2U6IHN0cmluZyA9IG51bGw7XG4gICAgICAgIEJyaWdodFNoYWRlOiBzdHJpbmcgICAgICAgICAgICAgICA9IG51bGw7XG4gICAgICAgIElzQmFzZUJyaWdodDogYm9vbGVhbiAgICAgICAgICAgICA9IG51bGw7XG4gICAgICAgIFxuICAgICAgICBcbiAgICAgICAgY29uc3RydWN0b3IoX0NvbG9yOiBzdHJpbmcpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLkJhc2UgPSB0aGlzLmlzQ29sb3IoX0NvbG9yKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuQnJpZ2h0ZW4gICAgICAgICAgICAgICAgICA9IHRoaXMuYnJpZ2h0bmVzcyh0aGlzLkJhc2UsICdicmlnaHRlbicsIDIwKTtcbiAgICAgICAgICAgICAgICB0aGlzLkJyaWdodGVuRm9yU2hhZGUgICAgICAgICAgPSB0aGlzLmJyaWdodG5lc3ModGhpcy5CYXNlLCAnYnJpZ2h0ZW4nLCAxMCk7XG4gICAgICAgICAgICAgICAgdGhpcy5EYXJrZW4gICAgICAgICAgICAgICAgICAgID0gdGhpcy5icmlnaHRuZXNzKHRoaXMuQmFzZSwgJ2RhcmtlbicsIDIwKTtcbiAgICAgICAgICAgICAgICB0aGlzLkRhcmtlbkZvclNoYWRlICAgICAgICAgICAgPSB0aGlzLmJyaWdodG5lc3ModGhpcy5CYXNlLCAnZGFya2VuJywgMTApO1xuICAgICAgICAgICAgICAgIGNvbnN0IGx1bWluYW5jZSAgICAgICAgICAgICAgICA9IE1hdGguZmxvb3IodGhpcy5sdW1pbmFuY2UodGhpcy5CYXNlKSAqIDEwMCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZGFya2VuICAgICAgICAgICAgICAgICAgID0gbHVtaW5hbmNlID4gNTAgPyA1IDogKGx1bWluYW5jZSA+IDQwID8gMTAgOiAobHVtaW5hbmNlID4gMjAgPyAxNSA6IGx1bWluYW5jZSkpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGJyaWdodGVuICAgICAgICAgICAgICAgICA9IGx1bWluYW5jZSA+IDU1ID8gNjUgOiAobHVtaW5hbmNlID4gNDUgPyA2MCA6IChsdW1pbmFuY2UgPiAyMCA/IDU1IDogKGx1bWluYW5jZSA+IDEwID8gNDUgOiA4MCkpKTtcbiAgICAgICAgICAgICAgICB0aGlzLkJyaWdodFNoYWRlICAgICAgICAgICAgICAgPSB0aGlzLmJyaWdodG5lc3ModGhpcy5icmlnaHRuZXNzKHRoaXMuQmFzZSwgJ2RhcmtlbicsIGRhcmtlbiksICdicmlnaHRlbicsIGJyaWdodGVuKTtcbiAgICAgICAgICAgICAgICB0aGlzLlRyYW5zcGFyZW50RGFya2VuVmFyaWFuY2UgPSB0aGlzLmJyaWdodG5lc3ModGhpcy50cmFuc3BhcmVudGl6ZSh0aGlzLkJhc2UsIDgwKSwgJ2RhcmtlbicsIDQwKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0JyaWdodCh0aGlzLkJhc2UpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuQ29udHJhc3RDb2xvciA9ICdyZ2IoNTIsIDU4LCA2NCknO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLklzQmFzZUJyaWdodCAgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuQ29udHJhc3RDb2xvciA9ICdyZ2IoMjU1LDI1NSwyNTUpJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5Jc0Jhc2VCcmlnaHQgID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8qICAgICAgICAgY29uc29sZS5sb2coJyVjIENvbG9yICcsIGBiYWNrZ3JvdW5kOiAke3RoaXMuQnJpZ2h0U2hhZGV9OyBjb2xvcjogJHt0aGlzLkNvbnRyYXN0Q29sb3J9YCwgbHVtaW5hbmNlLCBkYXJrZW4sIGJyaWdodGVuKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCclYyBCcmlnaHRlbiAnLCBgYmFja2dyb3VuZDogJHt0aGlzLkJyaWdodGVufTsgY29sb3I6ICR7dGhpcy5Db250cmFzdENvbG9yfWAsIHRoaXMuQnJpZ2h0ZW4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJyVjIEJyaWdodGVuRm9yU2hhZGUgJywgYGJhY2tncm91bmQ6ICR7dGhpcy5CcmlnaHRlbkZvclNoYWRlfTsgY29sb3I6ICR7dGhpcy5Db250cmFzdENvbG9yfWAsIHRoaXMuQnJpZ2h0ZW5Gb3JTaGFkZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnJWMgRGFya2VuICcsIGBiYWNrZ3JvdW5kOiAke3RoaXMuRGFya2VufTsgY29sb3I6ICR7dGhpcy5Db250cmFzdENvbG9yfWAsIHRoaXMuRGFya2VuKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCclYyBEYXJrZW5Gb3JTaGFkZSAnLCBgYmFja2dyb3VuZDogJHt0aGlzLkRhcmtlbkZvclNoYWRlfTsgY29sb3I6ICR7dGhpcy5Db250cmFzdENvbG9yfWAsIHRoaXMuRGFya2VuRm9yU2hhZGUpOyovXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByaXZhdGUgaXNCcmlnaHQoX1JnYjogc3RyaW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb250cmFzdCh0aGlzLmx1bWluYW5jZShfUmdiKSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByaXZhdGUgYnJpZ2h0bmVzcyhfUmdiOiBzdHJpbmcsIF9BY3Rpb246ICdicmlnaHRlbicgfCAnZGFya2VuJywgX1BlcmNlbnRhZ2U6IG51bWJlcik6IHN0cmluZyB7XG4gICAgICAgICAgICBjb25zdCByZ2JJbnRBcnJheSAgICAgICAgICAgICAgID0gdGhpcy5nZXRSR0JBcnJheShfUmdiKTtcbiAgICAgICAgICAgIGNvbnN0IFtsb3dlc3QsIG1pZGRsZSwgaGlnaGVzdF0gPSB0aGlzLmdldExvd01pZEhpKHJnYkludEFycmF5KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKF9BY3Rpb24gPT09ICdicmlnaHRlbicgJiYgbG93ZXN0LnZhbCA9PT0gMjU1KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF9SZ2I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChfQWN0aW9uID09PSAnZGFya2VuJyAmJiBoaWdoZXN0LnZhbCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBfUmdiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBhbW91bnQgPSBfUGVyY2VudGFnZSAvIDEwMCAqIDI1NTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbGV0IHJldHVybkxpc3QgPSBbXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKF9BY3Rpb24gPT09ICdicmlnaHRlbicpIHtcbiAgICAgICAgICAgICAgICByZXR1cm5MaXN0W2xvd2VzdC5pbmRleF0gID0gTWF0aC5yb3VuZChsb3dlc3QudmFsICsgKE1hdGgubWluKDI1NSAtIGxvd2VzdC52YWwsIGFtb3VudCkpKTtcbiAgICAgICAgICAgICAgICBjb25zdCBpbmNyZWFzZUZyYWN0aW9uICAgID0gKHJldHVybkxpc3RbbG93ZXN0LmluZGV4XSAtIGxvd2VzdC52YWwpIC8gKDI1NSAtIGxvd2VzdC52YWwpO1xuICAgICAgICAgICAgICAgIHJldHVybkxpc3RbbWlkZGxlLmluZGV4XSAgPSBtaWRkbGUudmFsICsgKDI1NSAtIG1pZGRsZS52YWwpICogaW5jcmVhc2VGcmFjdGlvbjtcbiAgICAgICAgICAgICAgICByZXR1cm5MaXN0W2hpZ2hlc3QuaW5kZXhdID0gaGlnaGVzdC52YWwgKyAoMjU1IC0gaGlnaGVzdC52YWwpICogaW5jcmVhc2VGcmFjdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChfQWN0aW9uID09PSAnZGFya2VuJykge1xuICAgICAgICAgICAgICAgIHJldHVybkxpc3RbaGlnaGVzdC5pbmRleF0gPSBoaWdoZXN0LnZhbCAtIChNYXRoLm1pbihoaWdoZXN0LnZhbCwgYW1vdW50KSk7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVjcmVhc2VGcmFjdGlvbiAgICA9IChoaWdoZXN0LnZhbCAtIHJldHVybkxpc3RbaGlnaGVzdC5pbmRleF0pIC8gKGhpZ2hlc3QudmFsKTtcbiAgICAgICAgICAgICAgICByZXR1cm5MaXN0W21pZGRsZS5pbmRleF0gID0gbWlkZGxlLnZhbCAtIG1pZGRsZS52YWwgKiBkZWNyZWFzZUZyYWN0aW9uO1xuICAgICAgICAgICAgICAgIHJldHVybkxpc3RbbG93ZXN0LmluZGV4XSAgPSBsb3dlc3QudmFsIC0gbG93ZXN0LnZhbCAqIGRlY3JlYXNlRnJhY3Rpb247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybkxpc3QgPSByZXR1cm5MaXN0Lm1hcChpdGVtID0+IE1hdGgucm91bmQoaXRlbSkpO1xuICAgICAgICAgICAgaWYgKHJnYkludEFycmF5Lmxlbmd0aCA+IDMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm5MaXN0LnB1c2gocmdiSW50QXJyYXlbM10pO1xuICAgICAgICAgICAgICAgIHJldHVybiAoYHJnYmEoJHtyZXR1cm5MaXN0LmpvaW4oKX0pYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gKGByZ2IoJHtyZXR1cm5MaXN0LmpvaW4oKX0pYCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByaXZhdGUgZ2V0TG93TWlkSGkoX1JnYkFycmF5OiBudW1iZXJbXSkge1xuICAgICAgICAgICAgY29uc3QgcmdiQXJyYXlDb3B5ICAgICAgICAgPSBfUmdiQXJyYXkuc2xpY2UoKTtcbiAgICAgICAgICAgIGNvbnN0IHJnYkFycmF5V2l0aG91dEFscGhhID0gX1JnYkFycmF5Lmxlbmd0aCA+IDMgPyByZ2JBcnJheUNvcHkucmV2ZXJzZSgpLnNsaWNlKDEpLnJldmVyc2UoKSA6IF9SZ2JBcnJheTtcbiAgICAgICAgICAgIGxldCBoaWdoZXN0ICAgICAgICAgICAgICAgID0ge3ZhbDogLTEsIGluZGV4OiAtMX07XG4gICAgICAgICAgICBsZXQgbG93ZXN0ICAgICAgICAgICAgICAgICA9IHt2YWw6IEluZmluaXR5LCBpbmRleDogLTF9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZ2JBcnJheVdpdGhvdXRBbHBoYS5tYXAoKHZhbCwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodmFsID4gaGlnaGVzdC52YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaGlnaGVzdCA9IHt2YWw6IHZhbCwgaW5kZXg6IGluZGV4fTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHZhbCA8IGxvd2VzdC52YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgbG93ZXN0ID0ge3ZhbDogdmFsLCBpbmRleDogaW5kZXh9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAobG93ZXN0LmluZGV4ID09PSBoaWdoZXN0LmluZGV4KSB7XG4gICAgICAgICAgICAgICAgbG93ZXN0LmluZGV4ID0gaGlnaGVzdC5pbmRleCArIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IG1pZGRsZUluZGV4ID0gKDMgLSBoaWdoZXN0LmluZGV4IC0gbG93ZXN0LmluZGV4KTtcbiAgICAgICAgICAgIGxldCBtaWRkbGUgICAgICAgID0ge3ZhbDogcmdiQXJyYXlXaXRob3V0QWxwaGFbbWlkZGxlSW5kZXhdLCBpbmRleDogbWlkZGxlSW5kZXh9O1xuICAgICAgICAgICAgcmV0dXJuIFtsb3dlc3QsIG1pZGRsZSwgaGlnaGVzdF07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByaXZhdGUgY29udHJhc3QoX0x1bWluYW5jZSkge1xuICAgICAgICAgICAgY29uc3QgYnJpZ2h0ZXN0ID0gTWF0aC5tYXgoMS4wNSwgX0x1bWluYW5jZSArIDAuMDUpO1xuICAgICAgICAgICAgY29uc3QgZGFya2VzdCAgID0gTWF0aC5taW4oMS4wNSwgX0x1bWluYW5jZSArIDAuMDUpO1xuICAgICAgICAgICAgY29uc3QgY29udHJhc3QgID0gKGJyaWdodGVzdCkgLyAoZGFya2VzdCk7XG4gICAgICAgICAgICByZXR1cm4gY29udHJhc3QgPCAzO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBwcml2YXRlIGlzQ29sb3IoX1N0ckNvbG9yKSB7XG4gICAgICAgICAgICBjb25zdCBDU1NEZWNsYXJhdGlvbiA9IG5ldyBPcHRpb24oKS5zdHlsZTtcbiAgICAgICAgICAgIENTU0RlY2xhcmF0aW9uLmNvbG9yID0gX1N0ckNvbG9yO1xuICAgICAgICAgICAgcmV0dXJuICEhQ1NTRGVjbGFyYXRpb24uY29sb3IgPyBDU1NEZWNsYXJhdGlvbi5jb2xvciA6IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByaXZhdGUgZ2V0UkdCQXJyYXkoX1JnYjogc3RyaW5nKTogbnVtYmVyW10ge1xuICAgICAgICAgICAgcmV0dXJuIF9SZ2IucmVwbGFjZSgvXihyZ2J8cmdiYSlcXCgvLCAnJykucmVwbGFjZSgvXFwpJC8sICcnKS5yZXBsYWNlKC9cXHMvZywgJycpLnNwbGl0KCcsJykubWFwKHggPT4gK3gpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBwcml2YXRlIGx1bWluYW5jZShfUmdiOiBzdHJpbmcpIHtcbiAgICAgICAgICAgIGNvbnN0IHJnYkludEFycmF5ID0gdGhpcy5nZXRSR0JBcnJheShfUmdiKTtcbiAgICAgICAgICAgIGNvbnN0IFczYWxnb3JpdGhtID0gcmdiSW50QXJyYXkubWFwKGl0ZW0gPT4ge1xuICAgICAgICAgICAgICAgIGl0ZW0gLz0gMjU1O1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtIDw9IDAuMDM5MjhcbiAgICAgICAgICAgICAgICAgICAgPyBpdGVtIC8gMTIuOTJcbiAgICAgICAgICAgICAgICAgICAgOiBNYXRoLnBvdygoaXRlbSArIDAuMDU1KSAvIDEuMDU1LCAyLjQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gVzNhbGdvcml0aG1bMF0gKiAwLjIxMjYgKyBXM2FsZ29yaXRobVsxXSAqIDAuNzE1MiArIFczYWxnb3JpdGhtWzJdICogMC4wNzIyO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBwcml2YXRlIHRyYW5zcGFyZW50aXplKF9SZ2I6IHN0cmluZywgX1BlcmNlbnRhZ2U6IG51bWJlcikge1xuICAgICAgICAgICAgY29uc3QgYmFzZUFycmF5ID0gdGhpcy5CYXNlLnJlcGxhY2UoL14ocmdifHJnYmEpXFwoLywgJycpLnJlcGxhY2UoL1xcKSQvLCAnJykucmVwbGFjZSgvXFxzL2csICcnKS5zcGxpdCgnLCcpLm1hcCh4ID0+ICt4KTtcbiAgICAgICAgICAgIGlmIChiYXNlQXJyYXkubGVuZ3RoID4gMykge1xuICAgICAgICAgICAgICAgIGJhc2VBcnJheS5wb3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGFtb3VudCA9ICgxMDAgLSBfUGVyY2VudGFnZSkgLyAxMDA7XG4gICAgICAgICAgICBiYXNlQXJyYXkucHVzaChhbW91bnQpO1xuICAgICAgICAgICAgcmV0dXJuIChgcmdiKCR7YmFzZUFycmF5LmpvaW4oKX0pYCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBEYXRhQ29udHJvbCB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAaWdub3JlXG4gICAgICAgICAqL1xuICAgICAgICBwdWJsaWMgY29weVZhbHVlc0Zyb20oX0RhdGE6IGFueSwgX0Rlc3RpbmF0aW9uT2JqZWN0OiBhbnkpOiBhbnkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAodHlwZW9mIF9EYXRhICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIHJldHVybiBfRGVzdGluYXRpb25PYmplY3Q7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGRhdGFLZXlzICAgICAgICAgICAgICA9IE9iamVjdC5rZXlzKF9EYXRhKTtcbiAgICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uT2JqZWN0S2V5cyA9IE9iamVjdC5rZXlzKF9EZXN0aW5hdGlvbk9iamVjdCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGRhdGFLZXlzLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAoZGVzdGluYXRpb25PYmplY3RLZXlzLmZpbmQodEtleSA9PiB0S2V5ID09PSBrZXkgfHwgdEtleSA9PT0gJ18nICsga2V5KSkge1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleS5pbmNsdWRlcygnRGF0ZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRlID0gRGF0ZS5wYXJzZShfRGF0YVtrZXldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX0Rlc3RpbmF0aW9uT2JqZWN0W2tleV0gPSBuZXcgRGF0ZShkYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9EYXRhW2tleV0gIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX0Rlc3RpbmF0aW9uT2JqZWN0W2tleV0gPSBfRGF0YVtrZXldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfRGF0YVtrZXldICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX0Rlc3RpbmF0aW9uT2JqZWN0W2tleV0gPSBfRGF0YVtrZXldO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIF9EZXN0aW5hdGlvbk9iamVjdDtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==