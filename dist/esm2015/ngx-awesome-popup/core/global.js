import {ButtonLayoutDisplay} from './enums';

export var GlobalClass;
(function (GlobalClass) {
    class Message {
        constructor() {
            this.Title       = null;
            this.Description = null;
        }
    }
    GlobalClass.Message = Message;
    class ButtonMaker {
        constructor(Label, ID, LayoutType = ButtonLayoutDisplay.PRIMARY) {
            this.Label = Label;
            this.ID = ID;
            this.LayoutType = LayoutType;
        }
    }
    GlobalClass.ButtonMaker = ButtonMaker;
    class GlobalUserConfig {
        constructor(_GlobalUserConfig) {
            this.ColorList = new GlobalClass.ColorTypes();
            if (_GlobalUserConfig) {
                const dataControl = new GlobalClass.DataControl();
                dataControl.copyValuesFrom(_GlobalUserConfig, this);
                const colorList = new GlobalClass.ColorTypes();
                this.ColorList = dataControl.copyValuesFrom(this.ColorList, colorList);
            }
        }
    }
    GlobalClass.GlobalUserConfig = GlobalUserConfig;
    class ColorTypes {
        constructor() {
            this.Primary = null;
            this.Secondary = null;
            this.Success = null;
            this.Info = null;
            this.Warning = null;
            this.Danger = null;
            this.Light = null;
            this.Dark = null;
        }
    }
    GlobalClass.ColorTypes = ColorTypes;
    class GlobalConfig {
        constructor() {
            this.DisplayColor = new GlobalClass.DisplayColor();
        }
    }
    GlobalClass.GlobalConfig = GlobalConfig;
    class DisplayColor {
        constructor() {
            this.Primary = null;
            this.Secondary = null;
            this.Success = null;
            this.Info = null;
            this.Warning = null;
            this.Danger = null;
            this.Light = null;
            this.Dark = null;
        }
    }
    GlobalClass.DisplayColor = DisplayColor;
    class ColorProvider {
        constructor(_Color) {
            this.Base = null;
            this.Brighten = null;
            this.BrightenForShade = null;
            this.Darken = null;
            this.DarkenForShade = null;
            this.ContrastColor = null;
            this.TransparentDarkenVariance = null;
            this.BrightShade = null;
            this.IsBaseBright = null;
            if (this.Base = this.isColor(_Color)) {
                this.Brighten = this.brightness(this.Base, 'brighten', 20);
                this.BrightenForShade = this.brightness(this.Base, 'brighten', 10);
                this.Darken = this.brightness(this.Base, 'darken', 20);
                this.DarkenForShade = this.brightness(this.Base, 'darken', 10);
                const luminance = Math.floor(this.luminance(this.Base) * 100);
                const darken = luminance > 50 ? 5 : (luminance > 40 ? 10 : (luminance > 20 ? 15 : luminance));
                const brighten = luminance > 55 ? 65 : (luminance > 45 ? 60 : (luminance > 20 ? 55 : (luminance > 10 ? 45 : 80)));
                this.BrightShade = this.brightness(this.brightness(this.Base, 'darken', darken), 'brighten', brighten);
                this.TransparentDarkenVariance = this.brightness(this.transparentize(this.Base, 80), 'darken', 40);
                if (this.isBright(this.Base)) {
                    this.ContrastColor = 'rgb(52, 58, 64, 0.2)';
                    this.IsBaseBright  = true;
                }
                else {
                    this.ContrastColor = 'rgb(255,255,255, 0.2)';
                    this.IsBaseBright  = false;
                }
                /*         console.log('%c Color ', `background: ${this.BrightShade}; color: ${this.ContrastColor}`, luminance, darken, brighten);
                           console.log('%c Brighten ', `background: ${this.Brighten}; color: ${this.ContrastColor}`, this.Brighten);
                           console.log('%c BrightenForShade ', `background: ${this.BrightenForShade}; color: ${this.ContrastColor}`, this.BrightenForShade);
                           console.log('%c Darken ', `background: ${this.Darken}; color: ${this.ContrastColor}`, this.Darken);
                           console.log('%c DarkenForShade ', `background: ${this.DarkenForShade}; color: ${this.ContrastColor}`, this.DarkenForShade);*/
            }
        }
        isBright(_Rgb) {
            return this.contrast(this.luminance(_Rgb));
        }
        brightness(_Rgb, _Action, _Percentage) {
            const rgbIntArray = this.getRGBArray(_Rgb);
            const [lowest, middle, highest] = this.getLowMidHi(rgbIntArray);
            if (_Action === 'brighten' && lowest.val === 255) {
                return _Rgb;
            }
            if (_Action === 'darken' && highest.val === 0) {
                return _Rgb;
            }
            const amount = _Percentage / 100 * 255;
            let returnList = [];
            if (_Action === 'brighten') {
                returnList[lowest.index] = Math.round(lowest.val + (Math.min(255 - lowest.val, amount)));
                const increaseFraction = (returnList[lowest.index] - lowest.val) / (255 - lowest.val);
                returnList[middle.index] = middle.val + (255 - middle.val) * increaseFraction;
                returnList[highest.index] = highest.val + (255 - highest.val) * increaseFraction;
            }
            if (_Action === 'darken') {
                returnList[highest.index] = highest.val - (Math.min(highest.val, amount));
                const decreaseFraction = (highest.val - returnList[highest.index]) / (highest.val);
                returnList[middle.index] = middle.val - middle.val * decreaseFraction;
                returnList[lowest.index] = lowest.val - lowest.val * decreaseFraction;
            }
            returnList = returnList.map(item => Math.round(item));
            if (rgbIntArray.length > 3) {
                returnList.push(rgbIntArray[3]);
                return (`rgba(${returnList.join()})`);
            }
            return (`rgb(${returnList.join()})`);
        }
        getLowMidHi(_RgbArray) {
            const rgbArrayCopy = _RgbArray.slice();
            const rgbArrayWithoutAlpha = _RgbArray.length > 3 ? rgbArrayCopy.reverse().slice(1).reverse() : _RgbArray;
            let highest = { val: -1, index: -1 };
            let lowest = { val: Infinity, index: -1 };
            rgbArrayWithoutAlpha.map((val, index) => {
                if (val > highest.val) {
                    highest = { val: val, index: index };
                }
                if (val < lowest.val) {
                    lowest = { val: val, index: index };
                }
            });
            if (lowest.index === highest.index) {
                lowest.index = highest.index + 1;
            }
            const middleIndex = (3 - highest.index - lowest.index);
            let middle = { val: rgbArrayWithoutAlpha[middleIndex], index: middleIndex };
            return [lowest, middle, highest];
        }
        contrast(_Luminance) {
            const brightest = Math.max(1.05, _Luminance + 0.05);
            const darkest = Math.min(1.05, _Luminance + 0.05);
            const contrast = (brightest) / (darkest);
            return contrast < 3;
        }
        isColor(_StrColor) {
            const CSSDeclaration = new Option().style;
            CSSDeclaration.color = _StrColor;
            return !!CSSDeclaration.color ? CSSDeclaration.color : null;
        }
        getRGBArray(_Rgb) {
            return _Rgb.replace(/^(rgb|rgba)\(/, '').replace(/\)$/, '').replace(/\s/g, '').split(',').map(x => +x);
        }
        luminance(_Rgb) {
            const rgbIntArray = this.getRGBArray(_Rgb);
            const W3algorithm = rgbIntArray.map(item => {
                item /= 255;
                return item <= 0.03928
                    ? item / 12.92
                    : Math.pow((item + 0.055) / 1.055, 2.4);
            });
            return W3algorithm[0] * 0.2126 + W3algorithm[1] * 0.7152 + W3algorithm[2] * 0.0722;
        }
        transparentize(_Rgb, _Percentage) {
            const baseArray = this.Base.replace(/^(rgb|rgba)\(/, '').replace(/\)$/, '').replace(/\s/g, '').split(',').map(x => +x);
            if (baseArray.length > 3) {
                baseArray.pop();
            }
            const amount = (100 - _Percentage) / 100;
            baseArray.push(amount);
            return (`rgb(${baseArray.join()})`);
        }
    }
    GlobalClass.ColorProvider = ColorProvider;
    class DataControl {
        /**
         * @ignore
         */
        copyValuesFrom(_Data, _DestinationObject) {
            if (typeof _Data !== 'object') {
                return _DestinationObject;
            }
            const dataKeys = Object.keys(_Data);
            const destinationObjectKeys = Object.keys(_DestinationObject);
            dataKeys.forEach(key => {
                if (destinationObjectKeys.find(tKey => tKey === key || tKey === '_' + key)) {
                    if (key.includes('Date')) {
                        const date = Date.parse(_Data[key]);
                        if (date) {
                            _DestinationObject[key] = new Date(date);
                        }
                        else {
                            if (_Data[key] !== null) {
                                _DestinationObject[key] = _Data[key];
                            }
                        }
                    }
                    else {
                        if (_Data[key] !== null) {
                            _DestinationObject[key] = _Data[key];
                        }
                    }
                }
            });
            return _DestinationObject;
        }
    }
    GlobalClass.DataControl = DataControl;
})(GlobalClass || (GlobalClass = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2xvYmFsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vbmd4LWF3ZXNvbWUtcG9wdXAvY29yZS9nbG9iYWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLG1CQUFtQixFQUFDLE1BQU0sU0FBUyxDQUFDO0FBbUc1QyxNQUFNLEtBQVcsV0FBVyxDQTJPM0I7QUEzT0QsV0FBaUIsV0FBVztJQUV4QixNQUFhLE9BQU87UUFBcEI7WUFDSSxVQUFLLEdBQWlCLElBQUksQ0FBQztZQUMzQixnQkFBVyxHQUFXLElBQUksQ0FBQztRQUMvQixDQUFDO0tBQUE7SUFIWSxtQkFBTyxVQUduQixDQUFBO0lBRUQsTUFBYSxXQUFXO1FBRXBCLFlBQW1CLEtBQWEsRUFBUyxFQUFVLEVBQVMsYUFBa0MsbUJBQW1CLENBQUMsT0FBTztZQUF0RyxVQUFLLEdBQUwsS0FBSyxDQUFRO1lBQVMsT0FBRSxHQUFGLEVBQUUsQ0FBUTtZQUFTLGVBQVUsR0FBVixVQUFVLENBQW1EO1FBQ3pILENBQUM7S0FDSjtJQUpZLHVCQUFXLGNBSXZCLENBQUE7SUFFRCxNQUFhLGdCQUFnQjtRQUd6QixZQUFZLGlCQUFvRDtZQUZoRSxjQUFTLEdBQWdDLElBQUksV0FBVyxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBR2xFLElBQUksaUJBQWlCLEVBQUM7Z0JBQ2xCLE1BQU0sV0FBVyxHQUFNLElBQUksV0FBVyxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUNyRCxXQUFXLENBQUMsY0FBYyxDQUFDLGlCQUFpQixFQUFFLElBQUksQ0FBQyxDQUFDO2dCQUNwRCxNQUFNLFNBQVMsR0FBRyxJQUFJLFdBQVcsQ0FBQyxVQUFVLEVBQUUsQ0FBQztnQkFDL0MsSUFBSSxDQUFDLFNBQVMsR0FBSSxXQUFXLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUM7YUFDM0U7UUFDTCxDQUFDO0tBQ0o7SUFYWSw0QkFBZ0IsbUJBVzVC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dG9uTGF5b3V0RGlzcGxheX0gZnJvbSAnLi9lbnVtcyc7XG5cbmV4cG9ydCBuYW1lc3BhY2UgR2xvYmFsSW50ZXJmYWNlIHtcbiAgICBcbiAgICAvKipcbiAgICAgKiBFYWNoIHByb3BlcnR5IG9mIHtAbGluayBDb2xvckxpc3R9IHJlcHJlc2VudCBhIHN0cmluZyB3aGljaCByZXByZXNlbnQgYSBjb2xvciBpbiBoZXggb3IgcmdiL3JnYmEgZm9ybWF0LlxuICAgICAqIEZvciBhdmFpbGFibGUgY29sb3IgdHlwZXMocHJvcGVydGllcykgY2hlY2sge0BsaW5rIElDb2xvclR5cGVzfSBpbnRlcmZhY2UuXG4gICAgICogRXZlcnkgY29sb3IgaXMgb3B0aW9uYWwsIGFuZCBpdCB3aWxsIHJlZmxlY3Qgb24gZGlhbG9nIG9yIGJ1dHRvbiBjb2xvciB0eXBlcyBhbmQgaXRzIGNvbG9yIGNvbnRyYXN0IG9yIHZhcmlhbmNlLlxuICAgICAqICAqIGBgYHR5cGVzY3JpcHRcbiAgICAgKiAvLyBDb2xvckxpc3Qgb2JqZWN0IGV4YW1wbGUuXG4gICAgICogY29uc3QgY29sb3JMaXN0ID0ge1xuICAgICAqICAgICAgICAgQ29sb3JMaXN0OiB7XG4gICAgICogICAgICAgICAgICBQcmltYXJ5ICA6ICcjZmY5ZTAwJyxcbiAgICAgKiAgICAgICAgICAgIFNlY29uZGFyeTogJyM5ODllYTUnLFxuICAgICAqICAgICAgICAgICAgSW5mbyAgICAgOiAnIzJmOGVlNScsXG4gICAgICogICAgICAgICAgICBTdWNjZXNzICA6ICcjM2NhZWEzJyxcbiAgICAgKiAgICAgICAgICAgIFdhcm5pbmcgIDogJyNmZmMxMDcnLFxuICAgICAqICAgICAgICAgICAgRGFuZ2VyICAgOiAnI2U0NjQ2NCcsXG4gICAgICogICAgICAgICAgICBMaWdodCAgICA6ICcjZmJmYmZiJyxcbiAgICAgKiAgICAgICAgICAgIERhcmsgICAgIDogJyMzNDNhNDAnXG4gICAgICogICAgICAgICAgIH1cbiAgICAgKiAgICAgICAgfVxuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGV4cG9ydCBpbnRlcmZhY2UgSUdsb2JhbFVzZXJDb25maWcge1xuICAgICAgICBDb2xvckxpc3Q/OiBHbG9iYWxJbnRlcmZhY2UuSUNvbG9yVHlwZXM7XG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSUdsb2JhbENvbmZpZyB7XG4gICAgICAgIERpc3BsYXlDb2xvcj86IEdsb2JhbEludGVyZmFjZS5JQ29sb3JPYmplY3Q7XG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSUNvbG9yVHlwZXMge1xuICAgICAgICBQcmltYXJ5Pzogc3RyaW5nO1xuICAgICAgICBTZWNvbmRhcnk/OiBzdHJpbmc7XG4gICAgICAgIFN1Y2Nlc3M/OiBzdHJpbmc7XG4gICAgICAgIEluZm8/OiBzdHJpbmc7XG4gICAgICAgIFdhcm5pbmc/OiBzdHJpbmc7XG4gICAgICAgIERhbmdlcj86IHN0cmluZztcbiAgICAgICAgTGlnaHQ/OiBzdHJpbmc7XG4gICAgICAgIERhcms/OiBzdHJpbmc7XG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSVByaXZhdGVSZXNwb25zZSB7XG4gICAgICAgIFxuICAgICAgICBzZXRCZWxvbmdpbmcoX0RpYWxvZ0JlbG9uZ2luZyk6IHZvaWRcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogSW50ZXJmYWNlIGZvciBjdXN0b20gYnV0dG9uLlxuICAgICAqXG4gICAgICogRXhhbXBsZTpcbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogLy8gQ3VzdG9tIGJ1dHRvbiBvYmplY3QuXG4gICAgICogY29uc3QgYnV0dG9uID0ge1xuICAgICAqICAgICAgICBJRCAgICAgICAgIDogJ2NvbmZpcm1fYnRuJyxcbiAgICAgKiAgICAgICAgTGFiZWw6ICAgICA6ICdDb25maXJtJ1xuICAgICAqICAgICAgICBMYXlvdXRUeXBlIDogQnV0dG9uTGF5b3V0RGlzcGxheS5TVUNDRVNTXG4gICAgICogIH1cbiAgICAgKiAvLyBPciBpbnN0YW50aWF0ZWQgd2l0aCBCdXR0b25NYWtlciBjbGFzc1xuICAgICAqIGNvbnN0IGJ1dHRvbjIgPSBuZXcgQnV0dG9uTWFrZXIoJ0NvbmZpcm0nLCAnY29uZmlybV9idG4nLCBCdXR0b25MYXlvdXREaXNwbGF5LlNVQ0NFU1MpXG4gICAgICogYGBgXG4gICAgICogKiBCdXR0b25MYXlvdXREaXNwbGF5OiB7QGxpbmsgQnV0dG9uTGF5b3V0RGlzcGxheX1cbiAgICAgKi9cbiAgICBleHBvcnQgaW50ZXJmYWNlIElCdXR0b24ge1xuICAgICAgICBMYWJlbDogc3RyaW5nO1xuICAgICAgICBMYXlvdXRUeXBlOiBCdXR0b25MYXlvdXREaXNwbGF5IHwgbnVsbDtcbiAgICAgICAgSUQ/OiBzdHJpbmc7XG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSUNvbG9yT2JqZWN0IHtcbiAgICAgICAgUHJpbWFyeT86IEdsb2JhbEludGVyZmFjZS5JQ29sb3JQcm92aWRlcjtcbiAgICAgICAgU2Vjb25kYXJ5PzogR2xvYmFsSW50ZXJmYWNlLklDb2xvclByb3ZpZGVyO1xuICAgICAgICBTdWNjZXNzPzogR2xvYmFsSW50ZXJmYWNlLklDb2xvclByb3ZpZGVyO1xuICAgICAgICBJbmZvPzogR2xvYmFsSW50ZXJmYWNlLklDb2xvclByb3ZpZGVyO1xuICAgICAgICBXYXJuaW5nPzogR2xvYmFsSW50ZXJmYWNlLklDb2xvclByb3ZpZGVyO1xuICAgICAgICBEYW5nZXI/OiBHbG9iYWxJbnRlcmZhY2UuSUNvbG9yUHJvdmlkZXI7XG4gICAgICAgIExpZ2h0PzogR2xvYmFsSW50ZXJmYWNlLklDb2xvclByb3ZpZGVyO1xuICAgICAgICBEYXJrPzogR2xvYmFsSW50ZXJmYWNlLklDb2xvclByb3ZpZGVyO1xuICAgIH1cbiAgICBcbiAgICBleHBvcnQgaW50ZXJmYWNlIElDb2xvclByb3ZpZGVyIHtcbiAgICAgICAgXG4gICAgICAgIEJhc2U6IHN0cmluZztcbiAgICAgICAgQnJpZ2h0ZW46IHN0cmluZztcbiAgICAgICAgQnJpZ2h0ZW5Gb3JTaGFkZTogc3RyaW5nO1xuICAgICAgICBEYXJrZW46IHN0cmluZztcbiAgICAgICAgRGFya2VuRm9yU2hhZGU6IHN0cmluZztcbiAgICAgICAgQ29udHJhc3RDb2xvcjogc3RyaW5nO1xuICAgICAgICBCcmlnaHRTaGFkZTogc3RyaW5nO1xuICAgICAgICBUcmFuc3BhcmVudERhcmtlblZhcmlhbmNlOiBzdHJpbmc7XG4gICAgICAgIElzQmFzZUJyaWdodDogYm9vbGVhbjtcbiAgICB9XG4gICAgZXhwb3J0IGludGVyZmFjZSBJTWVzc2FnZSB7XG4gICAgICAgIFRpdGxlOiBzdHJpbmc7XG4gICAgICAgIERlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgfVxufVxuXG5leHBvcnQgbmFtZXNwYWNlIEdsb2JhbENsYXNzIHtcbiAgICBcbiAgICBleHBvcnQgY2xhc3MgTWVzc2FnZSB7XG4gICAgICAgIFRpdGxlOiBzdHJpbmcgICAgICAgPSBudWxsO1xuICAgICAgICBEZXNjcmlwdGlvbjogc3RyaW5nID0gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGNsYXNzIEJ1dHRvbk1ha2VyIGltcGxlbWVudHMgR2xvYmFsSW50ZXJmYWNlLklCdXR0b24ge1xuICAgICAgICBcbiAgICAgICAgY29uc3RydWN0b3IocHVibGljIExhYmVsOiBzdHJpbmcsIHB1YmxpYyBJRDogc3RyaW5nLCBwdWJsaWMgTGF5b3V0VHlwZTogQnV0dG9uTGF5b3V0RGlzcGxheSA9IEJ1dHRvbkxheW91dERpc3BsYXkuUFJJTUFSWSkge1xuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBHbG9iYWxVc2VyQ29uZmlnIGltcGxlbWVudHMgR2xvYmFsSW50ZXJmYWNlLklHbG9iYWxVc2VyQ29uZmlnIHtcbiAgICAgICAgQ29sb3JMaXN0OiBHbG9iYWxJbnRlcmZhY2UuSUNvbG9yVHlwZXMgPSBuZXcgR2xvYmFsQ2xhc3MuQ29sb3JUeXBlcygpO1xuICAgICAgICBcbiAgICAgICAgY29uc3RydWN0b3IoX0dsb2JhbFVzZXJDb25maWc6IEdsb2JhbEludGVyZmFjZS5JR2xvYmFsVXNlckNvbmZpZykge1xuICAgICAgICAgICAgaWYgKF9HbG9iYWxVc2VyQ29uZmlnKXtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhQ29udHJvbCAgICA9IG5ldyBHbG9iYWxDbGFzcy5EYXRhQ29udHJvbCgpO1xuICAgICAgICAgICAgICAgIGRhdGFDb250cm9sLmNvcHlWYWx1ZXNGcm9tKF9HbG9iYWxVc2VyQ29uZmlnLCB0aGlzKTtcbiAgICAgICAgICAgICAgICBjb25zdCBjb2xvckxpc3QgPSBuZXcgR2xvYmFsQ2xhc3MuQ29sb3JUeXBlcygpO1xuICAgICAgICAgICAgICAgIHRoaXMuQ29sb3JMaXN0ICA9IGRhdGFDb250cm9sLmNvcHlWYWx1ZXNGcm9tKHRoaXMuQ29sb3JMaXN0LCBjb2xvckxpc3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBDb2xvclR5cGVzIGltcGxlbWVudHMgIEdsb2JhbEludGVyZmFjZS5JQ29sb3JUeXBlcyB7XG4gICAgICAgIFByaW1hcnk6IHN0cmluZyAgID0gbnVsbDtcbiAgICAgICAgU2Vjb25kYXJ5OiBzdHJpbmcgPSBudWxsO1xuICAgICAgICBTdWNjZXNzOiBzdHJpbmcgICA9IG51bGw7XG4gICAgICAgIEluZm86IHN0cmluZyAgICAgID0gbnVsbDtcbiAgICAgICAgV2FybmluZzogc3RyaW5nICAgPSBudWxsO1xuICAgICAgICBEYW5nZXI6IHN0cmluZyAgICA9IG51bGw7XG4gICAgICAgIExpZ2h0OiBzdHJpbmcgICAgID0gbnVsbDtcbiAgICAgICAgRGFyazogc3RyaW5nICAgICAgPSBudWxsO1xuICAgIH1cbiAgICBcbiAgICBleHBvcnQgY2xhc3MgR2xvYmFsQ29uZmlnIGltcGxlbWVudHMgR2xvYmFsSW50ZXJmYWNlLklHbG9iYWxDb25maWcge1xuICAgICAgICBEaXNwbGF5Q29sb3I6IEdsb2JhbEludGVyZmFjZS5JQ29sb3JPYmplY3QgPSBuZXcgR2xvYmFsQ2xhc3MuRGlzcGxheUNvbG9yKCk7XG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBEaXNwbGF5Q29sb3IgaW1wbGVtZW50cyBHbG9iYWxJbnRlcmZhY2UuSUNvbG9yT2JqZWN0IHtcbiAgICAgICAgUHJpbWFyeTogQ29sb3JQcm92aWRlciAgID0gbnVsbDtcbiAgICAgICAgU2Vjb25kYXJ5OiBDb2xvclByb3ZpZGVyID0gbnVsbDtcbiAgICAgICAgU3VjY2VzczogQ29sb3JQcm92aWRlciAgID0gbnVsbDtcbiAgICAgICAgSW5mbzogQ29sb3JQcm92aWRlciAgICAgID0gbnVsbDtcbiAgICAgICAgV2FybmluZzogQ29sb3JQcm92aWRlciAgID0gbnVsbDtcbiAgICAgICAgRGFuZ2VyOiBDb2xvclByb3ZpZGVyICAgID0gbnVsbDtcbiAgICAgICAgTGlnaHQ6IENvbG9yUHJvdmlkZXIgICAgID0gbnVsbDtcbiAgICAgICAgRGFyazogQ29sb3JQcm92aWRlciAgICAgID0gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGNsYXNzIENvbG9yUHJvdmlkZXIge1xuICAgICAgICBcbiAgICAgICAgQmFzZTogc3RyaW5nICAgICAgICAgICAgICAgICAgICAgID0gbnVsbDtcbiAgICAgICAgQnJpZ2h0ZW46IHN0cmluZyAgICAgICAgICAgICAgICAgID0gbnVsbDtcbiAgICAgICAgQnJpZ2h0ZW5Gb3JTaGFkZTogc3RyaW5nICAgICAgICAgID0gbnVsbDtcbiAgICAgICAgRGFya2VuOiBzdHJpbmcgICAgICAgICAgICAgICAgICAgID0gbnVsbDtcbiAgICAgICAgRGFya2VuRm9yU2hhZGU6IHN0cmluZyAgICAgICAgICAgID0gbnVsbDtcbiAgICAgICAgQ29udHJhc3RDb2xvcjogc3RyaW5nICAgICAgICAgICAgID0gbnVsbDtcbiAgICAgICAgVHJhbnNwYXJlbnREYXJrZW5WYXJpYW5jZTogc3RyaW5nID0gbnVsbDtcbiAgICAgICAgQnJpZ2h0U2hhZGU6IHN0cmluZyAgICAgICAgICAgICAgID0gbnVsbDtcbiAgICAgICAgSXNCYXNlQnJpZ2h0OiBib29sZWFuICAgICAgICAgICAgID0gbnVsbDtcbiAgICAgICAgXG4gICAgICAgIFxuICAgICAgICBjb25zdHJ1Y3RvcihfQ29sb3I6IHN0cmluZykge1xuICAgICAgICAgICAgaWYgKHRoaXMuQmFzZSA9IHRoaXMuaXNDb2xvcihfQ29sb3IpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5CcmlnaHRlbiAgICAgICAgICAgICAgICAgID0gdGhpcy5icmlnaHRuZXNzKHRoaXMuQmFzZSwgJ2JyaWdodGVuJywgMjApO1xuICAgICAgICAgICAgICAgIHRoaXMuQnJpZ2h0ZW5Gb3JTaGFkZSAgICAgICAgICA9IHRoaXMuYnJpZ2h0bmVzcyh0aGlzLkJhc2UsICdicmlnaHRlbicsIDEwKTtcbiAgICAgICAgICAgICAgICB0aGlzLkRhcmtlbiAgICAgICAgICAgICAgICAgICAgPSB0aGlzLmJyaWdodG5lc3ModGhpcy5CYXNlLCAnZGFya2VuJywgMjApO1xuICAgICAgICAgICAgICAgIHRoaXMuRGFya2VuRm9yU2hhZGUgICAgICAgICAgICA9IHRoaXMuYnJpZ2h0bmVzcyh0aGlzLkJhc2UsICdkYXJrZW4nLCAxMCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbHVtaW5hbmNlICAgICAgICAgICAgICAgID0gTWF0aC5mbG9vcih0aGlzLmx1bWluYW5jZSh0aGlzLkJhc2UpICogMTAwKTtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXJrZW4gICAgICAgICAgICAgICAgICAgPSBsdW1pbmFuY2UgPiA1MCA/IDUgOiAobHVtaW5hbmNlID4gNDAgPyAxMCA6IChsdW1pbmFuY2UgPiAyMCA/IDE1IDogbHVtaW5hbmNlKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgYnJpZ2h0ZW4gICAgICAgICAgICAgICAgID0gbHVtaW5hbmNlID4gNTUgPyA2NSA6IChsdW1pbmFuY2UgPiA0NSA/IDYwIDogKGx1bWluYW5jZSA+IDIwID8gNTUgOiAobHVtaW5hbmNlID4gMTAgPyA0NSA6IDgwKSkpO1xuICAgICAgICAgICAgICAgIHRoaXMuQnJpZ2h0U2hhZGUgICAgICAgICAgICAgICA9IHRoaXMuYnJpZ2h0bmVzcyh0aGlzLmJyaWdodG5lc3ModGhpcy5CYXNlLCAnZGFya2VuJywgZGFya2VuKSwgJ2JyaWdodGVuJywgYnJpZ2h0ZW4pO1xuICAgICAgICAgICAgICAgIHRoaXMuVHJhbnNwYXJlbnREYXJrZW5WYXJpYW5jZSA9IHRoaXMuYnJpZ2h0bmVzcyh0aGlzLnRyYW5zcGFyZW50aXplKHRoaXMuQmFzZSwgODApLCAnZGFya2VuJywgNDApO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQnJpZ2h0KHRoaXMuQmFzZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5Db250cmFzdENvbG9yID0gJ3JnYig1MiwgNTgsIDY0LCAwLjIpJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5Jc0Jhc2VCcmlnaHQgID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkNvbnRyYXN0Q29sb3IgPSAncmdiKDI1NSwyNTUsMjU1LCAwLjIpJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5Jc0Jhc2VCcmlnaHQgID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8qICAgICAgICAgY29uc29sZS5sb2coJyVjIENvbG9yICcsIGBiYWNrZ3JvdW5kOiAke3RoaXMuQnJpZ2h0U2hhZGV9OyBjb2xvcjogJHt0aGlzLkNvbnRyYXN0Q29sb3J9YCwgbHVtaW5hbmNlLCBkYXJrZW4sIGJyaWdodGVuKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCclYyBCcmlnaHRlbiAnLCBgYmFja2dyb3VuZDogJHt0aGlzLkJyaWdodGVufTsgY29sb3I6ICR7dGhpcy5Db250cmFzdENvbG9yfWAsIHRoaXMuQnJpZ2h0ZW4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJyVjIEJyaWdodGVuRm9yU2hhZGUgJywgYGJhY2tncm91bmQ6ICR7dGhpcy5CcmlnaHRlbkZvclNoYWRlfTsgY29sb3I6ICR7dGhpcy5Db250cmFzdENvbG9yfWAsIHRoaXMuQnJpZ2h0ZW5Gb3JTaGFkZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnJWMgRGFya2VuICcsIGBiYWNrZ3JvdW5kOiAke3RoaXMuRGFya2VufTsgY29sb3I6ICR7dGhpcy5Db250cmFzdENvbG9yfWAsIHRoaXMuRGFya2VuKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCclYyBEYXJrZW5Gb3JTaGFkZSAnLCBgYmFja2dyb3VuZDogJHt0aGlzLkRhcmtlbkZvclNoYWRlfTsgY29sb3I6ICR7dGhpcy5Db250cmFzdENvbG9yfWAsIHRoaXMuRGFya2VuRm9yU2hhZGUpOyovXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByaXZhdGUgaXNCcmlnaHQoX1JnYjogc3RyaW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb250cmFzdCh0aGlzLmx1bWluYW5jZShfUmdiKSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByaXZhdGUgYnJpZ2h0bmVzcyhfUmdiOiBzdHJpbmcsIF9BY3Rpb246ICdicmlnaHRlbicgfCAnZGFya2VuJywgX1BlcmNlbnRhZ2U6IG51bWJlcik6IHN0cmluZyB7XG4gICAgICAgICAgICBjb25zdCByZ2JJbnRBcnJheSAgICAgICAgICAgICAgID0gdGhpcy5nZXRSR0JBcnJheShfUmdiKTtcbiAgICAgICAgICAgIGNvbnN0IFtsb3dlc3QsIG1pZGRsZSwgaGlnaGVzdF0gPSB0aGlzLmdldExvd01pZEhpKHJnYkludEFycmF5KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKF9BY3Rpb24gPT09ICdicmlnaHRlbicgJiYgbG93ZXN0LnZhbCA9PT0gMjU1KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF9SZ2I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChfQWN0aW9uID09PSAnZGFya2VuJyAmJiBoaWdoZXN0LnZhbCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBfUmdiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBhbW91bnQgPSBfUGVyY2VudGFnZSAvIDEwMCAqIDI1NTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbGV0IHJldHVybkxpc3QgPSBbXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKF9BY3Rpb24gPT09ICdicmlnaHRlbicpIHtcbiAgICAgICAgICAgICAgICByZXR1cm5MaXN0W2xvd2VzdC5pbmRleF0gID0gTWF0aC5yb3VuZChsb3dlc3QudmFsICsgKE1hdGgubWluKDI1NSAtIGxvd2VzdC52YWwsIGFtb3VudCkpKTtcbiAgICAgICAgICAgICAgICBjb25zdCBpbmNyZWFzZUZyYWN0aW9uICAgID0gKHJldHVybkxpc3RbbG93ZXN0LmluZGV4XSAtIGxvd2VzdC52YWwpIC8gKDI1NSAtIGxvd2VzdC52YWwpO1xuICAgICAgICAgICAgICAgIHJldHVybkxpc3RbbWlkZGxlLmluZGV4XSAgPSBtaWRkbGUudmFsICsgKDI1NSAtIG1pZGRsZS52YWwpICogaW5jcmVhc2VGcmFjdGlvbjtcbiAgICAgICAgICAgICAgICByZXR1cm5MaXN0W2hpZ2hlc3QuaW5kZXhdID0gaGlnaGVzdC52YWwgKyAoMjU1IC0gaGlnaGVzdC52YWwpICogaW5jcmVhc2VGcmFjdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChfQWN0aW9uID09PSAnZGFya2VuJykge1xuICAgICAgICAgICAgICAgIHJldHVybkxpc3RbaGlnaGVzdC5pbmRleF0gPSBoaWdoZXN0LnZhbCAtIChNYXRoLm1pbihoaWdoZXN0LnZhbCwgYW1vdW50KSk7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVjcmVhc2VGcmFjdGlvbiAgICA9IChoaWdoZXN0LnZhbCAtIHJldHVybkxpc3RbaGlnaGVzdC5pbmRleF0pIC8gKGhpZ2hlc3QudmFsKTtcbiAgICAgICAgICAgICAgICByZXR1cm5MaXN0W21pZGRsZS5pbmRleF0gID0gbWlkZGxlLnZhbCAtIG1pZGRsZS52YWwgKiBkZWNyZWFzZUZyYWN0aW9uO1xuICAgICAgICAgICAgICAgIHJldHVybkxpc3RbbG93ZXN0LmluZGV4XSAgPSBsb3dlc3QudmFsIC0gbG93ZXN0LnZhbCAqIGRlY3JlYXNlRnJhY3Rpb247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybkxpc3QgPSByZXR1cm5MaXN0Lm1hcChpdGVtID0+IE1hdGgucm91bmQoaXRlbSkpO1xuICAgICAgICAgICAgaWYgKHJnYkludEFycmF5Lmxlbmd0aCA+IDMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm5MaXN0LnB1c2gocmdiSW50QXJyYXlbM10pO1xuICAgICAgICAgICAgICAgIHJldHVybiAoYHJnYmEoJHtyZXR1cm5MaXN0LmpvaW4oKX0pYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gKGByZ2IoJHtyZXR1cm5MaXN0LmpvaW4oKX0pYCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByaXZhdGUgZ2V0TG93TWlkSGkoX1JnYkFycmF5OiBudW1iZXJbXSkge1xuICAgICAgICAgICAgY29uc3QgcmdiQXJyYXlDb3B5ICAgICAgICAgPSBfUmdiQXJyYXkuc2xpY2UoKTtcbiAgICAgICAgICAgIGNvbnN0IHJnYkFycmF5V2l0aG91dEFscGhhID0gX1JnYkFycmF5Lmxlbmd0aCA+IDMgPyByZ2JBcnJheUNvcHkucmV2ZXJzZSgpLnNsaWNlKDEpLnJldmVyc2UoKSA6IF9SZ2JBcnJheTtcbiAgICAgICAgICAgIGxldCBoaWdoZXN0ICAgICAgICAgICAgICAgID0ge3ZhbDogLTEsIGluZGV4OiAtMX07XG4gICAgICAgICAgICBsZXQgbG93ZXN0ICAgICAgICAgICAgICAgICA9IHt2YWw6IEluZmluaXR5LCBpbmRleDogLTF9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZ2JBcnJheVdpdGhvdXRBbHBoYS5tYXAoKHZhbCwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodmFsID4gaGlnaGVzdC52YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaGlnaGVzdCA9IHt2YWw6IHZhbCwgaW5kZXg6IGluZGV4fTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHZhbCA8IGxvd2VzdC52YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgbG93ZXN0ID0ge3ZhbDogdmFsLCBpbmRleDogaW5kZXh9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAobG93ZXN0LmluZGV4ID09PSBoaWdoZXN0LmluZGV4KSB7XG4gICAgICAgICAgICAgICAgbG93ZXN0LmluZGV4ID0gaGlnaGVzdC5pbmRleCArIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IG1pZGRsZUluZGV4ID0gKDMgLSBoaWdoZXN0LmluZGV4IC0gbG93ZXN0LmluZGV4KTtcbiAgICAgICAgICAgIGxldCBtaWRkbGUgICAgICAgID0ge3ZhbDogcmdiQXJyYXlXaXRob3V0QWxwaGFbbWlkZGxlSW5kZXhdLCBpbmRleDogbWlkZGxlSW5kZXh9O1xuICAgICAgICAgICAgcmV0dXJuIFtsb3dlc3QsIG1pZGRsZSwgaGlnaGVzdF07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByaXZhdGUgY29udHJhc3QoX0x1bWluYW5jZSkge1xuICAgICAgICAgICAgY29uc3QgYnJpZ2h0ZXN0ID0gTWF0aC5tYXgoMS4wNSwgX0x1bWluYW5jZSArIDAuMDUpO1xuICAgICAgICAgICAgY29uc3QgZGFya2VzdCAgID0gTWF0aC5taW4oMS4wNSwgX0x1bWluYW5jZSArIDAuMDUpO1xuICAgICAgICAgICAgY29uc3QgY29udHJhc3QgID0gKGJyaWdodGVzdCkgLyAoZGFya2VzdCk7XG4gICAgICAgICAgICByZXR1cm4gY29udHJhc3QgPCAzO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBwcml2YXRlIGlzQ29sb3IoX1N0ckNvbG9yKSB7XG4gICAgICAgICAgICBjb25zdCBDU1NEZWNsYXJhdGlvbiA9IG5ldyBPcHRpb24oKS5zdHlsZTtcbiAgICAgICAgICAgIENTU0RlY2xhcmF0aW9uLmNvbG9yID0gX1N0ckNvbG9yO1xuICAgICAgICAgICAgcmV0dXJuICEhQ1NTRGVjbGFyYXRpb24uY29sb3IgPyBDU1NEZWNsYXJhdGlvbi5jb2xvciA6IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByaXZhdGUgZ2V0UkdCQXJyYXkoX1JnYjogc3RyaW5nKTogbnVtYmVyW10ge1xuICAgICAgICAgICAgcmV0dXJuIF9SZ2IucmVwbGFjZSgvXihyZ2J8cmdiYSlcXCgvLCAnJykucmVwbGFjZSgvXFwpJC8sICcnKS5yZXBsYWNlKC9cXHMvZywgJycpLnNwbGl0KCcsJykubWFwKHggPT4gK3gpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBwcml2YXRlIGx1bWluYW5jZShfUmdiOiBzdHJpbmcpIHtcbiAgICAgICAgICAgIGNvbnN0IHJnYkludEFycmF5ID0gdGhpcy5nZXRSR0JBcnJheShfUmdiKTtcbiAgICAgICAgICAgIGNvbnN0IFczYWxnb3JpdGhtID0gcmdiSW50QXJyYXkubWFwKGl0ZW0gPT4ge1xuICAgICAgICAgICAgICAgIGl0ZW0gLz0gMjU1O1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtIDw9IDAuMDM5MjhcbiAgICAgICAgICAgICAgICAgICAgPyBpdGVtIC8gMTIuOTJcbiAgICAgICAgICAgICAgICAgICAgOiBNYXRoLnBvdygoaXRlbSArIDAuMDU1KSAvIDEuMDU1LCAyLjQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gVzNhbGdvcml0aG1bMF0gKiAwLjIxMjYgKyBXM2FsZ29yaXRobVsxXSAqIDAuNzE1MiArIFczYWxnb3JpdGhtWzJdICogMC4wNzIyO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBwcml2YXRlIHRyYW5zcGFyZW50aXplKF9SZ2I6IHN0cmluZywgX1BlcmNlbnRhZ2U6IG51bWJlcikge1xuICAgICAgICAgICAgY29uc3QgYmFzZUFycmF5ID0gdGhpcy5CYXNlLnJlcGxhY2UoL14ocmdifHJnYmEpXFwoLywgJycpLnJlcGxhY2UoL1xcKSQvLCAnJykucmVwbGFjZSgvXFxzL2csICcnKS5zcGxpdCgnLCcpLm1hcCh4ID0+ICt4KTtcbiAgICAgICAgICAgIGlmIChiYXNlQXJyYXkubGVuZ3RoID4gMykge1xuICAgICAgICAgICAgICAgIGJhc2VBcnJheS5wb3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGFtb3VudCA9ICgxMDAgLSBfUGVyY2VudGFnZSkgLyAxMDA7XG4gICAgICAgICAgICBiYXNlQXJyYXkucHVzaChhbW91bnQpO1xuICAgICAgICAgICAgcmV0dXJuIChgcmdiKCR7YmFzZUFycmF5LmpvaW4oKX0pYCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBEYXRhQ29udHJvbCB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAaWdub3JlXG4gICAgICAgICAqL1xuICAgICAgICBwdWJsaWMgY29weVZhbHVlc0Zyb20oX0RhdGE6IGFueSwgX0Rlc3RpbmF0aW9uT2JqZWN0OiBhbnkpOiBhbnkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAodHlwZW9mIF9EYXRhICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIHJldHVybiBfRGVzdGluYXRpb25PYmplY3Q7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGRhdGFLZXlzICAgICAgICAgICAgICA9IE9iamVjdC5rZXlzKF9EYXRhKTtcbiAgICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uT2JqZWN0S2V5cyA9IE9iamVjdC5rZXlzKF9EZXN0aW5hdGlvbk9iamVjdCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGRhdGFLZXlzLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAoZGVzdGluYXRpb25PYmplY3RLZXlzLmZpbmQodEtleSA9PiB0S2V5ID09PSBrZXkgfHwgdEtleSA9PT0gJ18nICsga2V5KSkge1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleS5pbmNsdWRlcygnRGF0ZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRlID0gRGF0ZS5wYXJzZShfRGF0YVtrZXldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX0Rlc3RpbmF0aW9uT2JqZWN0W2tleV0gPSBuZXcgRGF0ZShkYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9EYXRhW2tleV0gIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX0Rlc3RpbmF0aW9uT2JqZWN0W2tleV0gPSBfRGF0YVtrZXldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfRGF0YVtrZXldICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX0Rlc3RpbmF0aW9uT2JqZWN0W2tleV0gPSBfRGF0YVtrZXldO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIF9EZXN0aW5hdGlvbk9iamVjdDtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==
