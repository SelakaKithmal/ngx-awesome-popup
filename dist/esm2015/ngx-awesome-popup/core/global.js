import { ButtonLayoutDisplay } from './enums';
export var GlobalClass;
(function (GlobalClass) {
    class Dispatch {
        constructor() {
            this.Title = null;
            this.Message = null;
        }
    }
    GlobalClass.Dispatch = Dispatch;
    class ButtonMaker {
        constructor(Label, ID, LayoutType = ButtonLayoutDisplay.PRIMARY) {
            this.Label = Label;
            this.ID = ID;
            this.LayoutType = LayoutType;
        }
    }
    GlobalClass.ButtonMaker = ButtonMaker;
    class GlobalUserConfig {
        constructor(_GlobalUserConfig) {
            this.ColorList = new GlobalClass.ColorTypes();
            if (_GlobalUserConfig) {
                const dataControl = new GlobalClass.DataControl();
                dataControl.copyValuesFrom(_GlobalUserConfig, this);
                const colorList = new GlobalClass.ColorTypes();
                this.ColorList = dataControl.copyValuesFrom(this.ColorList, colorList);
            }
        }
    }
    GlobalClass.GlobalUserConfig = GlobalUserConfig;
    class ColorTypes {
        constructor() {
            this.Primary = null;
            this.Secondary = null;
            this.Success = null;
            this.Info = null;
            this.Warning = null;
            this.Danger = null;
            this.Light = null;
            this.Dark = null;
        }
    }
    GlobalClass.ColorTypes = ColorTypes;
    class GlobalConfig {
        constructor() {
            this.DisplayColor = new GlobalClass.DisplayColor();
        }
    }
    GlobalClass.GlobalConfig = GlobalConfig;
    class DisplayColor {
        constructor() {
            this.Primary = null;
            this.Secondary = null;
            this.Success = null;
            this.Info = null;
            this.Warning = null;
            this.Danger = null;
            this.Light = null;
            this.Dark = null;
        }
    }
    GlobalClass.DisplayColor = DisplayColor;
    class ColorProvider {
        constructor(_Color) {
            this.Base = null;
            this.Brighten = null;
            this.BrightenForShade = null;
            this.Darken = null;
            this.DarkenForShade = null;
            this.ContrastColor = null;
            this.TransparentDarkenVariance = null;
            this.BrightShade = null;
            this.IsBaseBright = null;
            if (this.Base = this.isColor(_Color)) {
                this.Brighten = this.brightness(this.Base, 'brighten', 20);
                this.BrightenForShade = this.brightness(this.Base, 'brighten', 10);
                this.Darken = this.brightness(this.Base, 'darken', 20);
                this.DarkenForShade = this.brightness(this.Base, 'darken', 10);
                const luminance = Math.floor(this.luminance(this.Base) * 100);
                const darken = luminance > 50 ? 5 : (luminance > 40 ? 10 : (luminance > 20 ? 15 : luminance));
                const brighten = luminance > 55 ? 65 : (luminance > 45 ? 60 : (luminance > 20 ? 55 : (luminance > 10 ? 45 : 80)));
                this.BrightShade = this.brightness(this.brightness(this.Base, 'darken', darken), 'brighten', brighten);
                this.TransparentDarkenVariance = this.brightness(this.transparentize(this.Base, 80), 'darken', 40);
                if (this.isBright(this.Base)) {
                    this.ContrastColor = 'rgba(58,65,71,0.5)';
                    this.IsBaseBright = true;
                }
                else {
                    this.ContrastColor = 'rgb(255,255,255, 0.7)';
                    this.IsBaseBright = false;
                }
                /*         console.log('%c Color ', `background: ${this.BrightShade}; color: ${this.ContrastColor}`, luminance, darken, brighten);
                           console.log('%c Brighten ', `background: ${this.Brighten}; color: ${this.ContrastColor}`, this.Brighten);
                           console.log('%c BrightenForShade ', `background: ${this.BrightenForShade}; color: ${this.ContrastColor}`, this.BrightenForShade);
                           console.log('%c Darken ', `background: ${this.Darken}; color: ${this.ContrastColor}`, this.Darken);
                           console.log('%c DarkenForShade ', `background: ${this.DarkenForShade}; color: ${this.ContrastColor}`, this.DarkenForShade);*/
            }
        }
        isBright(_Rgb) {
            return this.contrast(this.luminance(_Rgb));
        }
        brightness(_Rgb, _Action, _Percentage) {
            const rgbIntArray = this.getRGBArray(_Rgb);
            const [lowest, middle, highest] = this.getLowMidHi(rgbIntArray);
            if (_Action === 'brighten' && lowest.val === 255) {
                return _Rgb;
            }
            if (_Action === 'darken' && highest.val === 0) {
                return _Rgb;
            }
            const amount = _Percentage / 100 * 255;
            let returnList = [];
            if (_Action === 'brighten') {
                returnList[lowest.index] = Math.round(lowest.val + (Math.min(255 - lowest.val, amount)));
                const increaseFraction = (returnList[lowest.index] - lowest.val) / (255 - lowest.val);
                returnList[middle.index] = middle.val + (255 - middle.val) * increaseFraction;
                returnList[highest.index] = highest.val + (255 - highest.val) * increaseFraction;
            }
            if (_Action === 'darken') {
                returnList[highest.index] = highest.val - (Math.min(highest.val, amount));
                const decreaseFraction = (highest.val - returnList[highest.index]) / (highest.val);
                returnList[middle.index] = middle.val - middle.val * decreaseFraction;
                returnList[lowest.index] = lowest.val - lowest.val * decreaseFraction;
            }
            returnList = returnList.map(item => Math.round(item));
            if (rgbIntArray.length > 3) {
                returnList.push(rgbIntArray[3]);
                return (`rgba(${returnList.join()})`);
            }
            return (`rgb(${returnList.join()})`);
        }
        getLowMidHi(_RgbArray) {
            const rgbArrayCopy = _RgbArray.slice();
            const rgbArrayWithoutAlpha = _RgbArray.length > 3 ? rgbArrayCopy.reverse().slice(1).reverse() : _RgbArray;
            let highest = { val: -1, index: -1 };
            let lowest = { val: Infinity, index: -1 };
            rgbArrayWithoutAlpha.map((val, index) => {
                if (val > highest.val) {
                    highest = { val: val, index: index };
                }
                if (val < lowest.val) {
                    lowest = { val: val, index: index };
                }
            });
            if (lowest.index === highest.index) {
                lowest.index = highest.index + 1;
            }
            const middleIndex = (3 - highest.index - lowest.index);
            let middle = { val: rgbArrayWithoutAlpha[middleIndex], index: middleIndex };
            return [lowest, middle, highest];
        }
        contrast(_Luminance) {
            const brightest = Math.max(1.05, _Luminance + 0.05);
            const darkest = Math.min(1.05, _Luminance + 0.05);
            const contrast = (brightest) / (darkest);
            return contrast < 2.7;
        }
        isColor(_StrColor) {
            const CSSDeclaration = new Option().style;
            CSSDeclaration.color = _StrColor;
            return !!CSSDeclaration.color ? CSSDeclaration.color : null;
        }
        getRGBArray(_Rgb) {
            return _Rgb.replace(/^(rgb|rgba)\(/, '').replace(/\)$/, '').replace(/\s/g, '').split(',').map(x => +x);
        }
        luminance(_Rgb) {
            const rgbIntArray = this.getRGBArray(_Rgb);
            const W3algorithm = rgbIntArray.map(item => {
                item /= 255;
                return item <= 0.03928
                    ? item / 12.92
                    : Math.pow((item + 0.055) / 1.055, 2.4);
            });
            return W3algorithm[0] * 0.2126 + W3algorithm[1] * 0.7152 + W3algorithm[2] * 0.0722;
        }
        transparentize(_Rgb, _Percentage) {
            const baseArray = this.Base.replace(/^(rgb|rgba)\(/, '').replace(/\)$/, '').replace(/\s/g, '').split(',').map(x => +x);
            if (baseArray.length > 3) {
                baseArray.pop();
            }
            const amount = (100 - _Percentage) / 100;
            baseArray.push(amount);
            return (`rgb(${baseArray.join()})`);
        }
    }
    GlobalClass.ColorProvider = ColorProvider;
    class DataControl {
        /**
         * @ignore
         */
        copyValuesFrom(_Data, _DestinationObject) {
            if (typeof _Data !== 'object') {
                return _DestinationObject;
            }
            const dataKeys = Object.keys(_Data);
            const destinationObjectKeys = Object.keys(_DestinationObject);
            dataKeys.forEach(key => {
                if (destinationObjectKeys.find(tKey => tKey === key || tKey === '_' + key)) {
                    if (key.includes('Date')) {
                        const date = Date.parse(_Data[key]);
                        if (date) {
                            _DestinationObject[key] = new Date(date);
                        }
                        else {
                            if (_Data[key] !== null) {
                                _DestinationObject[key] = _Data[key];
                            }
                        }
                    }
                    else {
                        if (_Data[key] !== null) {
                            _DestinationObject[key] = _Data[key];
                        }
                    }
                }
            });
            return _DestinationObject;
        }
    }
    GlobalClass.DataControl = DataControl;
})(GlobalClass || (GlobalClass = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2xvYmFsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vbmd4LWF3ZXNvbWUtcG9wdXAvY29yZS9nbG9iYWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLG1CQUFtQixFQUFDLE1BQU0sU0FBUyxDQUFDO0FBb0c1QyxNQUFNLEtBQVcsV0FBVyxDQTJPM0I7QUEzT0QsV0FBaUIsV0FBVztJQUV4QixNQUFhLFFBQVE7UUFBckI7WUFDSSxVQUFLLEdBQWEsSUFBSSxDQUFDO1lBQ3ZCLFlBQU8sR0FBVyxJQUFJLENBQUM7UUFDM0IsQ0FBQztLQUFBO0lBSFksb0JBQVEsV0FHcEIsQ0FBQTtJQUVELE1BQWEsV0FBVztRQUVwQixZQUFtQixLQUFhLEVBQVMsRUFBVSxFQUFTLGFBQWtDLG1CQUFtQixDQUFDLE9BQU87WUFBdEcsVUFBSyxHQUFMLEtBQUssQ0FBUTtZQUFTLE9BQUUsR0FBRixFQUFFLENBQVE7WUFBUyxlQUFVLEdBQVYsVUFBVSxDQUFtRDtRQUN6SCxDQUFDO0tBQ0o7SUFKWSx1QkFBVyxjQUl2QixDQUFBO0lBRUQsTUFBYSxnQkFBZ0I7UUFHekIsWUFBWSxpQkFBb0Q7WUFGaEUsY0FBUyxHQUFnQyxJQUFJLFdBQVcsQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUdsRSxJQUFJLGlCQUFpQixFQUFDO2dCQUNsQixNQUFNLFdBQVcsR0FBTSxJQUFJLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDckQsV0FBVyxDQUFDLGNBQWMsQ0FBQyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsQ0FBQztnQkFDcEQsTUFBTSxTQUFTLEdBQUcsSUFBSSxXQUFXLENBQUMsVUFBVSxFQUFFLENBQUM7Z0JBQy9DLElBQUksQ0FBQyxTQUFTLEdBQUksV0FBVyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO2FBQzNFO1FBQ0wsQ0FBQztLQUNKO0lBWFksNEJBQWdCLG1CQVc1QixD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bkxheW91dERpc3BsYXl9IGZyb20gJy4vZW51bXMnO1xuXG5leHBvcnQgbmFtZXNwYWNlIEdsb2JhbEludGVyZmFjZSB7XG4gICAgXG4gICAgLyoqXG4gICAgICogRWFjaCBwcm9wZXJ0eSBvZiB7QGxpbmsgQ29sb3JMaXN0fSByZXByZXNlbnQgYSBzdHJpbmcgd2hpY2ggcmVwcmVzZW50IGEgY29sb3IgaW4gaGV4IG9yIHJnYi9yZ2JhIGZvcm1hdC5cbiAgICAgKiBGb3IgYXZhaWxhYmxlIGNvbG9yIHR5cGVzKHByb3BlcnRpZXMpIGNoZWNrIHtAbGluayBJQ29sb3JUeXBlc30gaW50ZXJmYWNlLlxuICAgICAqIEV2ZXJ5IGNvbG9yIGlzIG9wdGlvbmFsLCBhbmQgaXQgd2lsbCByZWZsZWN0IG9uIGRpYWxvZyBvciBidXR0b24gY29sb3IgdHlwZXMgYW5kIGl0cyBjb2xvciBjb250cmFzdCBvciB2YXJpYW5jZS5cbiAgICAgKiAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogLy8gQ29sb3JMaXN0IG9iamVjdCBleGFtcGxlLlxuICAgICAqIGNvbnN0IGNvbG9yTGlzdCA9IHtcbiAgICAgKiAgICAgICAgIENvbG9yTGlzdDoge1xuICAgICAqICAgICAgICAgICAgUHJpbWFyeSAgOiAnI2ZmOWUwMCcsXG4gICAgICogICAgICAgICAgICBTZWNvbmRhcnk6ICcjOTg5ZWE1JyxcbiAgICAgKiAgICAgICAgICAgIEluZm8gICAgIDogJyMyZjhlZTUnLFxuICAgICAqICAgICAgICAgICAgU3VjY2VzcyAgOiAnIzNjYWVhMycsXG4gICAgICogICAgICAgICAgICBXYXJuaW5nICA6ICcjZmZjMTA3JyxcbiAgICAgKiAgICAgICAgICAgIERhbmdlciAgIDogJyNlNDY0NjQnLFxuICAgICAqICAgICAgICAgICAgTGlnaHQgICAgOiAnI2ZiZmJmYicsXG4gICAgICogICAgICAgICAgICBEYXJrICAgICA6ICcjMzQzYTQwJ1xuICAgICAqICAgICAgICAgICB9XG4gICAgICogICAgICAgIH1cbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBleHBvcnQgaW50ZXJmYWNlIElHbG9iYWxVc2VyQ29uZmlnIHtcbiAgICAgICAgQ29sb3JMaXN0PzogR2xvYmFsSW50ZXJmYWNlLklDb2xvclR5cGVzO1xuICAgIH1cbiAgICBcbiAgICBleHBvcnQgaW50ZXJmYWNlIElHbG9iYWxDb25maWcge1xuICAgICAgICBEaXNwbGF5Q29sb3I/OiBHbG9iYWxJbnRlcmZhY2UuSUNvbG9yT2JqZWN0O1xuICAgIH1cbiAgICBcbiAgICBleHBvcnQgaW50ZXJmYWNlIElDb2xvclR5cGVzIHtcbiAgICAgICAgUHJpbWFyeT86IHN0cmluZztcbiAgICAgICAgU2Vjb25kYXJ5Pzogc3RyaW5nO1xuICAgICAgICBTdWNjZXNzPzogc3RyaW5nO1xuICAgICAgICBJbmZvPzogc3RyaW5nO1xuICAgICAgICBXYXJuaW5nPzogc3RyaW5nO1xuICAgICAgICBEYW5nZXI/OiBzdHJpbmc7XG4gICAgICAgIExpZ2h0Pzogc3RyaW5nO1xuICAgICAgICBEYXJrPzogc3RyaW5nO1xuICAgIH1cbiAgICBcbiAgICBleHBvcnQgaW50ZXJmYWNlIElQcml2YXRlUmVzcG9uc2Uge1xuICAgICAgICBcbiAgICAgICAgc2V0QmVsb25naW5nKF9EaWFsb2dCZWxvbmdpbmcpOiB2b2lkXG4gICAgfVxuICAgIFxuICAgIC8qKlxuICAgICAqIEludGVyZmFjZSBmb3IgY3VzdG9tIGJ1dHRvbi5cbiAgICAgKlxuICAgICAqIEV4YW1wbGU6XG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIC8vIEN1c3RvbSBidXR0b24gb2JqZWN0LlxuICAgICAqIGNvbnN0IGJ1dHRvbiA9IHtcbiAgICAgKiAgICAgICAgSUQgICAgICAgICA6ICdjb25maXJtX2J0bicsXG4gICAgICogICAgICAgIExhYmVsOiAgICAgOiAnQ29uZmlybSdcbiAgICAgKiAgICAgICAgTGF5b3V0VHlwZSA6IEJ1dHRvbkxheW91dERpc3BsYXkuU1VDQ0VTU1xuICAgICAqICB9XG4gICAgICogLy8gT3IgaW5zdGFudGlhdGVkIHdpdGggQnV0dG9uTWFrZXIgY2xhc3NcbiAgICAgKiBjb25zdCBidXR0b24yID0gbmV3IEJ1dHRvbk1ha2VyKCdDb25maXJtJywgJ2NvbmZpcm1fYnRuJywgQnV0dG9uTGF5b3V0RGlzcGxheS5TVUNDRVNTKVxuICAgICAqIGBgYFxuICAgICAqICogQnV0dG9uTGF5b3V0RGlzcGxheToge0BsaW5rIEJ1dHRvbkxheW91dERpc3BsYXl9XG4gICAgICovXG4gICAgZXhwb3J0IGludGVyZmFjZSBJQnV0dG9uIHtcbiAgICAgICAgTGFiZWw6IHN0cmluZztcbiAgICAgICAgTGF5b3V0VHlwZTogQnV0dG9uTGF5b3V0RGlzcGxheSB8IG51bGw7XG4gICAgICAgIElEPzogc3RyaW5nO1xuICAgIH1cbiAgICBcbiAgICBleHBvcnQgaW50ZXJmYWNlIElDb2xvck9iamVjdCB7XG4gICAgICAgIFByaW1hcnk/OiBHbG9iYWxJbnRlcmZhY2UuSUNvbG9yUHJvdmlkZXI7XG4gICAgICAgIFNlY29uZGFyeT86IEdsb2JhbEludGVyZmFjZS5JQ29sb3JQcm92aWRlcjtcbiAgICAgICAgU3VjY2Vzcz86IEdsb2JhbEludGVyZmFjZS5JQ29sb3JQcm92aWRlcjtcbiAgICAgICAgSW5mbz86IEdsb2JhbEludGVyZmFjZS5JQ29sb3JQcm92aWRlcjtcbiAgICAgICAgV2FybmluZz86IEdsb2JhbEludGVyZmFjZS5JQ29sb3JQcm92aWRlcjtcbiAgICAgICAgRGFuZ2VyPzogR2xvYmFsSW50ZXJmYWNlLklDb2xvclByb3ZpZGVyO1xuICAgICAgICBMaWdodD86IEdsb2JhbEludGVyZmFjZS5JQ29sb3JQcm92aWRlcjtcbiAgICAgICAgRGFyaz86IEdsb2JhbEludGVyZmFjZS5JQ29sb3JQcm92aWRlcjtcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGludGVyZmFjZSBJQ29sb3JQcm92aWRlciB7XG4gICAgXG4gICAgICAgIEJhc2U6IHN0cmluZztcbiAgICAgICAgQnJpZ2h0ZW46IHN0cmluZztcbiAgICAgICAgQnJpZ2h0ZW5Gb3JTaGFkZTogc3RyaW5nO1xuICAgICAgICBEYXJrZW46IHN0cmluZztcbiAgICAgICAgRGFya2VuRm9yU2hhZGU6IHN0cmluZztcbiAgICAgICAgQ29udHJhc3RDb2xvcjogc3RyaW5nO1xuICAgICAgICBCcmlnaHRTaGFkZTogc3RyaW5nO1xuICAgICAgICBUcmFuc3BhcmVudERhcmtlblZhcmlhbmNlOiBzdHJpbmc7XG4gICAgICAgIElzQmFzZUJyaWdodDogYm9vbGVhbjtcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGludGVyZmFjZSBJRGlzcGF0Y2gge1xuICAgICAgICBUaXRsZTogc3RyaW5nO1xuICAgICAgICBNZXNzYWdlOiBzdHJpbmc7XG4gICAgfVxufVxuXG5leHBvcnQgbmFtZXNwYWNlIEdsb2JhbENsYXNzIHtcbiAgICBcbiAgICBleHBvcnQgY2xhc3MgRGlzcGF0Y2gge1xuICAgICAgICBUaXRsZTogc3RyaW5nICAgPSBudWxsO1xuICAgICAgICBNZXNzYWdlOiBzdHJpbmcgPSBudWxsO1xuICAgIH1cbiAgICBcbiAgICBleHBvcnQgY2xhc3MgQnV0dG9uTWFrZXIgaW1wbGVtZW50cyBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbiB7XG4gICAgICAgIFxuICAgICAgICBjb25zdHJ1Y3RvcihwdWJsaWMgTGFiZWw6IHN0cmluZywgcHVibGljIElEOiBzdHJpbmcsIHB1YmxpYyBMYXlvdXRUeXBlOiBCdXR0b25MYXlvdXREaXNwbGF5ID0gQnV0dG9uTGF5b3V0RGlzcGxheS5QUklNQVJZKSB7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGNsYXNzIEdsb2JhbFVzZXJDb25maWcgaW1wbGVtZW50cyBHbG9iYWxJbnRlcmZhY2UuSUdsb2JhbFVzZXJDb25maWcge1xuICAgICAgICBDb2xvckxpc3Q6IEdsb2JhbEludGVyZmFjZS5JQ29sb3JUeXBlcyA9IG5ldyBHbG9iYWxDbGFzcy5Db2xvclR5cGVzKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdHJ1Y3RvcihfR2xvYmFsVXNlckNvbmZpZzogR2xvYmFsSW50ZXJmYWNlLklHbG9iYWxVc2VyQ29uZmlnKSB7XG4gICAgICAgICAgICBpZiAoX0dsb2JhbFVzZXJDb25maWcpe1xuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFDb250cm9sICAgID0gbmV3IEdsb2JhbENsYXNzLkRhdGFDb250cm9sKCk7XG4gICAgICAgICAgICAgICAgZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20oX0dsb2JhbFVzZXJDb25maWcsIHRoaXMpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yTGlzdCA9IG5ldyBHbG9iYWxDbGFzcy5Db2xvclR5cGVzKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5Db2xvckxpc3QgID0gZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20odGhpcy5Db2xvckxpc3QsIGNvbG9yTGlzdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGNsYXNzIENvbG9yVHlwZXMgaW1wbGVtZW50cyAgR2xvYmFsSW50ZXJmYWNlLklDb2xvclR5cGVzIHtcbiAgICAgICAgUHJpbWFyeTogc3RyaW5nICAgPSBudWxsO1xuICAgICAgICBTZWNvbmRhcnk6IHN0cmluZyA9IG51bGw7XG4gICAgICAgIFN1Y2Nlc3M6IHN0cmluZyAgID0gbnVsbDtcbiAgICAgICAgSW5mbzogc3RyaW5nICAgICAgPSBudWxsO1xuICAgICAgICBXYXJuaW5nOiBzdHJpbmcgICA9IG51bGw7XG4gICAgICAgIERhbmdlcjogc3RyaW5nICAgID0gbnVsbDtcbiAgICAgICAgTGlnaHQ6IHN0cmluZyAgICAgPSBudWxsO1xuICAgICAgICBEYXJrOiBzdHJpbmcgICAgICA9IG51bGw7XG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBHbG9iYWxDb25maWcgaW1wbGVtZW50cyBHbG9iYWxJbnRlcmZhY2UuSUdsb2JhbENvbmZpZyB7XG4gICAgICAgIERpc3BsYXlDb2xvcjogR2xvYmFsSW50ZXJmYWNlLklDb2xvck9iamVjdCA9IG5ldyBHbG9iYWxDbGFzcy5EaXNwbGF5Q29sb3IoKTtcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGNsYXNzIERpc3BsYXlDb2xvciBpbXBsZW1lbnRzIEdsb2JhbEludGVyZmFjZS5JQ29sb3JPYmplY3Qge1xuICAgICAgICBQcmltYXJ5OiBDb2xvclByb3ZpZGVyICAgPSBudWxsO1xuICAgICAgICBTZWNvbmRhcnk6IENvbG9yUHJvdmlkZXIgPSBudWxsO1xuICAgICAgICBTdWNjZXNzOiBDb2xvclByb3ZpZGVyICAgPSBudWxsO1xuICAgICAgICBJbmZvOiBDb2xvclByb3ZpZGVyICAgICAgPSBudWxsO1xuICAgICAgICBXYXJuaW5nOiBDb2xvclByb3ZpZGVyICAgPSBudWxsO1xuICAgICAgICBEYW5nZXI6IENvbG9yUHJvdmlkZXIgICAgPSBudWxsO1xuICAgICAgICBMaWdodDogQ29sb3JQcm92aWRlciAgICAgPSBudWxsO1xuICAgICAgICBEYXJrOiBDb2xvclByb3ZpZGVyICAgICAgPSBudWxsO1xuICAgIH1cbiAgICBcbiAgICBleHBvcnQgY2xhc3MgQ29sb3JQcm92aWRlciB7XG4gICAgICAgIFxuICAgICAgICBCYXNlOiBzdHJpbmcgICAgICAgICAgICAgICAgICAgICAgPSBudWxsO1xuICAgICAgICBCcmlnaHRlbjogc3RyaW5nICAgICAgICAgICAgICAgICAgPSBudWxsO1xuICAgICAgICBCcmlnaHRlbkZvclNoYWRlOiBzdHJpbmcgICAgICAgICAgPSBudWxsO1xuICAgICAgICBEYXJrZW46IHN0cmluZyAgICAgICAgICAgICAgICAgICAgPSBudWxsO1xuICAgICAgICBEYXJrZW5Gb3JTaGFkZTogc3RyaW5nICAgICAgICAgICAgPSBudWxsO1xuICAgICAgICBDb250cmFzdENvbG9yOiBzdHJpbmcgICAgICAgICAgICAgPSBudWxsO1xuICAgICAgICBUcmFuc3BhcmVudERhcmtlblZhcmlhbmNlOiBzdHJpbmcgPSBudWxsO1xuICAgICAgICBCcmlnaHRTaGFkZTogc3RyaW5nICAgICAgICAgICAgICAgPSBudWxsO1xuICAgICAgICBJc0Jhc2VCcmlnaHQ6IGJvb2xlYW4gICAgICAgICAgICAgPSBudWxsO1xuICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIGNvbnN0cnVjdG9yKF9Db2xvcjogc3RyaW5nKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5CYXNlID0gdGhpcy5pc0NvbG9yKF9Db2xvcikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLkJyaWdodGVuICAgICAgICAgICAgICAgICAgPSB0aGlzLmJyaWdodG5lc3ModGhpcy5CYXNlLCAnYnJpZ2h0ZW4nLCAyMCk7XG4gICAgICAgICAgICAgICAgdGhpcy5CcmlnaHRlbkZvclNoYWRlICAgICAgICAgID0gdGhpcy5icmlnaHRuZXNzKHRoaXMuQmFzZSwgJ2JyaWdodGVuJywgMTApO1xuICAgICAgICAgICAgICAgIHRoaXMuRGFya2VuICAgICAgICAgICAgICAgICAgICA9IHRoaXMuYnJpZ2h0bmVzcyh0aGlzLkJhc2UsICdkYXJrZW4nLCAyMCk7XG4gICAgICAgICAgICAgICAgdGhpcy5EYXJrZW5Gb3JTaGFkZSAgICAgICAgICAgID0gdGhpcy5icmlnaHRuZXNzKHRoaXMuQmFzZSwgJ2RhcmtlbicsIDEwKTtcbiAgICAgICAgICAgICAgICBjb25zdCBsdW1pbmFuY2UgICAgICAgICAgICAgICAgPSBNYXRoLmZsb29yKHRoaXMubHVtaW5hbmNlKHRoaXMuQmFzZSkgKiAxMDApO1xuICAgICAgICAgICAgICAgIGNvbnN0IGRhcmtlbiAgICAgICAgICAgICAgICAgICA9IGx1bWluYW5jZSA+IDUwID8gNSA6IChsdW1pbmFuY2UgPiA0MCA/IDEwIDogKGx1bWluYW5jZSA+IDIwID8gMTUgOiBsdW1pbmFuY2UpKTtcbiAgICAgICAgICAgICAgICBjb25zdCBicmlnaHRlbiAgICAgICAgICAgICAgICAgPSBsdW1pbmFuY2UgPiA1NSA/IDY1IDogKGx1bWluYW5jZSA+IDQ1ID8gNjAgOiAobHVtaW5hbmNlID4gMjAgPyA1NSA6IChsdW1pbmFuY2UgPiAxMCA/IDQ1IDogODApKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5CcmlnaHRTaGFkZSAgICAgICAgICAgICAgID0gdGhpcy5icmlnaHRuZXNzKHRoaXMuYnJpZ2h0bmVzcyh0aGlzLkJhc2UsICdkYXJrZW4nLCBkYXJrZW4pLCAnYnJpZ2h0ZW4nLCBicmlnaHRlbik7XG4gICAgICAgICAgICAgICAgdGhpcy5UcmFuc3BhcmVudERhcmtlblZhcmlhbmNlID0gdGhpcy5icmlnaHRuZXNzKHRoaXMudHJhbnNwYXJlbnRpemUodGhpcy5CYXNlLCA4MCksICdkYXJrZW4nLCA0MCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNCcmlnaHQodGhpcy5CYXNlKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkNvbnRyYXN0Q29sb3IgPSAncmdiYSg1OCw2NSw3MSwwLjUpJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5Jc0Jhc2VCcmlnaHQgID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLkNvbnRyYXN0Q29sb3IgPSAncmdiKDI1NSwyNTUsMjU1LCAwLjcpJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5Jc0Jhc2VCcmlnaHQgID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8qICAgICAgICAgY29uc29sZS5sb2coJyVjIENvbG9yICcsIGBiYWNrZ3JvdW5kOiAke3RoaXMuQnJpZ2h0U2hhZGV9OyBjb2xvcjogJHt0aGlzLkNvbnRyYXN0Q29sb3J9YCwgbHVtaW5hbmNlLCBkYXJrZW4sIGJyaWdodGVuKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCclYyBCcmlnaHRlbiAnLCBgYmFja2dyb3VuZDogJHt0aGlzLkJyaWdodGVufTsgY29sb3I6ICR7dGhpcy5Db250cmFzdENvbG9yfWAsIHRoaXMuQnJpZ2h0ZW4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJyVjIEJyaWdodGVuRm9yU2hhZGUgJywgYGJhY2tncm91bmQ6ICR7dGhpcy5CcmlnaHRlbkZvclNoYWRlfTsgY29sb3I6ICR7dGhpcy5Db250cmFzdENvbG9yfWAsIHRoaXMuQnJpZ2h0ZW5Gb3JTaGFkZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnJWMgRGFya2VuICcsIGBiYWNrZ3JvdW5kOiAke3RoaXMuRGFya2VufTsgY29sb3I6ICR7dGhpcy5Db250cmFzdENvbG9yfWAsIHRoaXMuRGFya2VuKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCclYyBEYXJrZW5Gb3JTaGFkZSAnLCBgYmFja2dyb3VuZDogJHt0aGlzLkRhcmtlbkZvclNoYWRlfTsgY29sb3I6ICR7dGhpcy5Db250cmFzdENvbG9yfWAsIHRoaXMuRGFya2VuRm9yU2hhZGUpOyovXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByaXZhdGUgaXNCcmlnaHQoX1JnYjogc3RyaW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb250cmFzdCh0aGlzLmx1bWluYW5jZShfUmdiKSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByaXZhdGUgYnJpZ2h0bmVzcyhfUmdiOiBzdHJpbmcsIF9BY3Rpb246ICdicmlnaHRlbicgfCAnZGFya2VuJywgX1BlcmNlbnRhZ2U6IG51bWJlcik6IHN0cmluZyB7XG4gICAgICAgICAgICBjb25zdCByZ2JJbnRBcnJheSAgICAgICAgICAgICAgID0gdGhpcy5nZXRSR0JBcnJheShfUmdiKTtcbiAgICAgICAgICAgIGNvbnN0IFtsb3dlc3QsIG1pZGRsZSwgaGlnaGVzdF0gPSB0aGlzLmdldExvd01pZEhpKHJnYkludEFycmF5KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKF9BY3Rpb24gPT09ICdicmlnaHRlbicgJiYgbG93ZXN0LnZhbCA9PT0gMjU1KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF9SZ2I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChfQWN0aW9uID09PSAnZGFya2VuJyAmJiBoaWdoZXN0LnZhbCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBfUmdiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBhbW91bnQgPSBfUGVyY2VudGFnZSAvIDEwMCAqIDI1NTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbGV0IHJldHVybkxpc3QgPSBbXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKF9BY3Rpb24gPT09ICdicmlnaHRlbicpIHtcbiAgICAgICAgICAgICAgICByZXR1cm5MaXN0W2xvd2VzdC5pbmRleF0gID0gTWF0aC5yb3VuZChsb3dlc3QudmFsICsgKE1hdGgubWluKDI1NSAtIGxvd2VzdC52YWwsIGFtb3VudCkpKTtcbiAgICAgICAgICAgICAgICBjb25zdCBpbmNyZWFzZUZyYWN0aW9uICAgID0gKHJldHVybkxpc3RbbG93ZXN0LmluZGV4XSAtIGxvd2VzdC52YWwpIC8gKDI1NSAtIGxvd2VzdC52YWwpO1xuICAgICAgICAgICAgICAgIHJldHVybkxpc3RbbWlkZGxlLmluZGV4XSAgPSBtaWRkbGUudmFsICsgKDI1NSAtIG1pZGRsZS52YWwpICogaW5jcmVhc2VGcmFjdGlvbjtcbiAgICAgICAgICAgICAgICByZXR1cm5MaXN0W2hpZ2hlc3QuaW5kZXhdID0gaGlnaGVzdC52YWwgKyAoMjU1IC0gaGlnaGVzdC52YWwpICogaW5jcmVhc2VGcmFjdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChfQWN0aW9uID09PSAnZGFya2VuJykge1xuICAgICAgICAgICAgICAgIHJldHVybkxpc3RbaGlnaGVzdC5pbmRleF0gPSBoaWdoZXN0LnZhbCAtIChNYXRoLm1pbihoaWdoZXN0LnZhbCwgYW1vdW50KSk7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVjcmVhc2VGcmFjdGlvbiAgICA9IChoaWdoZXN0LnZhbCAtIHJldHVybkxpc3RbaGlnaGVzdC5pbmRleF0pIC8gKGhpZ2hlc3QudmFsKTtcbiAgICAgICAgICAgICAgICByZXR1cm5MaXN0W21pZGRsZS5pbmRleF0gID0gbWlkZGxlLnZhbCAtIG1pZGRsZS52YWwgKiBkZWNyZWFzZUZyYWN0aW9uO1xuICAgICAgICAgICAgICAgIHJldHVybkxpc3RbbG93ZXN0LmluZGV4XSAgPSBsb3dlc3QudmFsIC0gbG93ZXN0LnZhbCAqIGRlY3JlYXNlRnJhY3Rpb247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybkxpc3QgPSByZXR1cm5MaXN0Lm1hcChpdGVtID0+IE1hdGgucm91bmQoaXRlbSkpO1xuICAgICAgICAgICAgaWYgKHJnYkludEFycmF5Lmxlbmd0aCA+IDMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm5MaXN0LnB1c2gocmdiSW50QXJyYXlbM10pO1xuICAgICAgICAgICAgICAgIHJldHVybiAoYHJnYmEoJHtyZXR1cm5MaXN0LmpvaW4oKX0pYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gKGByZ2IoJHtyZXR1cm5MaXN0LmpvaW4oKX0pYCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByaXZhdGUgZ2V0TG93TWlkSGkoX1JnYkFycmF5OiBudW1iZXJbXSkge1xuICAgICAgICAgICAgY29uc3QgcmdiQXJyYXlDb3B5ICAgICAgICAgPSBfUmdiQXJyYXkuc2xpY2UoKTtcbiAgICAgICAgICAgIGNvbnN0IHJnYkFycmF5V2l0aG91dEFscGhhID0gX1JnYkFycmF5Lmxlbmd0aCA+IDMgPyByZ2JBcnJheUNvcHkucmV2ZXJzZSgpLnNsaWNlKDEpLnJldmVyc2UoKSA6IF9SZ2JBcnJheTtcbiAgICAgICAgICAgIGxldCBoaWdoZXN0ICAgICAgICAgICAgICAgID0ge3ZhbDogLTEsIGluZGV4OiAtMX07XG4gICAgICAgICAgICBsZXQgbG93ZXN0ICAgICAgICAgICAgICAgICA9IHt2YWw6IEluZmluaXR5LCBpbmRleDogLTF9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZ2JBcnJheVdpdGhvdXRBbHBoYS5tYXAoKHZhbCwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodmFsID4gaGlnaGVzdC52YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaGlnaGVzdCA9IHt2YWw6IHZhbCwgaW5kZXg6IGluZGV4fTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHZhbCA8IGxvd2VzdC52YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgbG93ZXN0ID0ge3ZhbDogdmFsLCBpbmRleDogaW5kZXh9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAobG93ZXN0LmluZGV4ID09PSBoaWdoZXN0LmluZGV4KSB7XG4gICAgICAgICAgICAgICAgbG93ZXN0LmluZGV4ID0gaGlnaGVzdC5pbmRleCArIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IG1pZGRsZUluZGV4ID0gKDMgLSBoaWdoZXN0LmluZGV4IC0gbG93ZXN0LmluZGV4KTtcbiAgICAgICAgICAgIGxldCBtaWRkbGUgICAgICAgID0ge3ZhbDogcmdiQXJyYXlXaXRob3V0QWxwaGFbbWlkZGxlSW5kZXhdLCBpbmRleDogbWlkZGxlSW5kZXh9O1xuICAgICAgICAgICAgcmV0dXJuIFtsb3dlc3QsIG1pZGRsZSwgaGlnaGVzdF07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByaXZhdGUgY29udHJhc3QoX0x1bWluYW5jZSkge1xuICAgICAgICAgICAgY29uc3QgYnJpZ2h0ZXN0ID0gTWF0aC5tYXgoMS4wNSwgX0x1bWluYW5jZSArIDAuMDUpO1xuICAgICAgICAgICAgY29uc3QgZGFya2VzdCAgID0gTWF0aC5taW4oMS4wNSwgX0x1bWluYW5jZSArIDAuMDUpO1xuICAgICAgICAgICAgY29uc3QgY29udHJhc3QgID0gKGJyaWdodGVzdCkgLyAoZGFya2VzdCk7XG4gICAgICAgICAgICByZXR1cm4gY29udHJhc3QgPCAyLjc7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByaXZhdGUgaXNDb2xvcihfU3RyQ29sb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IENTU0RlY2xhcmF0aW9uID0gbmV3IE9wdGlvbigpLnN0eWxlO1xuICAgICAgICAgICAgQ1NTRGVjbGFyYXRpb24uY29sb3IgPSBfU3RyQ29sb3I7XG4gICAgICAgICAgICByZXR1cm4gISFDU1NEZWNsYXJhdGlvbi5jb2xvciA/IENTU0RlY2xhcmF0aW9uLmNvbG9yIDogbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcHJpdmF0ZSBnZXRSR0JBcnJheShfUmdiOiBzdHJpbmcpOiBudW1iZXJbXSB7XG4gICAgICAgICAgICByZXR1cm4gX1JnYi5yZXBsYWNlKC9eKHJnYnxyZ2JhKVxcKC8sICcnKS5yZXBsYWNlKC9cXCkkLywgJycpLnJlcGxhY2UoL1xccy9nLCAnJykuc3BsaXQoJywnKS5tYXAoeCA9PiAreCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByaXZhdGUgbHVtaW5hbmNlKF9SZ2I6IHN0cmluZykge1xuICAgICAgICAgICAgY29uc3QgcmdiSW50QXJyYXkgPSB0aGlzLmdldFJHQkFycmF5KF9SZ2IpO1xuICAgICAgICAgICAgY29uc3QgVzNhbGdvcml0aG0gPSByZ2JJbnRBcnJheS5tYXAoaXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgaXRlbSAvPSAyNTU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0gPD0gMC4wMzkyOFxuICAgICAgICAgICAgICAgICAgICA/IGl0ZW0gLyAxMi45MlxuICAgICAgICAgICAgICAgICAgICA6IE1hdGgucG93KChpdGVtICsgMC4wNTUpIC8gMS4wNTUsIDIuNCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBXM2FsZ29yaXRobVswXSAqIDAuMjEyNiArIFczYWxnb3JpdGhtWzFdICogMC43MTUyICsgVzNhbGdvcml0aG1bMl0gKiAwLjA3MjI7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHByaXZhdGUgdHJhbnNwYXJlbnRpemUoX1JnYjogc3RyaW5nLCBfUGVyY2VudGFnZTogbnVtYmVyKSB7XG4gICAgICAgICAgICBjb25zdCBiYXNlQXJyYXkgPSB0aGlzLkJhc2UucmVwbGFjZSgvXihyZ2J8cmdiYSlcXCgvLCAnJykucmVwbGFjZSgvXFwpJC8sICcnKS5yZXBsYWNlKC9cXHMvZywgJycpLnNwbGl0KCcsJykubWFwKHggPT4gK3gpO1xuICAgICAgICAgICAgaWYgKGJhc2VBcnJheS5sZW5ndGggPiAzKSB7XG4gICAgICAgICAgICAgICAgYmFzZUFycmF5LnBvcCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgYW1vdW50ID0gKDEwMCAtIF9QZXJjZW50YWdlKSAvIDEwMDtcbiAgICAgICAgICAgIGJhc2VBcnJheS5wdXNoKGFtb3VudCk7XG4gICAgICAgICAgICByZXR1cm4gKGByZ2IoJHtiYXNlQXJyYXkuam9pbigpfSlgKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGNsYXNzIERhdGFDb250cm9sIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBpZ25vcmVcbiAgICAgICAgICovXG4gICAgICAgIHB1YmxpYyBjb3B5VmFsdWVzRnJvbShfRGF0YTogYW55LCBfRGVzdGluYXRpb25PYmplY3Q6IGFueSk6IGFueSB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICh0eXBlb2YgX0RhdGEgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF9EZXN0aW5hdGlvbk9iamVjdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgZGF0YUtleXMgICAgICAgICAgICAgID0gT2JqZWN0LmtleXMoX0RhdGEpO1xuICAgICAgICAgICAgY29uc3QgZGVzdGluYXRpb25PYmplY3RLZXlzID0gT2JqZWN0LmtleXMoX0Rlc3RpbmF0aW9uT2JqZWN0KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZGF0YUtleXMuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmIChkZXN0aW5hdGlvbk9iamVjdEtleXMuZmluZCh0S2V5ID0+IHRLZXkgPT09IGtleSB8fCB0S2V5ID09PSAnXycgKyBrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5LmluY2x1ZGVzKCdEYXRlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBEYXRlLnBhcnNlKF9EYXRhW2tleV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRGVzdGluYXRpb25PYmplY3Rba2V5XSA9IG5ldyBEYXRlKGRhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX0RhdGFba2V5XSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRGVzdGluYXRpb25PYmplY3Rba2V5XSA9IF9EYXRhW2tleV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9EYXRhW2tleV0gIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRGVzdGluYXRpb25PYmplY3Rba2V5XSA9IF9EYXRhW2tleV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4gX0Rlc3RpbmF0aW9uT2JqZWN0O1xuICAgICAgICB9XG4gICAgfVxufVxuIl19