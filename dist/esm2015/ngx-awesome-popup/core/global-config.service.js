import { Inject, Injectable } from '@angular/core';
import { GlobalClass } from './global';
import { ColorVariance } from './enums';
import * as i0 from "@angular/core";
export class GlobalConfigService {
    constructor(userGlobalConfig) {
        this.userGlobalConfig = userGlobalConfig;
        this.productionGlobalConfig = new GlobalClass.GlobalConfig();
        this.authorGlobalConfig = new GlobalClass.GlobalConfig();
        userGlobalConfig = new GlobalClass.GlobalUserConfig(userGlobalConfig);
        // region *** author global config values (if there is no user input) ***
        this.authorGlobalConfig.DisplayColor.Primary = null; // new GlobalClass.ColorProvider('#ff9e00');
        this.authorGlobalConfig.DisplayColor.Secondary = null; // new GlobalClass.ColorProvider('#989ea5');
        this.authorGlobalConfig.DisplayColor.Success = null; // new GlobalClass.ColorProvider('#3caea3');
        this.authorGlobalConfig.DisplayColor.Info = null; // new GlobalClass.ColorProvider('#2f8ee5');
        this.authorGlobalConfig.DisplayColor.Warning = null; // new GlobalClass.ColorProvider('#ffc107');
        this.authorGlobalConfig.DisplayColor.Danger = null; // new GlobalClass.ColorProvider('#e46464');
        this.authorGlobalConfig.DisplayColor.Light = null; // new GlobalClass.ColorProvider('#f8f9fa');
        this.authorGlobalConfig.DisplayColor.Dark = null; // new GlobalClass.ColorProvider('#343a40');
        // endregion
        this.productionGlobalConfig.DisplayColor = this.authorGlobalConfig.DisplayColor;
        // region *** global userConfig (user input app-module) ***
        this.setUserColors(userGlobalConfig.ColorList);
        // endregion
        this.setToastNode();
        this.setNodeStyles(this.productionGlobalConfig.DisplayColor);
    }
    setNodeStyles(_ProductionColorTypes) {
        Object.keys(_ProductionColorTypes).forEach(key => {
            if (_ProductionColorTypes[key]) {
                this.setButtonStyling(key, _ProductionColorTypes[key]);
                this.setToastStyling(key, _ProductionColorTypes[key]);
                this.setDialogFrame(key, _ProductionColorTypes[key]);
                if (ColorVariance[key.toUpperCase()] === ColorVariance.PRIMARY) {
                    this.getSheet().addRule('.ngx-awesome-popup-overlay', `background:  ${_ProductionColorTypes[key].TransparentDarkenVariance}!important;`);
                }
            }
        });
    }
    setToastStyling(_Key, _ColorProvider) {
        const baseClass = `.overlay-toast .evolve-toast.${_Key.toLowerCase()}-dialog`;
        const baseStyle = `
        background:  ${_ColorProvider.BrightShade}!important;
        border-color: ${_ColorProvider.Brighten}!important;
        `;
        this.getSheet().addRule(baseClass, baseStyle);
    }
    setButtonStyling(_Key, _ColorProvider) {
        const baseButtonClass = `.ed-btn-${_Key.toLowerCase()}`;
        const baseStyle = `
        color: ${_ColorProvider.ContrastColor}!important;
        background:  ${_ColorProvider.Base}!important;
        border-color: ${_ColorProvider.BrightenForShade}!important;
        `;
        const hoverButtonClass = `.ed-btn-${_Key.toLowerCase()}:hover`;
        const hoverStyle = `
        background:  ${_ColorProvider.IsBaseBright ? _ColorProvider.DarkenForShade : _ColorProvider.BrightenForShade}!important;
        border-color: ${_ColorProvider.IsBaseBright ? _ColorProvider.Darken : _ColorProvider.Brighten}!important;
        `;
        const focusActiveButtonClass = `.ed-btn-${_Key.toLowerCase()}:focus, .ed-btn-${_Key.toLowerCase()}:active`;
        const focusActiveStyle = `
        box-shadow: 0 0 1px 2px ${_ColorProvider.IsBaseBright ? _ColorProvider.Darken : _ColorProvider.Brighten}!important;
        `;
        this.getSheet().addRule(baseButtonClass, baseStyle);
        this.getSheet().addRule(hoverButtonClass, hoverStyle);
        this.getSheet().addRule(focusActiveButtonClass, focusActiveStyle);
    }
    setDialogFrame(_Key, _ColorProvider) {
        const baseDialogFrameClass = `.ngx-awesome-popup-overlay .${_Key.toLowerCase()}-dialog`;
        const baseStyle = `
        border-color: ${_ColorProvider.Brighten}!important;
        `;
        this.getSheet().addRule(baseDialogFrameClass, baseStyle);
    }
    getSheet() {
        // Create the <style> tag
        let evolveDialogStyleNode = document.getElementById('ngx-awesome-popup-styles');
        if (!evolveDialogStyleNode) {
            const headNode = document.head || document.getElementsByTagName('head')[0];
            if (!headNode) {
                return;
            }
            evolveDialogStyleNode = document.createElement('style');
            evolveDialogStyleNode.setAttribute('id', 'ngx-awesome-popup-styles');
            evolveDialogStyleNode.appendChild(document.createTextNode(''));
            headNode.appendChild(evolveDialogStyleNode);
        }
        return evolveDialogStyleNode ? evolveDialogStyleNode.sheet : null;
    }
    ;
    setToastNode() {
        const bodyNode = document.body || document.getElementsByTagName('body')[0];
        if (!bodyNode) {
            return;
        }
        const toastWrapper = document.createElement('div');
        toastWrapper.setAttribute('id', 'toast-wrapper');
        toastWrapper.appendChild(document.createTextNode(''));
        bodyNode.prepend(toastWrapper);
        // bodyNode.appendChild(toastWrapper);
        this.getSheet().addRule(`#toast-wrapper`, `position: fixed;
                                        z-index: 1001;
                                        top: 20px;
                                        right: 20px;`);
        this.getSheet().addRule(`.toast-entity`, `all 0.5s ease;`);
        this.getSheet().addRule(`.toast-entity:first-child`, `animation: move 0.7s ease-out;`);
        this.getSheet().addRule(`@-webkit-keyframes move`, `
                                        0% {margin-top: -5px; opacity: 0.4;}
                                        30% {margin-top: -4px; opacity: 0.7;}
                                        100% {margin-top: 0px; opacity: 1;}
                                        `);
        this.getSheet().addRule(`@keyframes move`, `
                                        0% {margin-top: -5px; opacity: 0.4;}
                                        30% {margin-top: -4px; opacity: 0.7;}
                                        100% {margin-top: 0px; opacity: 1;}
                                        `);
    }
    setUserColors(_UserColorTypes) {
        if (typeof _UserColorTypes !== 'object') {
            return;
        }
        const userKeys = Object.keys(_UserColorTypes);
        const productionObjectKeys = Object.keys(this.productionGlobalConfig.DisplayColor);
        userKeys.forEach(key => {
            if (productionObjectKeys.find(tKey => tKey === key)) {
                const baseColorProvider = new GlobalClass.ColorProvider(_UserColorTypes[key]);
                if (baseColorProvider.Base) {
                    this.productionGlobalConfig.DisplayColor[key] = baseColorProvider;
                }
            }
        });
    }
}
GlobalConfigService.ɵprov = i0.ɵɵdefineInjectable({ factory: function GlobalConfigService_Factory() { return new GlobalConfigService(i0.ɵɵinject("globalConfig")); }, token: GlobalConfigService, providedIn: "root" });
GlobalConfigService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
GlobalConfigService.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: ['globalConfig',] }] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2xvYmFsLWNvbmZpZy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vbmd4LWF3ZXNvbWUtcG9wdXAvY29yZS9nbG9iYWwtY29uZmlnLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLE1BQU0sRUFBRSxVQUFVLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDakQsT0FBTyxFQUFDLFdBQVcsRUFBa0IsTUFBTSxVQUFVLENBQUM7QUFDdEQsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLFNBQVMsQ0FBQzs7QUFPdEMsTUFBTSxPQUFPLG1CQUFtQjtJQUs1QixZQUE0QyxnQkFBbUQ7UUFBbkQscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFtQztRQUgvRiwyQkFBc0IsR0FBc0MsSUFBSSxXQUFXLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDbkYsdUJBQWtCLEdBQWtDLElBQUksV0FBVyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBR3ZGLGdCQUFnQixHQUFHLElBQUksV0FBVyxDQUFDLGdCQUFnQixDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFFdEUseUVBQXlFO1FBQ3pFLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxZQUFZLENBQUMsT0FBTyxHQUFLLElBQUksQ0FBQyxDQUFDLDRDQUE0QztRQUNuRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsWUFBWSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsQ0FBQyw0Q0FBNEM7UUFDbkcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFlBQVksQ0FBQyxPQUFPLEdBQUssSUFBSSxDQUFDLENBQUMsNENBQTRDO1FBQ25HLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxZQUFZLENBQUMsSUFBSSxHQUFRLElBQUksQ0FBQyxDQUFDLDRDQUE0QztRQUNuRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsWUFBWSxDQUFDLE9BQU8sR0FBSyxJQUFJLENBQUMsQ0FBQyw0Q0FBNEM7UUFDbkcsSUFB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QUFpQixFQUFFOzs7O3lDQUlWLENBQUMsQ0FBQztJQUV2QyxDQUFDO0lBRU8sYUFBYSxDQUFDLGVBQTRDO1FBRTlELElBQUksT0FBTyxlQUFlLEtBQUssUUFBUSxFQUFFO1lBQ3JDLE9BQU87U0FDVjtRQUVELE1BQU0sUUFBUSxHQUFlLE1BQU0sQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDMUQsTUFBTSxvQkFBb0IsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUVuRixRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBRW5CLElBQUksb0JBQW9CLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxFQUFFO2dCQUNqRCxNQUFNLGlCQUFpQixHQUFHLElBQUksV0FBVyxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDOUUsSUFBSSxpQkFBaUIsQ0FBQyxJQUFJLEVBQUU7b0JBRXhCLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLEdBQUcsaUJBQWlCLENBQUM7aUJBQ3JFO2FBQ0o7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUVQLENBQUM7Ozs7WUF6S0osVUFBVSxTQUFDO2dCQUNSLFVBQVUsRUFBRSxNQUFNO2FBQ3JCOzs7NENBTWdCLE1BQU0sU0FBQyxjQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtJbmplY3QsIEluamVjdGFibGV9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtHbG9iYWxDbGFzcywgR2xvYmFsSW50ZXJmYWNlfSBmcm9tICcuL2dsb2JhbCc7XG5pbXBvcnQge0NvbG9yVmFyaWFuY2V9IGZyb20gJy4vZW51bXMnO1xuaW1wb3J0IElDb2xvclByb3ZpZGVyID0gR2xvYmFsSW50ZXJmYWNlLklDb2xvclByb3ZpZGVyO1xuaW1wb3J0IHtDb25maXJtQm94Q2xhc3N9IGZyb20gJy4uL3R5cGVzL2NvbmZpcm0tYm94L2NvcmUvbW9kZWwnO1xuXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIEdsb2JhbENvbmZpZ1NlcnZpY2Uge1xuICAgIFxuICAgIHByb2R1Y3Rpb25HbG9iYWxDb25maWc6IEdsb2JhbEludGVyZmFjZS5JR2xvYmFsQ29uZmlnICAgICA9IG5ldyBHbG9iYWxDbGFzcy5HbG9iYWxDb25maWcoKTtcbiAgICBwcml2YXRlIGF1dGhvckdsb2JhbENvbmZpZzogR2xvYmFsSW50ZXJmYWNlLklHbG9iYWxDb25maWcgPSBuZXcgR2xvYmFsQ2xhc3MuR2xvYmFsQ29uZmlnKCk7XG4gICAgXG4gICAgY29uc3RydWN0b3IoQEluamVjdCgnZ2xvYmFsQ29uZmlnJykgcHJpdmF0ZSB1c2VyR2xvYmFsQ29uZmlnOiBHbG9iYWxJbnRlcmZhY2UuSUdsb2JhbFVzZXJDb25maWcpIHtcbiAgICAgICAgdXNlckdsb2JhbENvbmZpZyA9IG5ldyBHbG9iYWxDbGFzcy5HbG9iYWxVc2VyQ29uZmlnKHVzZXJHbG9iYWxDb25maWcpO1xuXG4gICAgICAgIC8vIHJlZ2lvbiAqKiogYXV0aG9yIGdsb2JhbCBjb25maWcgdmFsdWVzIChpZiB0aGVyZSBpcyBubyB1c2VyIGlucHV0KSAqKipcbiAgICAgICAgdGhpcy5hdXRob3JHbG9iYWxDb25maWcuRGlzcGxheUNvbG9yLlByaW1hcnkgICA9IG51bGw7IC8vIG5ldyBHbG9iYWxDbGFzcy5Db2xvclByb3ZpZGVyKCcjZmY5ZTAwJyk7XG4gICAgICAgIHRoaXMuYXV0aG9yR2xvYmFsQ29uZmlnLkRpc3BsYXlDb2xvci5TZWNvbmRhcnkgPSBudWxsOyAvLyBuZXcgR2xvYmFsQ2xhc3MuQ29sb3JQcm92aWRlcignIzk4OWVhNScpO1xuICAgICAgICB0aGlzLmF1dGhvckdsb2JhbENvbmZpZy5EaXNwbGF5Q29sb3IuU3VjY2VzcyAgID0gbnVsbDsgLy8gbmV3IEdsb2JhbENsYXNzLkNvbG9yUHJvdmlkZXIoJyMzY2FlYTMnKTtcbiAgICAgICAgdGhpcy5hdXRob3JHbG9iYWxDb25maWcuRGlzcGxheUNvbG9yLkluZm8gICAgICA9IG51bGw7IC8vIG5ldyBHbG9iYWxDbGFzcy5Db2xvclByb3ZpZGVyKCcjMmY4ZWU1Jyk7XG4gICAgICAgIHRoaXMuYXV0aG9yR2xvYmFsQ29uZmlnLkRpc3BsYXlDb2xvci5XYXJuaW5nICAgPSBudWxsOyAvLyBuZXcgR2xvYmFsQ2xhc3MuQ29sb3JQcm92aWRlcignI2ZmYzEwNycpO1xuICAgICAgICB0aGlzLmF1dGhvckdsb2JhbENvbmZpZy5EaXNwbGF5Q29sb3IuRGFuZ2VyICAgID0gbnVsbDsgLy8gbmV3IEdsb2JhbENsYXNzLkNvbG9yUHJvdmlkZXIoJyNlNDY0NjQnKTtcbiAgICAgICAgdGhpcy5hdXRob3JHbG9iYWxDb25maWcuRGlzcGxheUNvbG9yLkxpZ2h0ICAgICA9IG51bGw7IC8vIG5ldyBHbG9iYWxDbGFzcy5Db2xvclByb3ZpZGVyKCcjZjhmOWZhJyk7XG4gICAgICAgIHRoaXMuYXV0aG9yR2xvYmFsQ29uZmlnLkRpc3BsYXlDb2xvci5EYXJrICAgICAgPSBudWxsOyAvLyBuZXcgR2xvYmFsQ2xhc3MuQ29sb3JQcm92aWRlcignIzM0M2E0MCcpO1xuICAgICAgICAvLyBlbmRyZWdpb25cbiAgICAgICAgXG4gICAgICAgIHRoaXMucHJvZHVjdGlvbkdsb2JhbENvbmZpZy5EaXNwbGF5Q29sb3IgPSB0aGlzLmF1dGhvckdsb2JhbENvbmZpZy5EaXNwbGF5Q29sb3I7XG4gICAgICAgIFxuICAgICAgICAvLyByZWdpb24gKioqIGdsb2JhbCB1c2VyQ29uZmlnICh1c2VyIGlucHV0IGFwcC1tb2R1bGUpICoqKlxuICAgICAgICB0aGlzLnNldFVzZXJDb2xvcnModXNlckdsb2JhbENvbmZpZy5Db2xvckxpc3QpO1xuICAgICAgICBcbiAgICAgICAgLy8gZW5kcmVnaW9uXG4gICAgICAgIFxuICAgICAgICB0aGlzLnNldFRvYXN0Tm9kZSgpO1xuICAgICAgICB0aGlzLnNldE5vZGVTdHlsZXModGhpcy5wcm9kdWN0aW9uR2xvYmFsQ29uZmlnLkRpc3BsYXlDb2xvcik7XG4gICAgICAgIFxuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIHNldE5vZGVTdHlsZXMoX1Byb2R1Y3Rpb25Db2xvclR5cGVzOiBHbG9iYWxJbnRlcmZhY2UuSUNvbG9yT2JqZWN0KSB7XG4gICAgICAgIFxuICAgICAgICBPYmplY3Qua2V5cyhfUHJvZHVjdGlvbkNvbG9yVHlwZXMpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgIGlmIChfUHJvZHVjdGlvbkNvbG9yVHlwZXNba2V5XSkge1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHRoaXMuc2V0QnV0dG9uU3R5bGluZyhrZXksIF9Qcm9kdWN0aW9uQ29sb3JUeXBlc1trZXldKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFRvYXN0U3R5bGluZyhrZXksIF9Qcm9kdWN0aW9uQ29sb3JUeXBlc1trZXldKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldERpYWxvZ0ZyYW1lKGtleSwgX1Byb2R1Y3Rpb25Db2xvclR5cGVzW2tleV0pO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmIChDb2xvclZhcmlhbmNlW2tleS50b1VwcGVyQ2FzZSgpXSA9PT0gQ29sb3JWYXJpYW5jZS5QUklNQVJZKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0U2hlZXQoKS5hZGRSdWxlKCcubmd4LWF3ZXNvbWUtcG9wdXAtb3ZlcmxheScsIGBiYWNrZ3JvdW5kOiAgJHtfUHJvZHVjdGlvbkNvbG9yVHlwZXNba2V5XS5UcmFuc3BhcmVudERhcmtlblZhcmlhbmNlfSFpbXBvcnRhbnQ7YCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIHByaXZhdGUgc2V0VG9hc3RTdHlsaW5nKF9LZXk6IHN0cmluZywgX0NvbG9yUHJvdmlkZXI6IElDb2xvclByb3ZpZGVyKSB7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBiYXNlQ2xhc3MgPSBgLm92ZXJsYXktdG9hc3QgLmV2b2x2ZS10b2FzdC4ke19LZXkudG9Mb3dlckNhc2UoKX0tZGlhbG9nYDtcbiAgICAgICAgY29uc3QgYmFzZVN0eWxlID0gYFxuICAgICAgICBiYWNrZ3JvdW5kOiAgJHtfQ29sb3JQcm92aWRlci5CcmlnaHRTaGFkZX0haW1wb3J0YW50O1xuICAgICAgICBib3JkZXItY29sb3I6ICR7X0NvbG9yUHJvdmlkZXIuQnJpZ2h0ZW59IWltcG9ydGFudDtcbiAgICAgICAgYDtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuZ2V0U2hlZXQoKS5hZGRSdWxlKGJhc2VDbGFzcywgYmFzZVN0eWxlKTtcbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBzZXRCdXR0b25TdHlsaW5nKF9LZXk6IHN0cmluZywgX0NvbG9yUHJvdmlkZXI6IElDb2xvclByb3ZpZGVyKSB7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBiYXNlQnV0dG9uQ2xhc3MgPSBgLmVkLWJ0bi0ke19LZXkudG9Mb3dlckNhc2UoKX1gO1xuICAgICAgICBjb25zdCBiYXNlU3R5bGUgICAgICAgPSBgXG4gICAgICAgIGNvbG9yOiAke19Db2xvclByb3ZpZGVyLkNvbnRyYXN0Q29sb3J9IWltcG9ydGFudDtcbiAgICAgICAgYmFja2dyb3VuZDogICR7X0NvbG9yUHJvdmlkZXIuQmFzZX0haW1wb3J0YW50O1xuICAgICAgICBib3JkZXItY29sb3I6ICR7X0NvbG9yUHJvdmlkZXIuQnJpZ2h0ZW5Gb3JTaGFkZX0haW1wb3J0YW50O1xuICAgICAgICBgO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgaG92ZXJCdXR0b25DbGFzcyA9IGAuZWQtYnRuLSR7X0tleS50b0xvd2VyQ2FzZSgpfTpob3ZlcmA7XG4gICAgICAgIGNvbnN0IGhvdmVyU3R5bGUgICAgICAgPSBgXG4gICAgICAgIGJhY2tncm91bmQ6ICAke19Db2xvclByb3ZpZGVyLklzQmFzZUJyaWdodCA/IF9Db2xvclByb3ZpZGVyLkRhcmtlbkZvclNoYWRlIDogX0NvbG9yUHJvdmlkZXIuQnJpZ2h0ZW5Gb3JTaGFkZX0haW1wb3J0YW50O1xuICAgICAgICBib3JkZXItY29sb3I6ICR7X0NvbG9yUHJvdmlkZXIuSXNCYXNlQnJpZ2h0ID8gX0NvbG9yUHJvdmlkZXIuRGFya2VuIDogX0NvbG9yUHJvdmlkZXIuQnJpZ2h0ZW59IWltcG9ydGFudDtcbiAgICAgICAgYDtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGZvY3VzQWN0aXZlQnV0dG9uQ2xhc3MgPSBgLmVkLWJ0bi0ke19LZXkudG9Mb3dlckNhc2UoKX06Zm9jdXMsIC5lZC1idG4tJHtfS2V5LnRvTG93ZXJDYXNlKCl9OmFjdGl2ZWA7XG4gICAgICAgIGNvbnN0IGZvY3VzQWN0aXZlU3R5bGUgICAgICAgPSBgXG4gICAgICAgIGJveC1zaGFkb3c6IDAgMCAxcHggMnB4ICR7X0NvbG9yUHJvdmlkZXIuSXNCYXNlQnJpZ2h0ID8gX0NvbG9yUHJvdmlkZXIuRGFya2VuIDogX0NvbG9yUHJvdmlkZXIuQnJpZ2h0ZW59IWltcG9ydGFudDtcbiAgICAgICAgYDtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuZ2V0U2hlZXQoKS5hZGRSdWxlKGJhc2VCdXR0b25DbGFzcywgYmFzZVN0eWxlKTtcbiAgICAgICAgdGhpcy5nZXRTaGVldCgpLmFkZFJ1bGUoaG92ZXJCdXR0b25DbGFzcywgaG92ZXJTdHlsZSk7XG4gICAgICAgIHRoaXMuZ2V0U2hlZXQoKS5hZGRSdWxlKGZvY3VzQWN0aXZlQnV0dG9uQ2xhc3MsIGZvY3VzQWN0aXZlU3R5bGUpO1xuICAgICAgICBcbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBzZXREaWFsb2dGcmFtZShfS2V5OiBzdHJpbmcsIF9Db2xvclByb3ZpZGVyOiBJQ29sb3JQcm92aWRlcikge1xuICAgICAgICBcbiAgICAgICAgY29uc3QgYmFzZURpYWxvZ0ZyYW1lQ2xhc3MgPSBgLm5neC1hd2Vzb21lLXBvcHVwLW92ZXJsYXkgLiR7X0tleS50b0xvd2VyQ2FzZSgpfS1kaWFsb2dgO1xuICAgICAgICBjb25zdCBiYXNlU3R5bGUgICAgICAgICAgICA9IGBcbiAgICAgICAgYm9yZGVyLWNvbG9yOiAke19Db2xvclByb3ZpZGVyLkJyaWdodGVufSFpbXBvcnRhbnQ7XG4gICAgICAgIGA7XG4gICAgICAgIFxuICAgICAgICB0aGlzLmdldFNoZWV0KCkuYWRkUnVsZShiYXNlRGlhbG9nRnJhbWVDbGFzcywgYmFzZVN0eWxlKTtcbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIHByaXZhdGUgZ2V0U2hlZXQoKSB7XG4gICAgICAgIC8vIENyZWF0ZSB0aGUgPHN0eWxlPiB0YWdcbiAgICAgICAgbGV0IGV2b2x2ZURpYWxvZ1N0eWxlTm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZ3gtYXdlc29tZS1wb3B1cC1zdHlsZXMnKSBhcyBIVE1MU3R5bGVFbGVtZW50O1xuICAgICAgICBpZiAoIWV2b2x2ZURpYWxvZ1N0eWxlTm9kZSkge1xuICAgICAgICAgICAgY29uc3QgaGVhZE5vZGUgPSBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF07XG4gICAgICAgICAgICBpZiAoIWhlYWROb2RlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBldm9sdmVEaWFsb2dTdHlsZU5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpO1xuICAgICAgICAgICAgZXZvbHZlRGlhbG9nU3R5bGVOb2RlLnNldEF0dHJpYnV0ZSgnaWQnLCAnbmd4LWF3ZXNvbWUtcG9wdXAtc3R5bGVzJyk7XG4gICAgICAgICAgICBldm9sdmVEaWFsb2dTdHlsZU5vZGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycpKTtcbiAgICAgICAgICAgIGhlYWROb2RlLmFwcGVuZENoaWxkKGV2b2x2ZURpYWxvZ1N0eWxlTm9kZSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBldm9sdmVEaWFsb2dTdHlsZU5vZGUgPyBldm9sdmVEaWFsb2dTdHlsZU5vZGUuc2hlZXQgOiBudWxsO1xuICAgIH07XG4gICAgXG4gICAgcHJpdmF0ZSBzZXRUb2FzdE5vZGUoKSB7XG4gICAgICAgIGNvbnN0IGJvZHlOb2RlID0gZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpWzBdO1xuICAgICAgICBpZiAoIWJvZHlOb2RlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHRvYXN0V3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0b2FzdFdyYXBwZXIuc2V0QXR0cmlidXRlKCdpZCcsICd0b2FzdC13cmFwcGVyJyk7XG4gICAgICAgIHRvYXN0V3JhcHBlci5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJykpO1xuICAgICAgICBib2R5Tm9kZS5wcmVwZW5kKHRvYXN0V3JhcHBlcik7XG4gICAgICAgIC8vIGJvZHlOb2RlLmFwcGVuZENoaWxkKHRvYXN0V3JhcHBlcik7XG4gICAgXG4gICAgXG4gICAgICAgIHRoaXMuZ2V0U2hlZXQoKS5hZGRSdWxlKGAjdG9hc3Qtd3JhcHBlcmAsIGBwb3NpdGlvbjogZml4ZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgei1pbmRleDogMTAwMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDIwcHg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHQ6IDIwcHg7YCk7XG4gICAgICAgIHRoaXMuZ2V0U2hlZXQoKS5hZGRSdWxlKGAudG9hc3QtZW50aXR5YCwgYGFsbCAwLjVzIGVhc2U7YCk7XG4gICAgICAgIHRoaXMuZ2V0U2hlZXQoKS5hZGRSdWxlKGAudG9hc3QtZW50aXR5OmZpcnN0LWNoaWxkYCwgYGFuaW1hdGlvbjogbW92ZSAwLjdzIGVhc2Utb3V0O2ApO1xuICAgICAgICB0aGlzLmdldFNoZWV0KCkuYWRkUnVsZShgQC13ZWJraXQta2V5ZnJhbWVzIG1vdmVgLCBgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCUge21hcmdpbi10b3A6IC01cHg7IG9wYWNpdHk6IDAuNDt9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMzAlIHttYXJnaW4tdG9wOiAtNHB4OyBvcGFjaXR5OiAwLjc7fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwMCUge21hcmdpbi10b3A6IDBweDsgb3BhY2l0eTogMTt9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCk7XG4gICAgICAgIHRoaXMuZ2V0U2hlZXQoKS5hZGRSdWxlKGBAa2V5ZnJhbWVzIG1vdmVgLCBgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCUge21hcmdpbi10b3A6IC01cHg7IG9wYWNpdHk6IDAuNDt9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMzAlIHttYXJnaW4tdG9wOiAtNHB4OyBvcGFjaXR5OiAwLjc7fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwMCUge21hcmdpbi10b3A6IDBweDsgb3BhY2l0eTogMTt9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCk7XG4gICAgICAgIFxuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIHNldFVzZXJDb2xvcnMoX1VzZXJDb2xvclR5cGVzOiBHbG9iYWxJbnRlcmZhY2UuSUNvbG9yVHlwZXMpOiB2b2lkIHtcbiAgICAgICAgXG4gICAgICAgIGlmICh0eXBlb2YgX1VzZXJDb2xvclR5cGVzICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCB1c2VyS2V5cyAgICAgICAgICAgICA9IE9iamVjdC5rZXlzKF9Vc2VyQ29sb3JUeXBlcyk7XG4gICAgICAgIGNvbnN0IHByb2R1Y3Rpb25PYmplY3RLZXlzID0gT2JqZWN0LmtleXModGhpcy5wcm9kdWN0aW9uR2xvYmFsQ29uZmlnLkRpc3BsYXlDb2xvcik7XG4gICAgICAgIFxuICAgICAgICB1c2VyS2V5cy5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChwcm9kdWN0aW9uT2JqZWN0S2V5cy5maW5kKHRLZXkgPT4gdEtleSA9PT0ga2V5KSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGJhc2VDb2xvclByb3ZpZGVyID0gbmV3IEdsb2JhbENsYXNzLkNvbG9yUHJvdmlkZXIoX1VzZXJDb2xvclR5cGVzW2tleV0pO1xuICAgICAgICAgICAgICAgIGlmIChiYXNlQ29sb3JQcm92aWRlci5CYXNlKSB7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2R1Y3Rpb25HbG9iYWxDb25maWcuRGlzcGxheUNvbG9yW2tleV0gPSBiYXNlQ29sb3JQcm92aWRlcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICB9XG59XG4iXX0=