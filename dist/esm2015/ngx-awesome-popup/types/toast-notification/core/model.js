import {Subject} from 'rxjs';
import {map} from 'rxjs/operators';
import {GlobalClass} from '../../../core/global';
import {ServiceLocator} from '../../../locator.service';
import {ToastNotificationService} from './toast-notification.service';
import {ToastNotificationConfigService} from './toast-notification-config.service';

export var ToastNotificationClass;
(function (ToastNotificationClass) {
    // region *** Public ***
    class ToastNotificationInitializer {
        constructor() {
            this.toastNotificationCarrier = new ToastNotificationClass.ToastNotificationCarrier();
        }

        openToastNotification$() {
            return this.toastNotificationCarrier.openToastNotification$().pipe(map(resp => {
                const basicToastNotificationResponse = new ToastNotificationResponse();
                const dataControl = new GlobalClass.DataControl();
                dataControl.copyValuesFrom(resp, basicToastNotificationResponse);
                return basicToastNotificationResponse;
            }));
        }
        setButtons(_Buttons) {
            this.toastNotificationCarrier.setButtons(_Buttons);
        }

        setConfig(_ToastNotificationConfig) {
            this.toastNotificationCarrier.setConfig(_ToastNotificationConfig);
        }

        setDispatch(_Title, _Message = null) {
            this.toastNotificationCarrier.setTitle(_Title);
            this.toastNotificationCarrier.setMessage(_Message);
        }

        setTitle(_Title) {
            this.toastNotificationCarrier.setTitle(_Title);
        }

        setMessage(_Message) {
            this.toastNotificationCarrier.setMessage(_Message);
        }

        setButtonLabels(_Confirm, _Decline) {
            this.toastNotificationCarrier.setButtonLabels(_Confirm, _Decline);
        }
    }
    ToastNotificationClass.ToastNotificationInitializer = ToastNotificationInitializer;
    class ToastNotificationResponse extends GlobalClass.DataControl {
        constructor() {
            super();
            // private Response: DialogPrepareResponse            = new DialogPrepareResponse();
            this.Success = null;
            this.ClickedButtonID = null;
        }
        setSuccess(_IsSuccess) {
            this.Success = _IsSuccess;
        }
        setClickedButtonID(_ClickedButtonID) {
            this.ClickedButtonID = _ClickedButtonID;
        }
    }
    ToastNotificationClass.ToastNotificationResponse = ToastNotificationResponse;
    class ToastNotificationEventsController {
        constructor(EntityUniqueID) {
            this.EntityUniqueID = EntityUniqueID;
            this._afterClosed = new Subject();
            this.afterClosed$ = this._afterClosed.asObservable();
            this._onButtonClick = new Subject();
            this.onButtonClick$ = this._onButtonClick.asObservable();
            this._buttonList = new Subject();
            this.buttonList$ = this._buttonList.asObservable();
        }
        close(_Response) {
            const response = _Response ? _Response : this.defaultResponse;
            this._afterClosed.next(response);
        }
        onButtonClick(_Button) {
            this.defaultResponse.setClickedButtonID(_Button.ID);
            this._onButtonClick.next(_Button);
        }
        setButtonList(_ButtonList) {
            this._buttonList.next(_ButtonList);
        }
        setDefaultResponse(_Response) {
            this.defaultResponse = _Response;
        }
    }
    ToastNotificationClass.ToastNotificationEventsController = ToastNotificationEventsController;
    // endregion
    class ToastNotificationDefaultResponse extends ToastNotificationResponse {
        constructor() {
            super();
            this.toastNotificationBelonging = null;
        }
        setBelonging(_ToastNotificationBelonging) {
            this.toastNotificationBelonging = _ToastNotificationBelonging;
        }
    }
    ToastNotificationClass.ToastNotificationDefaultResponse = ToastNotificationDefaultResponse;
    class ToastNotificationCarrier {
        constructor() {
            this.toastNotificationBelonging = new ToastNotificationClass.ToastNotificationBelonging();
        }

        setButtons(_Buttons) {
            if (_Buttons.length) {
                this.toastNotificationBelonging.Buttons = _Buttons;
            }
        }

        setTitle(_Title) {
            this.toastNotificationBelonging.Dispatch.Title = _Title;
        }

        setMessage(_Message) {
            this.toastNotificationBelonging.Dispatch.Message = _Message;
        }

        setButtonLabels(_Confirm, _Decline) {
            this.toastNotificationBelonging.ToastCoreConfig.ConfirmLabel = _Confirm;
            this.toastNotificationBelonging.ToastCoreConfig.DeclineLabel = _Decline;
        }

        setConfig(_ToastNotificationBelonging) {
            // region *** local UserConfig (defined on place where dialog is called) ***
            const dataControl = new GlobalClass.DataControl();
            dataControl.copyValuesFrom(_ToastNotificationBelonging, this.toastNotificationBelonging.ToastCoreConfig);
            // endregion
        }
        openToastNotification$() {
            if (!this.toastNotificationBelonging.Dispatch.Title
                && !this.toastNotificationBelonging.Dispatch.Message) {
                throw Error('Toast message fail.');
            }
            const service = ServiceLocator.injector.get(ToastNotificationService);
            return service.openToast$(this.toastNotificationBelonging);
        }
    }
    ToastNotificationClass.ToastNotificationCarrier = ToastNotificationCarrier;
    class GlobalToastSettings {
        constructor() {
            this.AllowedNotificationsAtOnce = null;
        }
    }
    ToastNotificationClass.GlobalToastSettings = GlobalToastSettings;
    class Settings {
        constructor() {
            this.Buttons         = [];
            this.ToastCoreConfig = new ToastCoreConfig();
            this.Dispatch        = new GlobalClass.Dispatch();
            this.GlobalSettings  = new GlobalToastSettings();
        }
    }
    ToastNotificationClass.Settings = Settings;
    class ToastCoreConfig {
        constructor() {
            this.Width            = null;
            this.Height           = null;
            this.ButtonPosition   = null;
            this.LayoutType       = null;
            this.Dispatch         = null;
            this.ConfirmLabel     = null;
            this.DeclineLabel     = null;
            this.AutoCloseDelay   = null;
            this.DisableIcon      = null;
            this.AllowHTMLMessage = null;
        }
    }
    ToastNotificationClass.ToastCoreConfig = ToastCoreConfig;
    class ToastNotificationBelonging extends ToastNotificationClass.Settings {
        constructor() {
            super();
            this.EntityUniqueID                 = 'T' + Math.random().toString(36).substr(2, 9);
            this.EventsController               = new ToastNotificationEventsController(this.EntityUniqueID);
            const toastNotificationConfigurator = ServiceLocator.injector.get(ToastNotificationConfigService);
            const baseSettings                  = new ToastNotificationClass.Settings();
            const dataControl                   = new GlobalClass.DataControl();
            dataControl.copyValuesFrom(toastNotificationConfigurator.productionConfig.ToastCoreConfig, baseSettings.ToastCoreConfig);
            this.ToastCoreConfig = baseSettings.ToastCoreConfig;
            this.Buttons         = toastNotificationConfigurator.productionConfig.Buttons.slice();
        }
    }

    ToastNotificationClass.ToastNotificationBelonging = ToastNotificationBelonging;
})(ToastNotificationClass || (ToastNotificationClass = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9uZ3gtYXdlc29tZS1wb3B1cC90eXBlcy90b2FzdC1ub3RpZmljYXRpb24vY29yZS9tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWEsT0FBTyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQ3pDLE9BQU8sRUFBQyxHQUFHLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNuQyxPQUFPLEVBQUMsV0FBVyxFQUFrQixNQUFNLHNCQUFzQixDQUFDO0FBQ2xFLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUV4RCxPQUFPLEVBQUMsd0JBQXdCLEVBQUMsTUFBTSw4QkFBOEIsQ0FBQztBQUN0RSxPQUFPLEVBQUMsOEJBQThCLEVBQUMsTUFBTSxxQ0FBcUMsQ0FBQztBQWtFbkYsTUFBTSxLQUFXLHNCQUFzQixDQThNdEM7QUE5TUQsV0FBaUIsc0JBQXNCO0lBRW5DLHdCQUF3QjtJQUN4QixNQUFhLDRCQUE0QjtRQUlyQztZQUZRLDZCQUF3QixHQUFvRCxJQUFJLHNCQUFzQixDQUFDLHdCQUF3QixFQUFFLENBQUM7UUFHMUksQ0FBQztRQUVELHNCQUFzQjtZQUNsQixPQUFPLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQzFFLE1BQU0sOEJBQThCLEdBQUcsSUFBSSx5QkFBeUIsRUFBRSxDQUFDO2dCQUN2RSxNQUFNLFdBQVcsR0FBc0IsSUFBSSxXQUFXLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQ3JFLFdBQVcsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLDhCQUE4QixDQUFDLENBQUM7Z0JBQ2pFLE9BQU8sOEJBQThCLENBQUM7WUFDMUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNSLENBQUM7UUFFRCxVQUFVLENBQUMsUUFBbUM7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QyxxQkFBZ0IsR0FBc0IsSUFBSSxDQUFDO1FBRS9DLENBQUM7S0FBQTtJQVpZLHNDQUFlLGtCQVkzQixDQUFBO0lBRUQsTUFBYSwwQkFBMkIsU0FBUSxzQkFBc0IsQ0FBQyxRQUFRO1FBSzNFO1lBQ0ksS0FBSyxFQUFFLENBQUM7WUFKWixtQkFBYyxHQUFXLEdBQUcsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFLbkUsSUFBSSxDQUFDLGdCQUFnQixHQUFpRCxJQUFJLGlDQUFpQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUNqSSxNQUFNLDZCQUE2QixHQUFtQyxjQUFjLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO1lBQ2xJLE1BQU0sWUFBWSxHQUFvRCxJQUFJLHNCQUFzQixDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQzVHLE1BQU0sV0FBVyxHQUFxRCxJQUFJLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNwRyxXQUFXLENBQUMsY0FBYyxDQUFDLDZCQUE2QixDQUFDLGdCQUFnQixDQUFDLGVBQWUsRUFBRSxZQUFZLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDekgsSUFBSSxDQUFDLGVBQWUsR0FBRyxZQUFZLENBQUMsZUFBZSxDQUFDO1lBQ3BELElBQUksQ0FBQyxPQUFPLEdBQVcsNkJBQTZCLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzFGLENBQUM7S0FFSjtJQWhCWSxpREFBMEIsNkJBZ0J0QyxDQUFBO0FBR0wsQ0FBQyxFQTlNZ0Isc0JBQXNCLEtBQXRCLHNCQUFzQixRQThNdEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge09ic2VydmFibGUsIFN1YmplY3R9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHttYXB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7R2xvYmFsQ2xhc3MsIEdsb2JhbEludGVyZmFjZX0gZnJvbSAnLi4vLi4vLi4vY29yZS9nbG9iYWwnO1xuaW1wb3J0IHtTZXJ2aWNlTG9jYXRvcn0gZnJvbSAnLi4vLi4vLi4vbG9jYXRvci5zZXJ2aWNlJztcbmltcG9ydCB7RGlhbG9nTGF5b3V0RGlzcGxheSwgVmVydGljYWxQb3NpdGlvbn0gZnJvbSAnLi4vLi4vLi4vY29yZS9lbnVtcyc7XG5pbXBvcnQge1RvYXN0Tm90aWZpY2F0aW9uU2VydmljZX0gZnJvbSAnLi90b2FzdC1ub3RpZmljYXRpb24uc2VydmljZSc7XG5pbXBvcnQge1RvYXN0Tm90aWZpY2F0aW9uQ29uZmlnU2VydmljZX0gZnJvbSAnLi90b2FzdC1ub3RpZmljYXRpb24tY29uZmlnLnNlcnZpY2UnO1xuXG5cbmV4cG9ydCBuYW1lc3BhY2UgVG9hc3ROb3RpZmljYXRpb25JbnRlcmZhY2Uge1xuICAgIFxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSVRvYXN0Tm90aWZpY2F0aW9uVXNlckNvbmZpZyB7XG4gICAgICAgIEJ1dHRvbnM/OiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdO1xuICAgICAgICBUb2FzdENvcmVDb25maWc/OiBUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JVG9hc3RDb3JlQ29uZmlnO1xuICAgICAgICBEaXNwYXRjaD86IEdsb2JhbEludGVyZmFjZS5JRGlzcGF0Y2g7XG4gICAgICAgIEdsb2JhbFNldHRpbmdzPzogVG9hc3ROb3RpZmljYXRpb25JbnRlcmZhY2UuSUdsb2JhbFRvYXN0U2V0dGluZ3M7XG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSUdsb2JhbFRvYXN0U2V0dGluZ3Mge1xuICAgICAgICAvKiogTnVtYmVyIG9mIHBvcHVwcyBhbGxvd2VkIG9uIHNjcmVlbiwgcmVjb21tZW5kIDMtNSAqL1xuICAgICAgICBBbGxvd2VkTm90aWZpY2F0aW9uc0F0T25jZTogbnVtYmVyO1xuICAgIH1cbiAgICBcbiAgICBleHBvcnQgaW50ZXJmYWNlIElUb2FzdENvcmVDb25maWcge1xuICAgICAgICAvKiogRml4ZWQgcG9wdXAgd2lkdGggKi9cbiAgICAgICAgV2lkdGg/OiBzdHJpbmc7XG4gICAgICAgIC8qKiBGaXhlZCBwb3B1cCBoZWlnaHQgKi9cbiAgICAgICAgSGVpZ2h0Pzogc3RyaW5nO1xuICAgICAgICBCdXR0b25Qb3NpdGlvbj86IFZlcnRpY2FsUG9zaXRpb247XG4gICAgICAgIExheW91dFR5cGU/OiBEaWFsb2dMYXlvdXREaXNwbGF5O1xuICAgICAgICBEaXNwYXRjaD86IEdsb2JhbEludGVyZmFjZS5JRGlzcGF0Y2g7XG4gICAgICAgIC8qKiBEZWZhdWx0IGNvbmZpcm0gYnV0dG9uIExhYmVsICovXG4gICAgICAgIENvbmZpcm1MYWJlbD86IHN0cmluZztcbiAgICAgICAgLyoqIERlZmF1bHQgZGVjbGluZSBidXR0b24gTGFiZWwgKi9cbiAgICAgICAgRGVjbGluZUxhYmVsPzogc3RyaW5nO1xuICAgICAgICAvKiogRXhwcmVzc2VkIGluIG1pbGxpc2Vjb25kcyAqL1xuICAgICAgICBBdXRvQ2xvc2VEZWxheT86IG51bWJlcjtcbiAgICAgICAgRGlzYWJsZUljb24/OiBib29sZWFuO1xuICAgICAgICBBbGxvd0hUTUxNZXNzYWdlPzogYm9vbGVhbjtcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGludGVyZmFjZSBJVG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcge1xuICAgICAgICBCdXR0b25zOiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdO1xuICAgICAgICBUb2FzdENvcmVDb25maWc6IFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklUb2FzdENvcmVDb25maWc7XG4gICAgICAgIEVudGl0eVVuaXF1ZUlEOiBzdHJpbmc7XG4gICAgICAgIEV2ZW50c0NvbnRyb2xsZXI6IFRvYXN0Tm90aWZpY2F0aW9uQ2xhc3MuVG9hc3ROb3RpZmljYXRpb25FdmVudHNDb250cm9sbGVyO1xuICAgIH1cbiAgICBcbiAgICBleHBvcnQgaW50ZXJmYWNlIElUb2FzdE5vdGlmaWNhdGlvblJlc3BvbnNlIHtcbiAgICAgICAgc2V0U3VjY2VzcyhfSXNTdWNjZXNzOiBib29sZWFuKTogdm9pZDtcbiAgICAgICAgXG4gICAgICAgIHNldENsaWNrZWRCdXR0b25JRChfQ2xpY2tlZEJ1dHRvbklEKTogdm9pZDtcbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSVRvYXN0Tm90aWZpY2F0aW9uUHVibGljUmVzcG9uc2Uge1xuICAgICAgICBTdWNjZXNzOiBib29sZWFuO1xuICAgICAgICBDbGlja2VkQnV0dG9uSUQ6IHN0cmluZ1xuICAgIH1cbiAgICBcbiAgICBleHBvcnQgaW50ZXJmYWNlIElQcml2YXRlUmVzcG9uc2VNZXJnZWQgZXh0ZW5kcyBJVG9hc3ROb3RpZmljYXRpb25SZXNwb25zZSwgR2xvYmFsSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2Uge1xuICAgICAgICBcbiAgICAgICAgdG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmc6IFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklUb2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZztcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGludGVyZmFjZSBJVG9hc3ROb3RpZmljYXRpb25SYXdTdGF0ZSB7XG4gICAgICAgIFdlYWtNYXA6IFdlYWtNYXA8YW55LCBUb2FzdE5vdGlmaWNhdGlvbkNsYXNzLlRvYXN0Tm90aWZpY2F0aW9uRXZlbnRzQ29udHJvbGxlcj47XG4gICAgICAgIFRvYXN0QmVsb25naW5nOiBUb2FzdE5vdGlmaWNhdGlvbkNsYXNzLlRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nO1xuICAgIH1cbiAgICBcbn1cblxuZXhwb3J0IG5hbWVzcGFjZSBUb2FzdE5vdGlmaWNhdGlvbkNsYXNzIHtcbiAgICBcbiAgICAvLyByZWdpb24gKioqIFB1YmxpYyAqKipcbiAgICBleHBvcnQgY2xhc3MgVG9hc3ROb3RpZmljYXRpb25Jbml0aWFsaXplciB7XG4gICAgICAgIFxuICAgICAgICBwcml2YXRlIHRvYXN0Tm90aWZpY2F0aW9uQ2FycmllcjogVG9hc3ROb3RpZmljYXRpb25DbGFzcy5Ub2FzdE5vdGlmaWNhdGlvbkNhcnJpZXIgPSBuZXcgVG9hc3ROb3RpZmljYXRpb25DbGFzcy5Ub2FzdE5vdGlmaWNhdGlvbkNhcnJpZXIoKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBvcGVuVG9hc3ROb3RpZmljYXRpb24kKCk6IE9ic2VydmFibGU8VG9hc3ROb3RpZmljYXRpb25JbnRlcmZhY2UuSVRvYXN0Tm90aWZpY2F0aW9uUHVibGljUmVzcG9uc2U+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQ2Fycmllci5vcGVuVG9hc3ROb3RpZmljYXRpb24kKCkucGlwZShtYXAocmVzcCA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgYmFzaWNUb2FzdE5vdGlmaWNhdGlvblJlc3BvbnNlID0gbmV3IFRvYXN0Tm90aWZpY2F0aW9uUmVzcG9uc2UoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhQ29udHJvbCAgICAgICAgICAgICAgICAgICAgPSBuZXcgR2xvYmFsQ2xhc3MuRGF0YUNvbnRyb2woKTtcbiAgICAgICAgICAgICAgICBkYXRhQ29udHJvbC5jb3B5VmFsdWVzRnJvbShyZXNwLCBiYXNpY1RvYXN0Tm90aWZpY2F0aW9uUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybiBiYXNpY1RvYXN0Tm90aWZpY2F0aW9uUmVzcG9uc2U7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldEJ1dHRvbnMoX0J1dHRvbnM6IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10pOiB2b2lkIHtcbiAgICAgICAgICAgIHRoaXMudG9hc3ROb3RpZmljYXRpb25DYXJyaWVyLnNldEJ1dHRvbnMoX0J1dHRvbnMpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBzZXRDb25maWcoX1RvYXN0Tm90aWZpY2F0aW9uQ29uZmlnOiBUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JVG9hc3RDb3JlQ29uZmlnKSB7XG4gICAgICAgICAgICB0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQ2Fycmllci5zZXRDb25maWcoX1RvYXN0Tm90aWZpY2F0aW9uQ29uZmlnKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgc2V0RGlzcGF0Y2goX1RpdGxlOiBzdHJpbmcsIF9NZXNzYWdlOiBzdHJpbmcgPSBudWxsKTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQ2Fycmllci5zZXRUaXRsZShfVGl0bGUpO1xuICAgICAgICAgICAgdGhpcy50b2FzdE5vdGlmaWNhdGlvbkNhcnJpZXIuc2V0TWVzc2FnZShfTWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldFRpdGxlKF9UaXRsZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQ2Fycmllci5zZXRUaXRsZShfVGl0bGUpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBzZXRNZXNzYWdlKF9NZXNzYWdlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgICAgIHRoaXMudG9hc3ROb3RpZmljYXRpb25DYXJyaWVyLnNldE1lc3NhZ2UoX01lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBzZXRCdXR0b25MYWJlbHMoX0NvbmZpcm06IHN0cmluZywgX0RlY2xpbmU/OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgICAgIHRoaXMudG9hc3ROb3RpZmljYXRpb25DYXJyaWVyLnNldEJ1dHRvbkxhYmVscyhfQ29uZmlybSwgX0RlY2xpbmUpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgIH1cbiAgICBcbiAgICBleHBvcnQgY2xhc3MgVG9hc3ROb3RpZmljYXRpb25SZXNwb25zZSBleHRlbmRzIEdsb2JhbENsYXNzLkRhdGFDb250cm9sIGltcGxlbWVudHMgVG9hc3ROb3RpZmljYXRpb25JbnRlcmZhY2UuSVRvYXN0Tm90aWZpY2F0aW9uUmVzcG9uc2UsIFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklUb2FzdE5vdGlmaWNhdGlvblB1YmxpY1Jlc3BvbnNlIHtcbiAgICAgICAgLy8gcHJpdmF0ZSBSZXNwb25zZTogRGlhbG9nUHJlcGFyZVJlc3BvbnNlICAgICAgICAgICAgPSBuZXcgRGlhbG9nUHJlcGFyZVJlc3BvbnNlKCk7XG4gICAgICAgIFxuICAgICAgICBTdWNjZXNzOiBib29sZWFuICAgICAgICA9IG51bGw7XG4gICAgICAgIENsaWNrZWRCdXR0b25JRDogc3RyaW5nID0gbnVsbDtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgc2V0U3VjY2VzcyhfSXNTdWNjZXNzOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLlN1Y2Nlc3MgPSBfSXNTdWNjZXNzO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBzZXRDbGlja2VkQnV0dG9uSUQoX0NsaWNrZWRCdXR0b25JRCk6IHZvaWQge1xuICAgICAgICAgICAgdGhpcy5DbGlja2VkQnV0dG9uSUQgPSBfQ2xpY2tlZEJ1dHRvbklEO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGNsYXNzIFRvYXN0Tm90aWZpY2F0aW9uRXZlbnRzQ29udHJvbGxlciB7XG4gICAgICAgIFxuICAgICAgICBkZWZhdWx0UmVzcG9uc2U6IFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQ7XG4gICAgICAgIFxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IF9hZnRlckNsb3NlZDogU3ViamVjdDxUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPiA9IG5ldyBTdWJqZWN0PFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQ+KCk7XG4gICAgICAgIGFmdGVyQ2xvc2VkJDogT2JzZXJ2YWJsZTxUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPiAgICAgICAgICAgICAgID0gdGhpcy5fYWZ0ZXJDbG9zZWQuYXNPYnNlcnZhYmxlKCk7XG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgX29uQnV0dG9uQ2xpY2s6IFN1YmplY3Q8R2xvYmFsSW50ZXJmYWNlLklCdXR0b24+ICAgICAgICAgICAgICAgICAgICAgICAgID0gbmV3IFN1YmplY3Q8R2xvYmFsSW50ZXJmYWNlLklCdXR0b24+KCk7XG4gICAgICAgIG9uQnV0dG9uQ2xpY2skOiBPYnNlcnZhYmxlPEdsb2JhbEludGVyZmFjZS5JQnV0dG9uPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gdGhpcy5fb25CdXR0b25DbGljay5hc09ic2VydmFibGUoKTtcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBfYnV0dG9uTGlzdDogU3ViamVjdDxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdPiAgICAgICAgICAgICAgICAgICAgICAgICAgPSBuZXcgU3ViamVjdDxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdPigpO1xuICAgICAgICBidXR0b25MaXN0JDogT2JzZXJ2YWJsZTxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IHRoaXMuX2J1dHRvbkxpc3QuYXNPYnNlcnZhYmxlKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIEVudGl0eVVuaXF1ZUlEOiBzdHJpbmcpIHtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIGNsb3NlKF9SZXNwb25zZT86IFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQpOiB2b2lkIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gX1Jlc3BvbnNlID8gX1Jlc3BvbnNlIDogdGhpcy5kZWZhdWx0UmVzcG9uc2U7XG4gICAgICAgICAgICB0aGlzLl9hZnRlckNsb3NlZC5uZXh0KHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgb25CdXR0b25DbGljayhfQnV0dG9uOiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbik6IHZvaWQge1xuICAgICAgICAgICAgdGhpcy5kZWZhdWx0UmVzcG9uc2Uuc2V0Q2xpY2tlZEJ1dHRvbklEKF9CdXR0b24uSUQpO1xuICAgICAgICAgICAgdGhpcy5fb25CdXR0b25DbGljay5uZXh0KF9CdXR0b24pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBzZXRCdXR0b25MaXN0KF9CdXR0b25MaXN0OiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdKTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLl9idXR0b25MaXN0Lm5leHQoX0J1dHRvbkxpc3QpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBzZXREZWZhdWx0UmVzcG9uc2UoX1Jlc3BvbnNlOiBUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkKTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRSZXNwb25zZSA9IF9SZXNwb25zZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBlbmRyZWdpb25cbiAgICBcbiAgICBleHBvcnQgY2xhc3MgVG9hc3ROb3RpZmljYXRpb25EZWZhdWx0UmVzcG9uc2UgZXh0ZW5kcyBUb2FzdE5vdGlmaWNhdGlvblJlc3BvbnNlIGltcGxlbWVudHMgVG9hc3ROb3RpZmljYXRpb25JbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZCB7XG4gICAgICAgIHRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nOiBUb2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZyA9IG51bGw7XG4gICAgICAgIFxuICAgICAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgICAgIHN1cGVyKCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldEJlbG9uZ2luZyhfVG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcpOiB2b2lkIHtcbiAgICAgICAgICAgIHRoaXMudG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcgPSBfVG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmc7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBUb2FzdE5vdGlmaWNhdGlvbkNhcnJpZXIge1xuICAgICAgICBcbiAgICAgICAgdG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmc6IFRvYXN0Tm90aWZpY2F0aW9uQ2xhc3MuVG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcgPSBuZXcgVG9hc3ROb3RpZmljYXRpb25DbGFzcy5Ub2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZygpO1xuICAgICAgICBcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldEJ1dHRvbnMoX0J1dHRvbnM6IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10pIHtcbiAgICAgICAgICAgIGlmIChfQnV0dG9ucy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nLkJ1dHRvbnMgPSBfQnV0dG9ucztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgc2V0VGl0bGUoX1RpdGxlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgICAgIHRoaXMudG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcuRGlzcGF0Y2guVGl0bGUgPSBfVGl0bGU7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldE1lc3NhZ2UoX01lc3NhZ2U6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICAgICAgdGhpcy50b2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZy5EaXNwYXRjaC5NZXNzYWdlID0gX01lc3NhZ2U7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldEJ1dHRvbkxhYmVscyhfQ29uZmlybTogc3RyaW5nLCBfRGVjbGluZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nLlRvYXN0Q29yZUNvbmZpZy5Db25maXJtTGFiZWwgPSBfQ29uZmlybTtcbiAgICAgICAgICAgIHRoaXMudG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcuVG9hc3RDb3JlQ29uZmlnLkRlY2xpbmVMYWJlbCA9IF9EZWNsaW5lO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBzZXRDb25maWcoX1RvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nOiBUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JVG9hc3RDb3JlQ29uZmlnKSB7XG4gICAgICAgICAgICAvLyByZWdpb24gKioqIGxvY2FsIFVzZXJDb25maWcgKGRlZmluZWQgb24gcGxhY2Ugd2hlcmUgZGlhbG9nIGlzIGNhbGxlZCkgKioqXG4gICAgICAgICAgICBjb25zdCBkYXRhQ29udHJvbCA9IG5ldyBHbG9iYWxDbGFzcy5EYXRhQ29udHJvbCgpO1xuICAgICAgICAgICAgZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20oX1RvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nLCB0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nLlRvYXN0Q29yZUNvbmZpZyk7XG4gICAgICAgICAgICAvLyBlbmRyZWdpb25cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgb3BlblRvYXN0Tm90aWZpY2F0aW9uJCgpOiBPYnNlcnZhYmxlPFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQ+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy50b2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZy5EaXNwYXRjaC5UaXRsZVxuICAgICAgICAgICAgICAgICYmICF0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nLkRpc3BhdGNoLk1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignVG9hc3QgbWVzc2FnZSBmYWlsLicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgc2VydmljZTogVG9hc3ROb3RpZmljYXRpb25TZXJ2aWNlID0gU2VydmljZUxvY2F0b3IuaW5qZWN0b3IuZ2V0KFRvYXN0Tm90aWZpY2F0aW9uU2VydmljZSk7XG4gICAgICAgICAgICByZXR1cm4gc2VydmljZS5vcGVuVG9hc3QkKHRoaXMudG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcpO1xuICAgICAgICAgICAgXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBHbG9iYWxUb2FzdFNldHRpbmdzIGltcGxlbWVudHMgVG9hc3ROb3RpZmljYXRpb25JbnRlcmZhY2UuSUdsb2JhbFRvYXN0U2V0dGluZ3Mge1xuICAgICAgICBBbGxvd2VkTm90aWZpY2F0aW9uc0F0T25jZTogbnVtYmVyID0gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGNsYXNzIFNldHRpbmdzIHtcbiAgICAgICAgQnV0dG9uczogR2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXSAgICAgICAgICAgICAgICAgICAgICAgICAgID0gW107XG4gICAgICAgIFRvYXN0Q29yZUNvbmZpZzogVG9hc3ROb3RpZmljYXRpb25JbnRlcmZhY2UuSVRvYXN0Q29yZUNvbmZpZyA9IG5ldyBUb2FzdENvcmVDb25maWcoKTtcbiAgICAgICAgRGlzcGF0Y2g6IEdsb2JhbEludGVyZmFjZS5JRGlzcGF0Y2ggICAgICAgICAgICAgICAgICAgICAgICAgID0gbmV3IEdsb2JhbENsYXNzLkRpc3BhdGNoKCk7XG4gICAgICAgIEdsb2JhbFNldHRpbmdzOiBHbG9iYWxUb2FzdFNldHRpbmdzICAgICAgICAgICAgICAgICAgICAgICAgICA9IG5ldyBHbG9iYWxUb2FzdFNldHRpbmdzKCk7XG4gICAgICAgIFxuICAgIH1cbiAgICBcbiAgICBleHBvcnQgY2xhc3MgVG9hc3RDb3JlQ29uZmlnIGltcGxlbWVudHMgVG9hc3ROb3RpZmljYXRpb25JbnRlcmZhY2UuSVRvYXN0Q29yZUNvbmZpZyB7XG4gICAgICAgIFdpZHRoOiBzdHJpbmcgICAgICAgICAgICAgICAgICAgICAgID0gbnVsbDtcbiAgICAgICAgSGVpZ2h0OiBzdHJpbmcgICAgICAgICAgICAgICAgICAgICAgPSBudWxsO1xuICAgICAgICBCdXR0b25Qb3NpdGlvbjogVmVydGljYWxQb3NpdGlvbiAgICA9IG51bGw7XG4gICAgICAgIExheW91dFR5cGU6IERpYWxvZ0xheW91dERpc3BsYXkgICAgID0gbnVsbDtcbiAgICAgICAgRGlzcGF0Y2g6IEdsb2JhbEludGVyZmFjZS5JRGlzcGF0Y2ggPSBudWxsO1xuICAgICAgICBDb25maXJtTGFiZWw6IHN0cmluZyAgICAgICAgICAgICAgICA9IG51bGw7XG4gICAgICAgIERlY2xpbmVMYWJlbDogc3RyaW5nICAgICAgICAgICAgICAgID0gbnVsbDtcbiAgICAgICAgQXV0b0Nsb3NlRGVsYXk6IG51bWJlciAgICAgICAgICAgICAgPSBudWxsO1xuICAgICAgICBEaXNhYmxlSWNvbjogYm9vbGVhbiAgICAgICAgICAgICAgICA9IG51bGw7XG4gICAgICAgIEFsbG93SFRNTE1lc3NhZ2U6IGJvb2xlYW4gICAgICAgICAgID0gbnVsbDtcbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBUb2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZyBleHRlbmRzIFRvYXN0Tm90aWZpY2F0aW9uQ2xhc3MuU2V0dGluZ3MgaW1wbGVtZW50cyBUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JVG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcge1xuICAgICAgICBcbiAgICAgICAgRW50aXR5VW5pcXVlSUQ6IHN0cmluZyA9ICdUJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KTtcbiAgICAgICAgRXZlbnRzQ29udHJvbGxlcjogVG9hc3ROb3RpZmljYXRpb25FdmVudHNDb250cm9sbGVyO1xuICAgICAgICBcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgICAgICBzdXBlcigpO1xuICAgICAgICAgICAgdGhpcy5FdmVudHNDb250cm9sbGVyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IG5ldyBUb2FzdE5vdGlmaWNhdGlvbkV2ZW50c0NvbnRyb2xsZXIodGhpcy5FbnRpdHlVbmlxdWVJRCk7XG4gICAgICAgICAgICBjb25zdCB0b2FzdE5vdGlmaWNhdGlvbkNvbmZpZ3VyYXRvcjogVG9hc3ROb3RpZmljYXRpb25Db25maWdTZXJ2aWNlID0gU2VydmljZUxvY2F0b3IuaW5qZWN0b3IuZ2V0KFRvYXN0Tm90aWZpY2F0aW9uQ29uZmlnU2VydmljZSk7XG4gICAgICAgICAgICBjb25zdCBiYXNlU2V0dGluZ3MgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gbmV3IFRvYXN0Tm90aWZpY2F0aW9uQ2xhc3MuU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIGNvbnN0IGRhdGFDb250cm9sICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPSBuZXcgR2xvYmFsQ2xhc3MuRGF0YUNvbnRyb2woKTtcbiAgICAgICAgICAgIGRhdGFDb250cm9sLmNvcHlWYWx1ZXNGcm9tKHRvYXN0Tm90aWZpY2F0aW9uQ29uZmlndXJhdG9yLnByb2R1Y3Rpb25Db25maWcuVG9hc3RDb3JlQ29uZmlnLCBiYXNlU2V0dGluZ3MuVG9hc3RDb3JlQ29uZmlnKTtcbiAgICAgICAgICAgIHRoaXMuVG9hc3RDb3JlQ29uZmlnID0gYmFzZVNldHRpbmdzLlRvYXN0Q29yZUNvbmZpZztcbiAgICAgICAgICAgIHRoaXMuQnV0dG9ucyAgICAgICAgID0gdG9hc3ROb3RpZmljYXRpb25Db25maWd1cmF0b3IucHJvZHVjdGlvbkNvbmZpZy5CdXR0b25zLnNsaWNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIFxufVxuIl19
