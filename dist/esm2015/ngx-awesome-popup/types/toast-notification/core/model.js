import { Subject } from 'rxjs';
import { map } from 'rxjs/operators';
import { GlobalClass } from '../../../core/global';
import { ServiceLocator } from '../../../locator.service';
import { ToastNotificationConfigService } from './toast-notification-config.service';
import { ToastNotificationService } from './toast-notification.service';
export var ToastNotificationClass;
(function (ToastNotificationClass) {
    // region *** Public ***
    class ToastNotificationInitializer {
        constructor() {
            this.toastNotificationCarrier = new ToastNotificationClass.ToastNotificationCarrier();
        }
        openToastNotification$() {
            return this.toastNotificationCarrier.openToastNotification$().pipe(map(resp => {
                const basicToastNotificationResponse = new ToastNotificationResponse();
                const dataControl = new GlobalClass.DataControl();
                dataControl.copyValuesFrom(resp, basicToastNotificationResponse);
                return basicToastNotificationResponse;
            }));
        }
        setButtons(_Buttons) {
            this.toastNotificationCarrier.setButtons(_Buttons);
        }
        setConfig(_ToastNotificationConfig) {
            this.toastNotificationCarrier.setConfig(_ToastNotificationConfig);
        }
        setDispatch(_Title, _Message = null) {
            this.toastNotificationCarrier.setTitle(_Title);
            this.toastNotificationCarrier.setMessage(_Message);
        }
        setTitle(_Title) {
            this.toastNotificationCarrier.setTitle(_Title);
        }
        setMessage(_Message) {
            this.toastNotificationCarrier.setMessage(_Message);
        }
        setButtonLabels(_Confirm, _Decline) {
            this.toastNotificationCarrier.setButtonLabels(_Confirm, _Decline);
        }
    }
    ToastNotificationClass.ToastNotificationInitializer = ToastNotificationInitializer;
    class ToastNotificationResponse extends GlobalClass.DataControl {
        constructor() {
            super();
            // private Response: DialogPrepareResponse            = new DialogPrepareResponse();
            this.Success = null;
            this.ClickedButtonID = null;
        }
        setSuccess(_IsSuccess) {
            this.Success = _IsSuccess;
        }
        setClickedButtonID(_ClickedButtonID) {
            this.ClickedButtonID = _ClickedButtonID;
        }
    }
    ToastNotificationClass.ToastNotificationResponse = ToastNotificationResponse;
    class ToastNotificationEventsController {
        constructor(EntityUniqueID) {
            this.EntityUniqueID = EntityUniqueID;
            this._afterClosed = new Subject();
            this.afterClosed$ = this._afterClosed.asObservable();
            this._onButtonClick = new Subject();
            this.onButtonClick$ = this._onButtonClick.asObservable();
            this._buttonList = new Subject();
            this.buttonList$ = this._buttonList.asObservable();
        }
        close(_Response) {
            const response = _Response ? _Response : this.defaultResponse;
            this._afterClosed.next(response);
        }
        onButtonClick(_Button) {
            this.defaultResponse.setClickedButtonID(_Button.ID);
            this._onButtonClick.next(_Button);
        }
        setButtonList(_ButtonList) {
            this._buttonList.next(_ButtonList);
        }
        setDefaultResponse(_Response) {
            this.defaultResponse = _Response;
        }
    }
    ToastNotificationClass.ToastNotificationEventsController = ToastNotificationEventsController;
    // endregion
    class ToastNotificationDefaultResponse extends ToastNotificationResponse {
        constructor() {
            super();
            this.toastNotificationBelonging = null;
        }
        setBelonging(_ToastNotificationBelonging) {
            this.toastNotificationBelonging = _ToastNotificationBelonging;
        }
    }
    ToastNotificationClass.ToastNotificationDefaultResponse = ToastNotificationDefaultResponse;
    class ToastNotificationCarrier {
        constructor() {
            this.toastNotificationBelonging = new ToastNotificationClass.ToastNotificationBelonging();
        }
        setButtons(_Buttons) {
            if (_Buttons.length) {
                this.toastNotificationBelonging.Buttons = _Buttons;
            }
        }
        setTitle(_Title) {
            this.toastNotificationBelonging.Dispatch.Title = _Title;
        }
        setMessage(_Message) {
            this.toastNotificationBelonging.Dispatch.Message = _Message;
        }
        setButtonLabels(_Confirm, _Decline) {
            this.toastNotificationBelonging.ToastCoreConfig.ConfirmLabel = _Confirm;
            this.toastNotificationBelonging.ToastCoreConfig.DeclineLabel = _Decline;
        }
        setConfig(_ToastNotificationBelonging) {
            // region *** local UserConfig (defined on place where dialog is called) ***
            const dataControl = new GlobalClass.DataControl();
            dataControl.copyValuesFrom(_ToastNotificationBelonging, this.toastNotificationBelonging.ToastCoreConfig);
            // endregion
        }
        openToastNotification$() {
            if (!this.toastNotificationBelonging.Dispatch.Title
                && !this.toastNotificationBelonging.Dispatch.Message) {
                throw Error('Toast notification can not be without both message and title.');
            }
            const service = ServiceLocator.injector.get(ToastNotificationService);
            return service.openToast$(this.toastNotificationBelonging);
        }
    }
    ToastNotificationClass.ToastNotificationCarrier = ToastNotificationCarrier;
    class GlobalToastSettings {
        constructor() {
            this.AllowedNotificationsAtOnce = null;
        }
    }
    ToastNotificationClass.GlobalToastSettings = GlobalToastSettings;
    class ResetToastGlobalSettings {
        constructor(globalToastConfig) {
            const globalToastConfigService = ServiceLocator.injector.get(ToastNotificationConfigService);
            if (globalToastConfigService) {
                globalToastConfigService.setResetGlobalToastConfig(globalToastConfig);
            }
            else {
                globalToastConfigService.setResetGlobalToastConfig();
            }
        }
    }
    ToastNotificationClass.ResetToastGlobalSettings = ResetToastGlobalSettings;
    class Settings {
        constructor() {
            this.Buttons = [];
            this.ToastCoreConfig = new ToastCoreConfig();
            this.Dispatch = new GlobalClass.Dispatch();
            this.GlobalSettings = new GlobalToastSettings();
        }
    }
    ToastNotificationClass.Settings = Settings;
    class ToastCoreConfig {
        constructor() {
            this.ToastPosition = null;
            this.ProgressBar = null;
            this.ToastUserViewType = null;
            this.OpenInElementID = null;
            this.ButtonPosition = null;
            this.TextPosition = null;
            this.LayoutType = null;
            this.Dispatch = null;
            this.ConfirmLabel = null;
            this.DeclineLabel = null;
            this.AutoCloseDelay = null;
            this.DisableIcon = null;
            this.AllowHTMLMessage = null;
        }
    }
    ToastNotificationClass.ToastCoreConfig = ToastCoreConfig;
    class ToastNotificationBelonging extends ToastNotificationClass.Settings {
        constructor() {
            super();
            this.EntityUniqueID = 'T' + Math.random().toString(36).substr(2, 9);
            this.EventsController = new ToastNotificationEventsController(this.EntityUniqueID);
            const toastNotificationConfigurator = ServiceLocator.injector.get(ToastNotificationConfigService);
            const baseSettings = new ToastNotificationClass.Settings();
            const dataControl = new GlobalClass.DataControl();
            dataControl.copyValuesFrom(toastNotificationConfigurator.productionConfig.ToastCoreConfig, baseSettings.ToastCoreConfig);
            this.ToastCoreConfig = baseSettings.ToastCoreConfig;
            this.Buttons = toastNotificationConfigurator.productionConfig.Buttons.slice();
        }
    }
    ToastNotificationClass.ToastNotificationBelonging = ToastNotificationBelonging;
})(ToastNotificationClass || (ToastNotificationClass = {}));
export var ToastProgressBarEnum;
(function (ToastProgressBarEnum) {
    ToastProgressBarEnum[ToastProgressBarEnum["NONE"] = 0] = "NONE";
    ToastProgressBarEnum[ToastProgressBarEnum["INCREASE"] = 1] = "INCREASE";
    ToastProgressBarEnum[ToastProgressBarEnum["DECREASE"] = 2] = "DECREASE";
})(ToastProgressBarEnum || (ToastProgressBarEnum = {}));
export var ToastPositionEnum;
(function (ToastPositionEnum) {
    ToastPositionEnum["TOP_LEFT"] = "top-left";
    ToastPositionEnum["TOP_CENTER"] = "top-center";
    ToastPositionEnum["TOP_RIGHT"] = "top-right";
    ToastPositionEnum["TOP_FULL_WIDTH"] = "top-fullwidth";
    ToastPositionEnum["BOTTOM_LEFT"] = "bottom-left";
    ToastPositionEnum["BOTTOM_CENTER"] = "bottom-center";
    ToastPositionEnum["BOTTOM_RIGHT"] = "bottom-right";
    ToastPositionEnum["BOTTOM_FULL_WIDTH"] = "bottom-fullwidth";
})(ToastPositionEnum || (ToastPositionEnum = {}));
export var ToastUserViewTypeEnum;
(function (ToastUserViewTypeEnum) {
    ToastUserViewTypeEnum["SIMPLE"] = "simple";
    ToastUserViewTypeEnum["STANDARD"] = "standard";
})(ToastUserViewTypeEnum || (ToastUserViewTypeEnum = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9uZ3gtYXdlc29tZS1wb3B1cC90eXBlcy90b2FzdC1ub3RpZmljYXRpb24vY29yZS9tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWEsT0FBTyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQ3pDLE9BQU8sRUFBQyxHQUFHLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUVuQyxPQUFPLEVBQUMsV0FBVyxFQUFrQixNQUFNLHNCQUFzQixDQUFDO0FBQ2xFLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUN4RCxPQUFPLEVBQUMsOEJBQThCLEVBQUMsTUFBTSxxQ0FBcUMsQ0FBQztBQUNuRixPQUFPLEVBQUMsd0JBQXdCLEVBQUMsTUFBTSw4QkFBOEIsQ0FBQztBQW1FdEUsTUFBTSxLQUFXLHNCQUFzQixDQThOdEM7QUE5TkQsV0FBaUIsc0JBQXNCO0lBRXRDLHdCQUF3QjtJQUN4QixNQUFhLDRCQUE0QjtRQUl4QztZQUZRLDZCQUF3QixHQUFvRCxJQUFJLHNCQUFzQixDQUFDLHdCQUF3QixFQUFFLENBQUM7UUFHMUksQ0FBQztRQUVELHNCQUFzQjtZQUNyQixPQUFPLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQzdFLE1BQU0sOEJBQThCLEdBQUcsSUFBSSx5QkFBeUIsRUFBRSxDQUFDO2dCQUN2RSxNQUFNLFdBQVcsR0FBc0IsSUFBSSxXQUFXLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQ3JFLFdBQVcsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLDhCQUE4QixDQUFDLENBQUM7Z0JBQ2pFLE9BQU8sOEJBQThCLENBQUM7WUFDdkMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFFRCxVQUFVLENBQUMsUUFBbUM7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QUUsWUFBWSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1lBQ3pILElBQUksQ0FBQyxlQUFlLEdBQUcsWUFBWSxDQUFDLGVBQWUsQ0FBQztZQUNwRCxJQUFJLENBQUMsT0FBTyxHQUFXLDZCQUE2QixDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN2RixDQUFDO0tBRUQ7SUFoQlksaURBQTBCLDZCQWdCdEMsQ0FBQTtBQUVGLENBQUMsRUE5TmdCLHNCQUFzQixLQUF0QixzQkFBc0IsUUE4TnRDO0FBRUQsTUFBTSxDQUFOLElBQVksb0JBS1g7QUFMRCxXQUFZLG9CQUFvQjtJQUUvQiwrREFBWSxDQUFBO0lBQ1osdUVBQVksQ0FBQTtJQUNaLHVFQUFZLENBQUE7QUFDYixDQUFDLEVBTFcsb0JBQW9CLEtBQXBCLG9CQUFvQixRQUsvQjtBQUVELE1BQU0sQ0FBTixJQUFZLGlCQVNYO0FBVEQsV0FBWSxpQkFBaUI7SUFDNUIsMENBQThCLENBQUE7SUFDOUIsOENBQWdDLENBQUE7SUFDaEMsNENBQStCLENBQUE7SUFDL0IscURBQW1DLENBQUE7SUFDbkMsZ0RBQWlDLENBQUE7SUFDakMsb0RBQW1DLENBQUE7SUFDbkMsa0RBQWtDLENBQUE7SUFDbEMsMkRBQXNDLENBQUE7QUFDdkMsQ0FBQyxFQVRXLGlCQUFpQixLQUFqQixpQkFBaUIsUUFTNUI7QUFFRCxNQUFNLENBQU4sSUFBWSxxQkFHWDtBQUhELFdBQVkscUJBQXFCO0lBQ2hDLDBDQUFtQixDQUFBO0lBQ25CLDhDQUFxQixDQUFBO0FBQ3RCLENBQUMsRUFIVyxxQkFBcUIsS0FBckIscUJBQXFCLFFBR2hDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtPYnNlcnZhYmxlLCBTdWJqZWN0fSBmcm9tICdyeGpzJztcbmltcG9ydCB7bWFwfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge0RpYWxvZ0xheW91dERpc3BsYXksIFZlcnRpY2FsUG9zaXRpb259IGZyb20gJy4uLy4uLy4uL2NvcmUvZW51bXMnO1xuaW1wb3J0IHtHbG9iYWxDbGFzcywgR2xvYmFsSW50ZXJmYWNlfSBmcm9tICcuLi8uLi8uLi9jb3JlL2dsb2JhbCc7XG5pbXBvcnQge1NlcnZpY2VMb2NhdG9yfSBmcm9tICcuLi8uLi8uLi9sb2NhdG9yLnNlcnZpY2UnO1xuaW1wb3J0IHtUb2FzdE5vdGlmaWNhdGlvbkNvbmZpZ1NlcnZpY2V9IGZyb20gJy4vdG9hc3Qtbm90aWZpY2F0aW9uLWNvbmZpZy5zZXJ2aWNlJztcbmltcG9ydCB7VG9hc3ROb3RpZmljYXRpb25TZXJ2aWNlfSBmcm9tICcuL3RvYXN0LW5vdGlmaWNhdGlvbi5zZXJ2aWNlJztcblxuXG5leHBvcnQgbmFtZXNwYWNlIFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlIHtcblxuXHRleHBvcnQgaW50ZXJmYWNlIElUb2FzdE5vdGlmaWNhdGlvblVzZXJDb25maWcge1xuXHRcdEJ1dHRvbnM/OiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdO1xuXHRcdFRvYXN0Q29yZUNvbmZpZz86IFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklUb2FzdENvcmVDb25maWc7XG5cdFx0RGlzcGF0Y2g/OiBHbG9iYWxJbnRlcmZhY2UuSURpc3BhdGNoO1xuXHRcdEdsb2JhbFNldHRpbmdzPzogVG9hc3ROb3RpZmljYXRpb25JbnRlcmZhY2UuSUdsb2JhbFRvYXN0U2V0dGluZ3M7XG5cdH1cblxuXHRleHBvcnQgaW50ZXJmYWNlIElHbG9iYWxUb2FzdFNldHRpbmdzIHtcblx0XHQvKiogTnVtYmVyIG9mIHBvcHVwcyBhbGxvd2VkIG9uIHNjcmVlbiwgcmVjb21tZW5kIDMtNSAqL1xuXHRcdEFsbG93ZWROb3RpZmljYXRpb25zQXRPbmNlOiBudW1iZXI7XG5cdH1cblxuXHRleHBvcnQgaW50ZXJmYWNlIElUb2FzdENvcmVDb25maWcge1xuXHRcdFRvYXN0UG9zaXRpb24/OiBUb2FzdFBvc2l0aW9uRW51bTtcblx0XHRQcm9ncmVzc0Jhcj86IFRvYXN0UHJvZ3Jlc3NCYXJFbnVtO1xuXHRcdFRvYXN0VXNlclZpZXdUeXBlPzogVG9hc3RVc2VyVmlld1R5cGVFbnVtO1xuXHRcdE9wZW5JbkVsZW1lbnRJRD86IHN0cmluZztcblx0XHRCdXR0b25Qb3NpdGlvbj86IFZlcnRpY2FsUG9zaXRpb247XG5cdFx0VGV4dFBvc2l0aW9uPzogVmVydGljYWxQb3NpdGlvbjtcblx0XHRMYXlvdXRUeXBlPzogRGlhbG9nTGF5b3V0RGlzcGxheTtcblx0XHREaXNwYXRjaD86IEdsb2JhbEludGVyZmFjZS5JRGlzcGF0Y2g7XG5cdFx0LyoqIERlZmF1bHQgY29uZmlybSBidXR0b24gTGFiZWwgKi9cblx0XHRDb25maXJtTGFiZWw/OiBzdHJpbmc7XG5cdFx0LyoqIERlZmF1bHQgZGVjbGluZSBidXR0b24gTGFiZWwgKi9cblx0XHREZWNsaW5lTGFiZWw/OiBzdHJpbmc7XG5cdFx0LyoqIEV4cHJlc3NlZCBpbiBtaWxsaXNlY29uZHMgKi9cblx0XHRBdXRvQ2xvc2VEZWxheT86IG51bWJlcjtcblx0XHREaXNhYmxlSWNvbj86IGJvb2xlYW47XG5cdFx0QWxsb3dIVE1MTWVzc2FnZT86IGJvb2xlYW47XG5cdH1cblxuXHRleHBvcnQgaW50ZXJmYWNlIElUb2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZyB7XG5cdFx0QnV0dG9uczogR2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXTtcblx0XHRUb2FzdENvcmVDb25maWc6IFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklUb2FzdENvcmVDb25maWc7XG5cdFx0RW50aXR5VW5pcXVlSUQ6IHN0cmluZztcblx0XHRFdmVudHNDb250cm9sbGVyOiBUb2FzdE5vdGlmaWNhdGlvbkNsYXNzLlRvYXN0Tm90aWZpY2F0aW9uRXZlbnRzQ29udHJvbGxlcjtcblx0fVxuXG5cdGV4cG9ydCBpbnRlcmZhY2UgSVRvYXN0Tm90aWZpY2F0aW9uUmVzcG9uc2Uge1xuXHRcdHNldFN1Y2Nlc3MoX0lzU3VjY2VzczogYm9vbGVhbik6IHZvaWQ7XG5cblx0XHRzZXRDbGlja2VkQnV0dG9uSUQoX0NsaWNrZWRCdXR0b25JRCk6IHZvaWQ7XG5cblx0fVxuXG5cdGV4cG9ydCBpbnRlcmZhY2UgSVRvYXN0Tm90aWZpY2F0aW9uUHVibGljUmVzcG9uc2Uge1xuXHRcdFN1Y2Nlc3M6IGJvb2xlYW47XG5cdFx0Q2xpY2tlZEJ1dHRvbklEOiBzdHJpbmdcblx0fVxuXG5cdGV4cG9ydCBpbnRlcmZhY2UgSVByaXZhdGVSZXNwb25zZU1lcmdlZCBleHRlbmRzIElUb2FzdE5vdGlmaWNhdGlvblJlc3BvbnNlLCBHbG9iYWxJbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZSB7XG5cblx0XHR0b2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZzogVG9hc3ROb3RpZmljYXRpb25JbnRlcmZhY2UuSVRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nO1xuXHR9XG5cblx0ZXhwb3J0IGludGVyZmFjZSBJVG9hc3ROb3RpZmljYXRpb25SYXdTdGF0ZSB7XG5cdFx0V2Vha01hcDogV2Vha01hcDxhbnksIFRvYXN0Tm90aWZpY2F0aW9uQ2xhc3MuVG9hc3ROb3RpZmljYXRpb25FdmVudHNDb250cm9sbGVyPjtcblx0XHRUb2FzdEJlbG9uZ2luZzogVG9hc3ROb3RpZmljYXRpb25DbGFzcy5Ub2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZztcblx0fVxuXG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgVG9hc3ROb3RpZmljYXRpb25DbGFzcyB7XG5cblx0Ly8gcmVnaW9uICoqKiBQdWJsaWMgKioqXG5cdGV4cG9ydCBjbGFzcyBUb2FzdE5vdGlmaWNhdGlvbkluaXRpYWxpemVyIHtcblxuXHRcdHByaXZhdGUgdG9hc3ROb3RpZmljYXRpb25DYXJyaWVyOiBUb2FzdE5vdGlmaWNhdGlvbkNsYXNzLlRvYXN0Tm90aWZpY2F0aW9uQ2FycmllciA9IG5ldyBUb2FzdE5vdGlmaWNhdGlvbkNsYXNzLlRvYXN0Tm90aWZpY2F0aW9uQ2FycmllcigpO1xuXG5cdFx0Y29uc3RydWN0b3IoKSB7XG5cdFx0fVxuXG5cdFx0b3BlblRvYXN0Tm90aWZpY2F0aW9uJCgpOiBPYnNlcnZhYmxlPFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklUb2FzdE5vdGlmaWNhdGlvblB1YmxpY1Jlc3BvbnNlPiB7XG5cdFx0XHRyZXR1cm4gdGhpcy50b2FzdE5vdGlmaWNhdGlvbkNhcnJpZXIub3BlblRvYXN0Tm90aWZpY2F0aW9uJCgpLnBpcGUobWFwKHJlc3AgPT4ge1xuXHRcdFx0XHRjb25zdCBiYXNpY1RvYXN0Tm90aWZpY2F0aW9uUmVzcG9uc2UgPSBuZXcgVG9hc3ROb3RpZmljYXRpb25SZXNwb25zZSgpO1xuXHRcdFx0XHRjb25zdCBkYXRhQ29udHJvbCAgICAgICAgICAgICAgICAgICAgPSBuZXcgR2xvYmFsQ2xhc3MuRGF0YUNvbnRyb2woKTtcblx0XHRcdFx0ZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20ocmVzcCwgYmFzaWNUb2FzdE5vdGlmaWNhdGlvblJlc3BvbnNlKTtcblx0XHRcdFx0cmV0dXJuIGJhc2ljVG9hc3ROb3RpZmljYXRpb25SZXNwb25zZTtcblx0XHRcdH0pKTtcblx0XHR9XG5cblx0XHRzZXRCdXR0b25zKF9CdXR0b25zOiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdKTogdm9pZCB7XG5cdFx0XHR0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQ2Fycmllci5zZXRCdXR0b25zKF9CdXR0b25zKTtcblx0XHR9XG5cblx0XHRzZXRDb25maWcoX1RvYXN0Tm90aWZpY2F0aW9uQ29uZmlnOiBUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JVG9hc3RDb3JlQ29uZmlnKSB7XG5cdFx0XHR0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQ2Fycmllci5zZXRDb25maWcoX1RvYXN0Tm90aWZpY2F0aW9uQ29uZmlnKTtcblx0XHR9XG5cblx0XHRzZXREaXNwYXRjaChfVGl0bGU6IHN0cmluZywgX01lc3NhZ2U6IHN0cmluZyA9IG51bGwpOiB2b2lkIHtcblx0XHRcdHRoaXMudG9hc3ROb3RpZmljYXRpb25DYXJyaWVyLnNldFRpdGxlKF9UaXRsZSk7XG5cdFx0XHR0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQ2Fycmllci5zZXRNZXNzYWdlKF9NZXNzYWdlKTtcblx0XHR9XG5cblx0XHRzZXRUaXRsZShfVGl0bGU6IHN0cmluZyk6IHZvaWQge1xuXHRcdFx0dGhpcy50b2FzdE5vdGlmaWNhdGlvbkNhcnJpZXIuc2V0VGl0bGUoX1RpdGxlKTtcblx0XHR9XG5cblx0XHRzZXRNZXNzYWdlKF9NZXNzYWdlOiBzdHJpbmcpOiB2b2lkIHtcblx0XHRcdHRoaXMudG9hc3ROb3RpZmljYXRpb25DYXJyaWVyLnNldE1lc3NhZ2UoX01lc3NhZ2UpO1xuXHRcdH1cblxuXHRcdHNldEJ1dHRvbkxhYmVscyhfQ29uZmlybTogc3RyaW5nLCBfRGVjbGluZT86IHN0cmluZyk6IHZvaWQge1xuXHRcdFx0dGhpcy50b2FzdE5vdGlmaWNhdGlvbkNhcnJpZXIuc2V0QnV0dG9uTGFiZWxzKF9Db25maXJtLCBfRGVjbGluZSk7XG5cdFx0fVxuXG5cdH1cblxuXHRleHBvcnQgY2xhc3MgVG9hc3ROb3RpZmljYXRpb25SZXNwb25zZSBleHRlbmRzIEdsb2JhbENsYXNzLkRhdGFDb250cm9sIGltcGxlbWVudHMgVG9hc3ROb3RpZmljYXRpb25JbnRlcmZhY2UuSVRvYXN0Tm90aWZpY2F0aW9uUmVzcG9uc2UsIFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklUb2FzdE5vdGlmaWNhdGlvblB1YmxpY1Jlc3BvbnNlIHtcblx0XHQvLyBwcml2YXRlIFJlc3BvbnNlOiBEaWFsb2dQcmVwYXJlUmVzcG9uc2UgICAgICAgICAgICA9IG5ldyBEaWFsb2dQcmVwYXJlUmVzcG9uc2UoKTtcblxuXHRcdFN1Y2Nlc3M6IGJvb2xlYW4gICAgICAgID0gbnVsbDtcblx0XHRDbGlja2VkQnV0dG9uSUQ6IHN0cmluZyA9IG51bGw7XG5cblx0XHRjb25zdHJ1Y3RvcigpIHtcblx0XHRcdHN1cGVyKCk7XG5cdFx0fVxuXG5cdFx0c2V0U3VjY2VzcyhfSXNTdWNjZXNzOiBib29sZWFuKTogdm9pZCB7XG5cdFx0XHR0aGlzLlN1Y2Nlc3MgPSBfSXNTdWNjZXNzO1xuXHRcdH1cblxuXHRcdHNldENsaWNrZWRCdXR0b25JRChfQ2xpY2tlZEJ1dHRvbklEKTogdm9pZCB7XG5cdFx0XHR0aGlzLkNsaWNrZWRCdXR0b25JRCA9IF9DbGlja2VkQnV0dG9uSUQ7XG5cdFx0fVxuXG5cblx0fVxuXG5cdGV4cG9ydCBjbGFzcyBUb2FzdE5vdGlmaWNhdGlvbkV2ZW50c0NvbnRyb2xsZXIge1xuXG5cdFx0ZGVmYXVsdFJlc3BvbnNlOiBUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkO1xuXG5cdFx0cHJpdmF0ZSByZWFkb25seSBfYWZ0ZXJDbG9zZWQ6IFN1YmplY3Q8VG9hc3ROb3RpZmljYXRpb25JbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZD4gPSBuZXcgU3ViamVjdDxUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPigpO1xuXHRcdGFmdGVyQ2xvc2VkJDogT2JzZXJ2YWJsZTxUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPiAgICAgICAgICAgICAgID0gdGhpcy5fYWZ0ZXJDbG9zZWQuYXNPYnNlcnZhYmxlKCk7XG5cdFx0cHJpdmF0ZSByZWFkb25seSBfb25CdXR0b25DbGljazogU3ViamVjdDxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbj4gICAgICAgICAgICAgICAgICAgICAgICAgPSBuZXcgU3ViamVjdDxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbj4oKTtcblx0XHRvbkJ1dHRvbkNsaWNrJDogT2JzZXJ2YWJsZTxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IHRoaXMuX29uQnV0dG9uQ2xpY2suYXNPYnNlcnZhYmxlKCk7XG5cdFx0cHJpdmF0ZSByZWFkb25seSBfYnV0dG9uTGlzdDogU3ViamVjdDxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdPiAgICAgICAgICAgICAgICAgICAgICAgICAgPSBuZXcgU3ViamVjdDxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdPigpO1xuXHRcdGJ1dHRvbkxpc3QkOiBPYnNlcnZhYmxlPEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gdGhpcy5fYnV0dG9uTGlzdC5hc09ic2VydmFibGUoKTtcblxuXHRcdGNvbnN0cnVjdG9yKHByaXZhdGUgRW50aXR5VW5pcXVlSUQ6IHN0cmluZykge1xuXHRcdH1cblxuXG5cdFx0Y2xvc2UoX1Jlc3BvbnNlPzogVG9hc3ROb3RpZmljYXRpb25JbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZCk6IHZvaWQge1xuXHRcdFx0Y29uc3QgcmVzcG9uc2UgPSBfUmVzcG9uc2UgPyBfUmVzcG9uc2UgOiB0aGlzLmRlZmF1bHRSZXNwb25zZTtcblx0XHRcdHRoaXMuX2FmdGVyQ2xvc2VkLm5leHQocmVzcG9uc2UpO1xuXHRcdH1cblxuXHRcdG9uQnV0dG9uQ2xpY2soX0J1dHRvbjogR2xvYmFsSW50ZXJmYWNlLklCdXR0b24pOiB2b2lkIHtcblx0XHRcdHRoaXMuZGVmYXVsdFJlc3BvbnNlLnNldENsaWNrZWRCdXR0b25JRChfQnV0dG9uLklEKTtcblx0XHRcdHRoaXMuX29uQnV0dG9uQ2xpY2submV4dChfQnV0dG9uKTtcblx0XHR9XG5cblx0XHRzZXRCdXR0b25MaXN0KF9CdXR0b25MaXN0OiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdKTogdm9pZCB7XG5cdFx0XHR0aGlzLl9idXR0b25MaXN0Lm5leHQoX0J1dHRvbkxpc3QpO1xuXHRcdH1cblxuXHRcdHNldERlZmF1bHRSZXNwb25zZShfUmVzcG9uc2U6IFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQpOiB2b2lkIHtcblx0XHRcdHRoaXMuZGVmYXVsdFJlc3BvbnNlID0gX1Jlc3BvbnNlO1xuXHRcdH1cblx0fVxuXG5cdC8vIGVuZHJlZ2lvblxuXG5cdGV4cG9ydCBjbGFzcyBUb2FzdE5vdGlmaWNhdGlvbkRlZmF1bHRSZXNwb25zZSBleHRlbmRzIFRvYXN0Tm90aWZpY2F0aW9uUmVzcG9uc2UgaW1wbGVtZW50cyBUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkIHtcblx0XHR0b2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZzogVG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcgPSBudWxsO1xuXG5cdFx0Y29uc3RydWN0b3IoKSB7XG5cdFx0XHRzdXBlcigpO1xuXHRcdH1cblxuXHRcdHNldEJlbG9uZ2luZyhfVG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcpOiB2b2lkIHtcblx0XHRcdHRoaXMudG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcgPSBfVG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmc7XG5cdFx0fVxuXG5cdH1cblxuXHRleHBvcnQgY2xhc3MgVG9hc3ROb3RpZmljYXRpb25DYXJyaWVyIHtcblxuXHRcdHRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nOiBUb2FzdE5vdGlmaWNhdGlvbkNsYXNzLlRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nID0gbmV3IFRvYXN0Tm90aWZpY2F0aW9uQ2xhc3MuVG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcoKTtcblxuXHRcdGNvbnN0cnVjdG9yKCkge1xuXHRcdH1cblxuXHRcdHNldEJ1dHRvbnMoX0J1dHRvbnM6IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10pIHtcblx0XHRcdGlmIChfQnV0dG9ucy5sZW5ndGgpIHtcblx0XHRcdFx0dGhpcy50b2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZy5CdXR0b25zID0gX0J1dHRvbnM7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0c2V0VGl0bGUoX1RpdGxlOiBzdHJpbmcpOiB2b2lkIHtcblx0XHRcdHRoaXMudG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcuRGlzcGF0Y2guVGl0bGUgPSBfVGl0bGU7XG5cdFx0fVxuXG5cdFx0c2V0TWVzc2FnZShfTWVzc2FnZTogc3RyaW5nKTogdm9pZCB7XG5cdFx0XHR0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nLkRpc3BhdGNoLk1lc3NhZ2UgPSBfTWVzc2FnZTtcblx0XHR9XG5cblx0XHRzZXRCdXR0b25MYWJlbHMoX0NvbmZpcm06IHN0cmluZywgX0RlY2xpbmU6IHN0cmluZyk6IHZvaWQge1xuXHRcdFx0dGhpcy50b2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZy5Ub2FzdENvcmVDb25maWcuQ29uZmlybUxhYmVsID0gX0NvbmZpcm07XG5cdFx0XHR0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nLlRvYXN0Q29yZUNvbmZpZy5EZWNsaW5lTGFiZWwgPSBfRGVjbGluZTtcblxuXHRcdH1cblxuXHRcdHNldENvbmZpZyhfVG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmc6IFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklUb2FzdENvcmVDb25maWcpIHtcblx0XHRcdC8vIHJlZ2lvbiAqKiogbG9jYWwgVXNlckNvbmZpZyAoZGVmaW5lZCBvbiBwbGFjZSB3aGVyZSBkaWFsb2cgaXMgY2FsbGVkKSAqKipcblx0XHRcdGNvbnN0IGRhdGFDb250cm9sID0gbmV3IEdsb2JhbENsYXNzLkRhdGFDb250cm9sKCk7XG5cdFx0XHRkYXRhQ29udHJvbC5jb3B5VmFsdWVzRnJvbShfVG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcsIHRoaXMudG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcuVG9hc3RDb3JlQ29uZmlnKTtcblx0XHRcdC8vIGVuZHJlZ2lvblxuXHRcdH1cblxuXHRcdG9wZW5Ub2FzdE5vdGlmaWNhdGlvbiQoKTogT2JzZXJ2YWJsZTxUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPiB7XG5cdFx0XHRpZiAoIXRoaXMudG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcuRGlzcGF0Y2guVGl0bGVcblx0XHRcdFx0JiYgIXRoaXMudG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcuRGlzcGF0Y2guTWVzc2FnZSkge1xuXHRcdFx0XHR0aHJvdyBFcnJvcignVG9hc3Qgbm90aWZpY2F0aW9uIGNhbiBub3QgYmUgd2l0aG91dCBib3RoIG1lc3NhZ2UgYW5kIHRpdGxlLicpO1xuXHRcdFx0fVxuXHRcdFx0Y29uc3Qgc2VydmljZTogVG9hc3ROb3RpZmljYXRpb25TZXJ2aWNlID0gU2VydmljZUxvY2F0b3IuaW5qZWN0b3IuZ2V0KFRvYXN0Tm90aWZpY2F0aW9uU2VydmljZSk7XG5cdFx0XHRyZXR1cm4gc2VydmljZS5vcGVuVG9hc3QkKHRoaXMudG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcpO1xuXG5cdFx0fVxuXG5cdH1cblxuXHRleHBvcnQgY2xhc3MgR2xvYmFsVG9hc3RTZXR0aW5ncyBpbXBsZW1lbnRzIFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklHbG9iYWxUb2FzdFNldHRpbmdzIHtcblx0XHRBbGxvd2VkTm90aWZpY2F0aW9uc0F0T25jZTogbnVtYmVyID0gbnVsbDtcblx0fVxuXG5cdGV4cG9ydCBjbGFzcyBSZXNldFRvYXN0R2xvYmFsU2V0dGluZ3Mge1xuXHRcdGNvbnN0cnVjdG9yKGdsb2JhbFRvYXN0Q29uZmlnPzogVG9hc3ROb3RpZmljYXRpb25JbnRlcmZhY2UuSUdsb2JhbFRvYXN0U2V0dGluZ3MpIHtcblxuXHRcdFx0Y29uc3QgZ2xvYmFsVG9hc3RDb25maWdTZXJ2aWNlOiBUb2FzdE5vdGlmaWNhdGlvbkNvbmZpZ1NlcnZpY2UgPSBTZXJ2aWNlTG9jYXRvci5pbmplY3Rvci5nZXQoVG9hc3ROb3RpZmljYXRpb25Db25maWdTZXJ2aWNlKTtcblx0XHRcdGlmIChnbG9iYWxUb2FzdENvbmZpZ1NlcnZpY2UpIHtcblx0XHRcdFx0Z2xvYmFsVG9hc3RDb25maWdTZXJ2aWNlLnNldFJlc2V0R2xvYmFsVG9hc3RDb25maWcoZ2xvYmFsVG9hc3RDb25maWcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Z2xvYmFsVG9hc3RDb25maWdTZXJ2aWNlLnNldFJlc2V0R2xvYmFsVG9hc3RDb25maWcoKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXG5cdGV4cG9ydCBjbGFzcyBTZXR0aW5ncyB7XG5cdFx0QnV0dG9uczogR2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXSAgICAgICAgICAgICAgICAgICAgICAgICAgID0gW107XG5cdFx0VG9hc3RDb3JlQ29uZmlnOiBUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JVG9hc3RDb3JlQ29uZmlnID0gbmV3IFRvYXN0Q29yZUNvbmZpZygpO1xuXHRcdERpc3BhdGNoOiBHbG9iYWxJbnRlcmZhY2UuSURpc3BhdGNoICAgICAgICAgICAgICAgICAgICAgICAgICA9IG5ldyBHbG9iYWxDbGFzcy5EaXNwYXRjaCgpO1xuXHRcdEdsb2JhbFNldHRpbmdzOiBHbG9iYWxUb2FzdFNldHRpbmdzICAgICAgICAgICAgICAgICAgICAgICAgICA9IG5ldyBHbG9iYWxUb2FzdFNldHRpbmdzKCk7XG5cblx0fVxuXG5cdGV4cG9ydCBjbGFzcyBUb2FzdENvcmVDb25maWcgaW1wbGVtZW50cyBUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JVG9hc3RDb3JlQ29uZmlnIHtcblx0XHRUb2FzdFBvc2l0aW9uOiBUb2FzdFBvc2l0aW9uRW51bSAgICAgICAgID0gbnVsbDtcblx0XHRQcm9ncmVzc0JhcjogVG9hc3RQcm9ncmVzc0JhckVudW0gICAgICAgID0gbnVsbDtcblx0XHRUb2FzdFVzZXJWaWV3VHlwZTogVG9hc3RVc2VyVmlld1R5cGVFbnVtID0gbnVsbDtcblx0XHRPcGVuSW5FbGVtZW50SUQ6IHN0cmluZyAgICAgICAgICAgICAgICAgID0gbnVsbDtcblx0XHRCdXR0b25Qb3NpdGlvbjogVmVydGljYWxQb3NpdGlvbiAgICAgICAgID0gbnVsbDtcblx0XHRUZXh0UG9zaXRpb246IFZlcnRpY2FsUG9zaXRpb24gICAgICAgICAgID0gbnVsbDtcblx0XHRMYXlvdXRUeXBlOiBEaWFsb2dMYXlvdXREaXNwbGF5ICAgICAgICAgID0gbnVsbDtcblx0XHREaXNwYXRjaDogR2xvYmFsSW50ZXJmYWNlLklEaXNwYXRjaCAgICAgID0gbnVsbDtcblx0XHRDb25maXJtTGFiZWw6IHN0cmluZyAgICAgICAgICAgICAgICAgICAgID0gbnVsbDtcblx0XHREZWNsaW5lTGFiZWw6IHN0cmluZyAgICAgICAgICAgICAgICAgICAgID0gbnVsbDtcblx0XHRBdXRvQ2xvc2VEZWxheTogbnVtYmVyICAgICAgICAgICAgICAgICAgID0gbnVsbDtcblx0XHREaXNhYmxlSWNvbjogYm9vbGVhbiAgICAgICAgICAgICAgICAgICAgID0gbnVsbDtcblx0XHRBbGxvd0hUTUxNZXNzYWdlOiBib29sZWFuICAgICAgICAgICAgICAgID0gbnVsbDtcblxuXHR9XG5cblx0ZXhwb3J0IGNsYXNzIFRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nIGV4dGVuZHMgVG9hc3ROb3RpZmljYXRpb25DbGFzcy5TZXR0aW5ncyBpbXBsZW1lbnRzIFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklUb2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZyB7XG5cblx0XHRFbnRpdHlVbmlxdWVJRDogc3RyaW5nID0gJ1QnICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpO1xuXHRcdEV2ZW50c0NvbnRyb2xsZXI6IFRvYXN0Tm90aWZpY2F0aW9uRXZlbnRzQ29udHJvbGxlcjtcblxuXHRcdGNvbnN0cnVjdG9yKCkge1xuXHRcdFx0c3VwZXIoKTtcblx0XHRcdHRoaXMuRXZlbnRzQ29udHJvbGxlciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPSBuZXcgVG9hc3ROb3RpZmljYXRpb25FdmVudHNDb250cm9sbGVyKHRoaXMuRW50aXR5VW5pcXVlSUQpO1xuXHRcdFx0Y29uc3QgdG9hc3ROb3RpZmljYXRpb25Db25maWd1cmF0b3I6IFRvYXN0Tm90aWZpY2F0aW9uQ29uZmlnU2VydmljZSA9IFNlcnZpY2VMb2NhdG9yLmluamVjdG9yLmdldChUb2FzdE5vdGlmaWNhdGlvbkNvbmZpZ1NlcnZpY2UpO1xuXHRcdFx0Y29uc3QgYmFzZVNldHRpbmdzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IG5ldyBUb2FzdE5vdGlmaWNhdGlvbkNsYXNzLlNldHRpbmdzKCk7XG5cdFx0XHRjb25zdCBkYXRhQ29udHJvbCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gbmV3IEdsb2JhbENsYXNzLkRhdGFDb250cm9sKCk7XG5cdFx0XHRkYXRhQ29udHJvbC5jb3B5VmFsdWVzRnJvbSh0b2FzdE5vdGlmaWNhdGlvbkNvbmZpZ3VyYXRvci5wcm9kdWN0aW9uQ29uZmlnLlRvYXN0Q29yZUNvbmZpZywgYmFzZVNldHRpbmdzLlRvYXN0Q29yZUNvbmZpZyk7XG5cdFx0XHR0aGlzLlRvYXN0Q29yZUNvbmZpZyA9IGJhc2VTZXR0aW5ncy5Ub2FzdENvcmVDb25maWc7XG5cdFx0XHR0aGlzLkJ1dHRvbnMgICAgICAgICA9IHRvYXN0Tm90aWZpY2F0aW9uQ29uZmlndXJhdG9yLnByb2R1Y3Rpb25Db25maWcuQnV0dG9ucy5zbGljZSgpO1xuXHRcdH1cblxuXHR9XG5cbn1cblxuZXhwb3J0IGVudW0gVG9hc3RQcm9ncmVzc0JhckVudW0ge1xuXG5cdE5PTkUgICAgID0gMCxcblx0SU5DUkVBU0UgPSAxLFxuXHRERUNSRUFTRSA9IDIsXG59XG5cbmV4cG9ydCBlbnVtIFRvYXN0UG9zaXRpb25FbnVtIHtcblx0VE9QX0xFRlQgICAgICAgICAgPSAndG9wLWxlZnQnLFxuXHRUT1BfQ0VOVEVSICAgICAgICA9ICd0b3AtY2VudGVyJyxcblx0VE9QX1JJR0hUICAgICAgICAgPSAndG9wLXJpZ2h0Jyxcblx0VE9QX0ZVTExfV0lEVEggICAgPSAndG9wLWZ1bGx3aWR0aCcsXG5cdEJPVFRPTV9MRUZUICAgICAgID0gJ2JvdHRvbS1sZWZ0Jyxcblx0Qk9UVE9NX0NFTlRFUiAgICAgPSAnYm90dG9tLWNlbnRlcicsXG5cdEJPVFRPTV9SSUdIVCAgICAgID0gJ2JvdHRvbS1yaWdodCcsXG5cdEJPVFRPTV9GVUxMX1dJRFRIID0gJ2JvdHRvbS1mdWxsd2lkdGgnLFxufVxuXG5leHBvcnQgZW51bSBUb2FzdFVzZXJWaWV3VHlwZUVudW0ge1xuXHRTSU1QTEUgICA9ICdzaW1wbGUnLFxuXHRTVEFOREFSRCA9ICdzdGFuZGFyZCcsXG59XG4iXX0=