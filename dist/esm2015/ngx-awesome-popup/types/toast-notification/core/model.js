import { Subject } from "rxjs";
import { map } from "rxjs/operators";
import { GlobalClass } from "../../../core/global";
import { ServiceLocator } from "../../../locator.service";
import { ToastNotificationConfigService } from "./toast-notification-config.service";
import { ToastNotificationService } from "./toast-notification.service";
export var ToastNotificationClass;
(function (ToastNotificationClass) {
    // region *** Public ***
    class ToastNotificationInitializer {
        constructor() {
            this.toastNotificationCarrier = new ToastNotificationClass.ToastNotificationCarrier();
        }
        openToastNotification$() {
            return this.toastNotificationCarrier.openToastNotification$().pipe(map((resp) => {
                const basicToastNotificationResponse = new ToastNotificationResponse();
                const dataControl = new GlobalClass.DataControl();
                dataControl.copyValuesFrom(resp, basicToastNotificationResponse);
                return basicToastNotificationResponse;
            }));
        }
        setButtons(_Buttons) {
            this.toastNotificationCarrier.setButtons(_Buttons);
        }
        setConfig(_ToastNotificationConfig) {
            this.toastNotificationCarrier.setConfig(_ToastNotificationConfig);
        }
        setDispatch(_Title, _Message = null) {
            this.toastNotificationCarrier.setTitle(_Title);
            this.toastNotificationCarrier.setMessage(_Message);
        }
        setTitle(_Title) {
            this.toastNotificationCarrier.setTitle(_Title);
        }
        setMessage(_Message) {
            this.toastNotificationCarrier.setMessage(_Message);
        }
        setButtonLabels(_Confirm, _Decline) {
            this.toastNotificationCarrier.setButtonLabels(_Confirm, _Decline);
        }
    }
    ToastNotificationClass.ToastNotificationInitializer = ToastNotificationInitializer;
    class ToastNotificationResponse extends GlobalClass.DataControl {
        constructor() {
            super();
            // private Response: DialogPrepareResponse            = new DialogPrepareResponse();
            this.Success = null;
            this.ClickedButtonID = null;
        }
        setSuccess(_IsSuccess) {
            this.Success = _IsSuccess;
        }
        setClickedButtonID(_ClickedButtonID) {
            this.ClickedButtonID = _ClickedButtonID;
        }
    }
    ToastNotificationClass.ToastNotificationResponse = ToastNotificationResponse;
    class ToastNotificationEventsController {
        constructor(EntityUniqueID) {
            this.EntityUniqueID = EntityUniqueID;
            this._afterClosed = new Subject();
            this.afterClosed$ = this._afterClosed.asObservable();
            this._onButtonClick = new Subject();
            this.onButtonClick$ = this._onButtonClick.asObservable();
            this._buttonList = new Subject();
            this.buttonList$ = this._buttonList.asObservable();
        }
        close(_Response) {
            const response = _Response ? _Response : this.defaultResponse;
            this._afterClosed.next(response);
        }
        onButtonClick(_Button) {
            this.defaultResponse.setClickedButtonID(_Button.ID);
            this._onButtonClick.next(_Button);
        }
        setButtonList(_ButtonList) {
            this._buttonList.next(_ButtonList);
        }
        setDefaultResponse(_Response) {
            this.defaultResponse = _Response;
        }
    }
    ToastNotificationClass.ToastNotificationEventsController = ToastNotificationEventsController;
    // endregion
    class ToastNotificationDefaultResponse extends ToastNotificationResponse {
        constructor() {
            super();
            this.toastNotificationBelonging = null;
        }
        setBelonging(_ToastNotificationBelonging) {
            this.toastNotificationBelonging = _ToastNotificationBelonging;
        }
    }
    ToastNotificationClass.ToastNotificationDefaultResponse = ToastNotificationDefaultResponse;
    class ToastNotificationCarrier {
        constructor() {
            this.toastNotificationBelonging = new ToastNotificationClass.ToastNotificationBelonging();
        }
        setButtons(_Buttons) {
            if (_Buttons.length) {
                this.toastNotificationBelonging.Buttons = _Buttons;
            }
        }
        setTitle(_Title) {
            this.toastNotificationBelonging.Dispatch.Title = _Title;
        }
        setMessage(_Message) {
            this.toastNotificationBelonging.Dispatch.Message = _Message;
        }
        setButtonLabels(_Confirm, _Decline) {
            this.toastNotificationBelonging.ToastCoreConfig.ConfirmLabel = _Confirm;
            this.toastNotificationBelonging.ToastCoreConfig.DeclineLabel = _Decline;
        }
        setConfig(_ToastNotificationBelonging) {
            // region *** local UserConfig (defined on place where dialog is called) ***
            const dataControl = new GlobalClass.DataControl();
            dataControl.copyValuesFrom(_ToastNotificationBelonging, this.toastNotificationBelonging.ToastCoreConfig);
            // endregion
        }
        openToastNotification$() {
            if (!this.toastNotificationBelonging.Dispatch.Title &&
                !this.toastNotificationBelonging.Dispatch.Message) {
                throw Error("Toast notification can not be without both message and title.");
            }
            const service = ServiceLocator.injector.get(ToastNotificationService);
            return service.openToast$(this.toastNotificationBelonging);
        }
    }
    ToastNotificationClass.ToastNotificationCarrier = ToastNotificationCarrier;
    class GlobalToastSettings {
        constructor() {
            this.AllowedNotificationsAtOnce = null;
        }
    }
    ToastNotificationClass.GlobalToastSettings = GlobalToastSettings;
    class ResetToastGlobalSettings {
        constructor(globalToastConfig) {
            const globalToastConfigService = ServiceLocator.injector.get(ToastNotificationConfigService);
            if (globalToastConfigService) {
                globalToastConfigService.setResetGlobalToastConfig(globalToastConfig);
            }
            else {
                globalToastConfigService.setResetGlobalToastConfig();
            }
        }
    }
    ToastNotificationClass.ResetToastGlobalSettings = ResetToastGlobalSettings;
    class Settings {
        constructor() {
            this.Buttons = [];
            this.ToastCoreConfig = new ToastCoreConfig();
            this.Dispatch = new GlobalClass.Dispatch();
            this.GlobalSettings = new GlobalToastSettings();
        }
    }
    ToastNotificationClass.Settings = Settings;
    class ToastCoreConfig {
        constructor() {
            this.ToastPosition = null;
            this.ProgressBar = null;
            this.ToastUserViewType = null;
            this.OpenInElementID = null;
            this.ButtonPosition = null;
            this.TextPosition = null;
            this.LayoutType = null;
            this.Dispatch = null;
            this.ConfirmLabel = null;
            this.DeclineLabel = null;
            this.AutoCloseDelay = null;
            this.DisableIcon = null;
            this.AllowHTMLMessage = null;
        }
    }
    ToastNotificationClass.ToastCoreConfig = ToastCoreConfig;
    class ToastNotificationBelonging extends ToastNotificationClass.Settings {
        constructor() {
            super();
            this.EntityUniqueID = "T" + Math.random().toString(36).substr(2, 9);
            this.EventsController = new ToastNotificationEventsController(this.EntityUniqueID);
            const toastNotificationConfigurator = ServiceLocator.injector.get(ToastNotificationConfigService);
            const baseSettings = new ToastNotificationClass.Settings();
            const dataControl = new GlobalClass.DataControl();
            dataControl.copyValuesFrom(toastNotificationConfigurator.productionConfig.ToastCoreConfig, baseSettings.ToastCoreConfig);
            this.ToastCoreConfig = baseSettings.ToastCoreConfig;
            this.Buttons = toastNotificationConfigurator.productionConfig.Buttons.slice();
        }
    }
    ToastNotificationClass.ToastNotificationBelonging = ToastNotificationBelonging;
})(ToastNotificationClass || (ToastNotificationClass = {}));
export var ToastProgressBarEnum;
(function (ToastProgressBarEnum) {
    ToastProgressBarEnum[ToastProgressBarEnum["NONE"] = 0] = "NONE";
    ToastProgressBarEnum[ToastProgressBarEnum["INCREASE"] = 1] = "INCREASE";
    ToastProgressBarEnum[ToastProgressBarEnum["DECREASE"] = 2] = "DECREASE";
})(ToastProgressBarEnum || (ToastProgressBarEnum = {}));
export var ToastPositionEnum;
(function (ToastPositionEnum) {
    ToastPositionEnum["TOP_LEFT"] = "top-left";
    ToastPositionEnum["TOP_CENTER"] = "top-center";
    ToastPositionEnum["TOP_RIGHT"] = "top-right";
    ToastPositionEnum["TOP_FULL_WIDTH"] = "top-fullwidth";
    ToastPositionEnum["BOTTOM_LEFT"] = "bottom-left";
    ToastPositionEnum["BOTTOM_CENTER"] = "bottom-center";
    ToastPositionEnum["BOTTOM_RIGHT"] = "bottom-right";
    ToastPositionEnum["BOTTOM_FULL_WIDTH"] = "bottom-fullwidth";
})(ToastPositionEnum || (ToastPositionEnum = {}));
export var ToastUserViewTypeEnum;
(function (ToastUserViewTypeEnum) {
    ToastUserViewTypeEnum["SIMPLE"] = "simple";
    ToastUserViewTypeEnum["STANDARD"] = "standard";
})(ToastUserViewTypeEnum || (ToastUserViewTypeEnum = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9uZ3gtYXdlc29tZS1wb3B1cC90eXBlcy90b2FzdC1ub3RpZmljYXRpb24vY29yZS9tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVyQyxPQUFPLEVBQUUsV0FBVyxFQUFtQixNQUFNLHNCQUFzQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsOEJBQThCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUNyRixPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQW1FeEUsTUFBTSxLQUFXLHNCQUFzQixDQWtQdEM7QUFsUEQsV0FBaUIsc0JBQXNCO0lBQ3JDLHdCQUF3QjtJQUN4QixNQUFhLDRCQUE0QjtRQUd2QztZQUZRLDZCQUF3QixHQUFvRCxJQUFJLHNCQUFzQixDQUFDLHdCQUF3QixFQUFFLENBQUM7UUFFM0gsQ0FBQztRQUVoQixzQkFBc0I7WUFDcEIsT0FBTyxJQUFJLENBQUMsd0JBQXdCLENBQUMsc0JBQXNCLEVBQUUsQ0FBQyxJQUFJLENBQ2hFLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO2dCQUNYLE1BQU0sOEJBQThCLEdBQUcsSUFBSSx5QkFBeUIsRUFBRSxDQUFDO2dCQUN2RSxNQUFNLFdBQVcsR0FBRyxJQUFJLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDbEQsV0FBVyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsOEJBQThCLENBQUMsQ0FBQztnQkFDakUsT0FBTyw4QkFBOEIsQ0FBQztZQUN4QyxDQUFDLENBQUMsQ0FDSCxDQUFDO1FBQ0osQ0FBQztRQUVELFVBQVUsQ0FBQyxR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QzlELFlBQVksQ0FBQyxlQUFlLENBQzdCLENBQUM7WUFDRixJQUFJLENBQUMsZUFBZSxHQUFHLFlBQVksQ0FBQyxlQUFlLENBQUM7WUFDcEQsSUFBSSxDQUFDLE9BQU8sR0FBRyw2QkFBNkIsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDaEYsQ0FBQztLQUNGO0lBdkJZLGlEQUEwQiw2QkF1QnRDLENBQUE7QUFDSCxDQUFDLEVBbFBnQixzQkFBc0IsS0FBdEIsc0JBQXNCLFFBa1B0QztBQUVELE1BQU0sQ0FBTixJQUFZLG9CQUlYO0FBSkQsV0FBWSxvQkFBb0I7SUFDOUIsK0RBQVEsQ0FBQTtJQUNSLHVFQUFZLENBQUE7SUFDWix1RUFBWSxDQUFBO0FBQ2QsQ0FBQyxFQUpXLG9CQUFvQixLQUFwQixvQkFBb0IsUUFJL0I7QUFFRCxNQUFNLENBQU4sSUFBWSxpQkFTWDtBQVRELFdBQVksaUJBQWlCO0lBQzNCLDBDQUFxQixDQUFBO0lBQ3JCLDhDQUF5QixDQUFBO0lBQ3pCLDRDQUF1QixDQUFBO0lBQ3ZCLHFEQUFnQyxDQUFBO0lBQ2hDLGdEQUEyQixDQUFBO0lBQzNCLG9EQUErQixDQUFBO0lBQy9CLGtEQUE2QixDQUFBO0lBQzdCLDJEQUFzQyxDQUFBO0FBQ3hDLENBQUMsRUFUVyxpQkFBaUIsS0FBakIsaUJBQWlCLFFBUzVCO0FBRUQsTUFBTSxDQUFOLElBQVkscUJBR1g7QUFIRCxXQUFZLHFCQUFxQjtJQUMvQiwwQ0FBaUIsQ0FBQTtJQUNqQiw4Q0FBcUIsQ0FBQTtBQUN2QixDQUFDLEVBSFcscUJBQXFCLEtBQXJCLHFCQUFxQixRQUdoQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHsgbWFwIH0gZnJvbSBcInJ4anMvb3BlcmF0b3JzXCI7XG5pbXBvcnQgeyBEaWFsb2dMYXlvdXREaXNwbGF5LCBWZXJ0aWNhbFBvc2l0aW9uIH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvZW51bXNcIjtcbmltcG9ydCB7IEdsb2JhbENsYXNzLCBHbG9iYWxJbnRlcmZhY2UgfSBmcm9tIFwiLi4vLi4vLi4vY29yZS9nbG9iYWxcIjtcbmltcG9ydCB7IFNlcnZpY2VMb2NhdG9yIH0gZnJvbSBcIi4uLy4uLy4uL2xvY2F0b3Iuc2VydmljZVwiO1xuaW1wb3J0IHsgVG9hc3ROb3RpZmljYXRpb25Db25maWdTZXJ2aWNlIH0gZnJvbSBcIi4vdG9hc3Qtbm90aWZpY2F0aW9uLWNvbmZpZy5zZXJ2aWNlXCI7XG5pbXBvcnQgeyBUb2FzdE5vdGlmaWNhdGlvblNlcnZpY2UgfSBmcm9tIFwiLi90b2FzdC1ub3RpZmljYXRpb24uc2VydmljZVwiO1xuXG5leHBvcnQgbmFtZXNwYWNlIFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlIHtcbiAgZXhwb3J0IGludGVyZmFjZSBJVG9hc3ROb3RpZmljYXRpb25Vc2VyQ29uZmlnIHtcbiAgICBCdXR0b25zPzogR2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXTtcbiAgICBUb2FzdENvcmVDb25maWc/OiBUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JVG9hc3RDb3JlQ29uZmlnO1xuICAgIERpc3BhdGNoPzogR2xvYmFsSW50ZXJmYWNlLklEaXNwYXRjaDtcbiAgICBHbG9iYWxTZXR0aW5ncz86IFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklHbG9iYWxUb2FzdFNldHRpbmdzO1xuICB9XG5cbiAgZXhwb3J0IGludGVyZmFjZSBJR2xvYmFsVG9hc3RTZXR0aW5ncyB7XG4gICAgLyoqIE51bWJlciBvZiBwb3B1cHMgYWxsb3dlZCBvbiBzY3JlZW4sIHJlY29tbWVuZCAzLTUgKi9cbiAgICBBbGxvd2VkTm90aWZpY2F0aW9uc0F0T25jZTogbnVtYmVyO1xuICB9XG5cbiAgZXhwb3J0IGludGVyZmFjZSBJVG9hc3RDb3JlQ29uZmlnIHtcbiAgICBUb2FzdFBvc2l0aW9uPzogVG9hc3RQb3NpdGlvbkVudW07XG4gICAgUHJvZ3Jlc3NCYXI/OiBUb2FzdFByb2dyZXNzQmFyRW51bTtcbiAgICBUb2FzdFVzZXJWaWV3VHlwZT86IFRvYXN0VXNlclZpZXdUeXBlRW51bTtcbiAgICBPcGVuSW5FbGVtZW50SUQ/OiBzdHJpbmc7XG4gICAgQnV0dG9uUG9zaXRpb24/OiBWZXJ0aWNhbFBvc2l0aW9uO1xuICAgIFRleHRQb3NpdGlvbj86IFZlcnRpY2FsUG9zaXRpb247XG4gICAgTGF5b3V0VHlwZT86IERpYWxvZ0xheW91dERpc3BsYXk7XG4gICAgRGlzcGF0Y2g/OiBHbG9iYWxJbnRlcmZhY2UuSURpc3BhdGNoO1xuICAgIC8qKiBEZWZhdWx0IGNvbmZpcm0gYnV0dG9uIExhYmVsICovXG4gICAgQ29uZmlybUxhYmVsPzogc3RyaW5nO1xuICAgIC8qKiBEZWZhdWx0IGRlY2xpbmUgYnV0dG9uIExhYmVsICovXG4gICAgRGVjbGluZUxhYmVsPzogc3RyaW5nO1xuICAgIC8qKiBFeHByZXNzZWQgaW4gbWlsbGlzZWNvbmRzICovXG4gICAgQXV0b0Nsb3NlRGVsYXk/OiBudW1iZXI7XG4gICAgRGlzYWJsZUljb24/OiBib29sZWFuO1xuICAgIEFsbG93SFRNTE1lc3NhZ2U/OiBib29sZWFuO1xuICB9XG5cbiAgZXhwb3J0IGludGVyZmFjZSBJVG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcge1xuICAgIEJ1dHRvbnM6IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW107XG4gICAgVG9hc3RDb3JlQ29uZmlnOiBUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JVG9hc3RDb3JlQ29uZmlnO1xuICAgIEVudGl0eVVuaXF1ZUlEOiBzdHJpbmc7XG4gICAgRXZlbnRzQ29udHJvbGxlcjogVG9hc3ROb3RpZmljYXRpb25DbGFzcy5Ub2FzdE5vdGlmaWNhdGlvbkV2ZW50c0NvbnRyb2xsZXI7XG4gIH1cblxuICBleHBvcnQgaW50ZXJmYWNlIElUb2FzdE5vdGlmaWNhdGlvblJlc3BvbnNlIHtcbiAgICBzZXRTdWNjZXNzKF9Jc1N1Y2Nlc3M6IGJvb2xlYW4pOiB2b2lkO1xuXG4gICAgc2V0Q2xpY2tlZEJ1dHRvbklEKF9DbGlja2VkQnV0dG9uSUQpOiB2b2lkO1xuICB9XG5cbiAgZXhwb3J0IGludGVyZmFjZSBJVG9hc3ROb3RpZmljYXRpb25QdWJsaWNSZXNwb25zZSB7XG4gICAgU3VjY2VzczogYm9vbGVhbjtcbiAgICBDbGlja2VkQnV0dG9uSUQ6IHN0cmluZztcbiAgfVxuXG4gIGV4cG9ydCBpbnRlcmZhY2UgSVByaXZhdGVSZXNwb25zZU1lcmdlZFxuICAgIGV4dGVuZHMgSVRvYXN0Tm90aWZpY2F0aW9uUmVzcG9uc2UsXG4gICAgICBHbG9iYWxJbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZSB7XG4gICAgdG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmc6IFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklUb2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZztcbiAgfVxuXG4gIGV4cG9ydCBpbnRlcmZhY2UgSVRvYXN0Tm90aWZpY2F0aW9uUmF3U3RhdGUge1xuICAgIFdlYWtNYXA6IFdlYWtNYXA8XG4gICAgICBhbnksXG4gICAgICBUb2FzdE5vdGlmaWNhdGlvbkNsYXNzLlRvYXN0Tm90aWZpY2F0aW9uRXZlbnRzQ29udHJvbGxlclxuICAgID47XG4gICAgVG9hc3RCZWxvbmdpbmc6IFRvYXN0Tm90aWZpY2F0aW9uQ2xhc3MuVG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmc7XG4gIH1cbn1cblxuZXhwb3J0IG5hbWVzcGFjZSBUb2FzdE5vdGlmaWNhdGlvbkNsYXNzIHtcbiAgLy8gcmVnaW9uICoqKiBQdWJsaWMgKioqXG4gIGV4cG9ydCBjbGFzcyBUb2FzdE5vdGlmaWNhdGlvbkluaXRpYWxpemVyIHtcbiAgICBwcml2YXRlIHRvYXN0Tm90aWZpY2F0aW9uQ2FycmllcjogVG9hc3ROb3RpZmljYXRpb25DbGFzcy5Ub2FzdE5vdGlmaWNhdGlvbkNhcnJpZXIgPSBuZXcgVG9hc3ROb3RpZmljYXRpb25DbGFzcy5Ub2FzdE5vdGlmaWNhdGlvbkNhcnJpZXIoKTtcblxuICAgIGNvbnN0cnVjdG9yKCkge31cblxuICAgIG9wZW5Ub2FzdE5vdGlmaWNhdGlvbiQoKTogT2JzZXJ2YWJsZTxUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JVG9hc3ROb3RpZmljYXRpb25QdWJsaWNSZXNwb25zZT4ge1xuICAgICAgcmV0dXJuIHRoaXMudG9hc3ROb3RpZmljYXRpb25DYXJyaWVyLm9wZW5Ub2FzdE5vdGlmaWNhdGlvbiQoKS5waXBlKFxuICAgICAgICBtYXAoKHJlc3ApID0+IHtcbiAgICAgICAgICBjb25zdCBiYXNpY1RvYXN0Tm90aWZpY2F0aW9uUmVzcG9uc2UgPSBuZXcgVG9hc3ROb3RpZmljYXRpb25SZXNwb25zZSgpO1xuICAgICAgICAgIGNvbnN0IGRhdGFDb250cm9sID0gbmV3IEdsb2JhbENsYXNzLkRhdGFDb250cm9sKCk7XG4gICAgICAgICAgZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20ocmVzcCwgYmFzaWNUb2FzdE5vdGlmaWNhdGlvblJlc3BvbnNlKTtcbiAgICAgICAgICByZXR1cm4gYmFzaWNUb2FzdE5vdGlmaWNhdGlvblJlc3BvbnNlO1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBzZXRCdXR0b25zKF9CdXR0b25zOiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdKTogdm9pZCB7XG4gICAgICB0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQ2Fycmllci5zZXRCdXR0b25zKF9CdXR0b25zKTtcbiAgICB9XG5cbiAgICBzZXRDb25maWcoXG4gICAgICBfVG9hc3ROb3RpZmljYXRpb25Db25maWc6IFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklUb2FzdENvcmVDb25maWdcbiAgICApIHtcbiAgICAgIHRoaXMudG9hc3ROb3RpZmljYXRpb25DYXJyaWVyLnNldENvbmZpZyhfVG9hc3ROb3RpZmljYXRpb25Db25maWcpO1xuICAgIH1cblxuICAgIHNldERpc3BhdGNoKF9UaXRsZTogc3RyaW5nLCBfTWVzc2FnZTogc3RyaW5nID0gbnVsbCk6IHZvaWQge1xuICAgICAgdGhpcy50b2FzdE5vdGlmaWNhdGlvbkNhcnJpZXIuc2V0VGl0bGUoX1RpdGxlKTtcbiAgICAgIHRoaXMudG9hc3ROb3RpZmljYXRpb25DYXJyaWVyLnNldE1lc3NhZ2UoX01lc3NhZ2UpO1xuICAgIH1cblxuICAgIHNldFRpdGxlKF9UaXRsZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICB0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQ2Fycmllci5zZXRUaXRsZShfVGl0bGUpO1xuICAgIH1cblxuICAgIHNldE1lc3NhZ2UoX01lc3NhZ2U6IHN0cmluZyk6IHZvaWQge1xuICAgICAgdGhpcy50b2FzdE5vdGlmaWNhdGlvbkNhcnJpZXIuc2V0TWVzc2FnZShfTWVzc2FnZSk7XG4gICAgfVxuXG4gICAgc2V0QnV0dG9uTGFiZWxzKF9Db25maXJtOiBzdHJpbmcsIF9EZWNsaW5lPzogc3RyaW5nKTogdm9pZCB7XG4gICAgICB0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQ2Fycmllci5zZXRCdXR0b25MYWJlbHMoX0NvbmZpcm0sIF9EZWNsaW5lKTtcbiAgICB9XG4gIH1cblxuICBleHBvcnQgY2xhc3MgVG9hc3ROb3RpZmljYXRpb25SZXNwb25zZVxuICAgIGV4dGVuZHMgR2xvYmFsQ2xhc3MuRGF0YUNvbnRyb2xcbiAgICBpbXBsZW1lbnRzXG4gICAgICBUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JVG9hc3ROb3RpZmljYXRpb25SZXNwb25zZSxcbiAgICAgIFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklUb2FzdE5vdGlmaWNhdGlvblB1YmxpY1Jlc3BvbnNlIHtcbiAgICAvLyBwcml2YXRlIFJlc3BvbnNlOiBEaWFsb2dQcmVwYXJlUmVzcG9uc2UgICAgICAgICAgICA9IG5ldyBEaWFsb2dQcmVwYXJlUmVzcG9uc2UoKTtcblxuICAgIFN1Y2Nlc3M6IGJvb2xlYW4gPSBudWxsO1xuICAgIENsaWNrZWRCdXR0b25JRDogc3RyaW5nID0gbnVsbDtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgc3VwZXIoKTtcbiAgICB9XG5cbiAgICBzZXRTdWNjZXNzKF9Jc1N1Y2Nlc3M6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAgIHRoaXMuU3VjY2VzcyA9IF9Jc1N1Y2Nlc3M7XG4gICAgfVxuXG4gICAgc2V0Q2xpY2tlZEJ1dHRvbklEKF9DbGlja2VkQnV0dG9uSUQpOiB2b2lkIHtcbiAgICAgIHRoaXMuQ2xpY2tlZEJ1dHRvbklEID0gX0NsaWNrZWRCdXR0b25JRDtcbiAgICB9XG4gIH1cblxuICBleHBvcnQgY2xhc3MgVG9hc3ROb3RpZmljYXRpb25FdmVudHNDb250cm9sbGVyIHtcbiAgICBkZWZhdWx0UmVzcG9uc2U6IFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQ7XG5cbiAgICBwcml2YXRlIHJlYWRvbmx5IF9hZnRlckNsb3NlZDogU3ViamVjdDxUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPiA9IG5ldyBTdWJqZWN0PFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQ+KCk7XG4gICAgYWZ0ZXJDbG9zZWQkOiBPYnNlcnZhYmxlPFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQ+ID0gdGhpcy5fYWZ0ZXJDbG9zZWQuYXNPYnNlcnZhYmxlKCk7XG4gICAgcHJpdmF0ZSByZWFkb25seSBfb25CdXR0b25DbGljazogU3ViamVjdDxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbj4gPSBuZXcgU3ViamVjdDxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbj4oKTtcbiAgICBvbkJ1dHRvbkNsaWNrJDogT2JzZXJ2YWJsZTxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbj4gPSB0aGlzLl9vbkJ1dHRvbkNsaWNrLmFzT2JzZXJ2YWJsZSgpO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX2J1dHRvbkxpc3Q6IFN1YmplY3Q8XG4gICAgICBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdXG4gICAgPiA9IG5ldyBTdWJqZWN0PEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10+KCk7XG4gICAgYnV0dG9uTGlzdCQ6IE9ic2VydmFibGU8XG4gICAgICBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdXG4gICAgPiA9IHRoaXMuX2J1dHRvbkxpc3QuYXNPYnNlcnZhYmxlKCk7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIEVudGl0eVVuaXF1ZUlEOiBzdHJpbmcpIHt9XG5cbiAgICBjbG9zZShfUmVzcG9uc2U/OiBUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkKTogdm9pZCB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IF9SZXNwb25zZSA/IF9SZXNwb25zZSA6IHRoaXMuZGVmYXVsdFJlc3BvbnNlO1xuICAgICAgdGhpcy5fYWZ0ZXJDbG9zZWQubmV4dChyZXNwb25zZSk7XG4gICAgfVxuXG4gICAgb25CdXR0b25DbGljayhfQnV0dG9uOiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbik6IHZvaWQge1xuICAgICAgdGhpcy5kZWZhdWx0UmVzcG9uc2Uuc2V0Q2xpY2tlZEJ1dHRvbklEKF9CdXR0b24uSUQpO1xuICAgICAgdGhpcy5fb25CdXR0b25DbGljay5uZXh0KF9CdXR0b24pO1xuICAgIH1cblxuICAgIHNldEJ1dHRvbkxpc3QoX0J1dHRvbkxpc3Q6IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10pOiB2b2lkIHtcbiAgICAgIHRoaXMuX2J1dHRvbkxpc3QubmV4dChfQnV0dG9uTGlzdCk7XG4gICAgfVxuXG4gICAgc2V0RGVmYXVsdFJlc3BvbnNlKFxuICAgICAgX1Jlc3BvbnNlOiBUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkXG4gICAgKTogdm9pZCB7XG4gICAgICB0aGlzLmRlZmF1bHRSZXNwb25zZSA9IF9SZXNwb25zZTtcbiAgICB9XG4gIH1cblxuICAvLyBlbmRyZWdpb25cblxuICBleHBvcnQgY2xhc3MgVG9hc3ROb3RpZmljYXRpb25EZWZhdWx0UmVzcG9uc2VcbiAgICBleHRlbmRzIFRvYXN0Tm90aWZpY2F0aW9uUmVzcG9uc2VcbiAgICBpbXBsZW1lbnRzIFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQge1xuICAgIHRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nOiBUb2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZyA9IG51bGw7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgIHN1cGVyKCk7XG4gICAgfVxuXG4gICAgc2V0QmVsb25naW5nKF9Ub2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZyk6IHZvaWQge1xuICAgICAgdGhpcy50b2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZyA9IF9Ub2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZztcbiAgICB9XG4gIH1cblxuICBleHBvcnQgY2xhc3MgVG9hc3ROb3RpZmljYXRpb25DYXJyaWVyIHtcbiAgICB0b2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZzogVG9hc3ROb3RpZmljYXRpb25DbGFzcy5Ub2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZyA9IG5ldyBUb2FzdE5vdGlmaWNhdGlvbkNsYXNzLlRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nKCk7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgICBzZXRCdXR0b25zKF9CdXR0b25zOiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdKSB7XG4gICAgICBpZiAoX0J1dHRvbnMubGVuZ3RoKSB7XG4gICAgICAgIHRoaXMudG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcuQnV0dG9ucyA9IF9CdXR0b25zO1xuICAgICAgfVxuICAgIH1cblxuICAgIHNldFRpdGxlKF9UaXRsZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICB0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nLkRpc3BhdGNoLlRpdGxlID0gX1RpdGxlO1xuICAgIH1cblxuICAgIHNldE1lc3NhZ2UoX01lc3NhZ2U6IHN0cmluZyk6IHZvaWQge1xuICAgICAgdGhpcy50b2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZy5EaXNwYXRjaC5NZXNzYWdlID0gX01lc3NhZ2U7XG4gICAgfVxuXG4gICAgc2V0QnV0dG9uTGFiZWxzKF9Db25maXJtOiBzdHJpbmcsIF9EZWNsaW5lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgIHRoaXMudG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmcuVG9hc3RDb3JlQ29uZmlnLkNvbmZpcm1MYWJlbCA9IF9Db25maXJtO1xuICAgICAgdGhpcy50b2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZy5Ub2FzdENvcmVDb25maWcuRGVjbGluZUxhYmVsID0gX0RlY2xpbmU7XG4gICAgfVxuXG4gICAgc2V0Q29uZmlnKFxuICAgICAgX1RvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nOiBUb2FzdE5vdGlmaWNhdGlvbkludGVyZmFjZS5JVG9hc3RDb3JlQ29uZmlnXG4gICAgKSB7XG4gICAgICAvLyByZWdpb24gKioqIGxvY2FsIFVzZXJDb25maWcgKGRlZmluZWQgb24gcGxhY2Ugd2hlcmUgZGlhbG9nIGlzIGNhbGxlZCkgKioqXG4gICAgICBjb25zdCBkYXRhQ29udHJvbCA9IG5ldyBHbG9iYWxDbGFzcy5EYXRhQ29udHJvbCgpO1xuICAgICAgZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20oXG4gICAgICAgIF9Ub2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZyxcbiAgICAgICAgdGhpcy50b2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZy5Ub2FzdENvcmVDb25maWdcbiAgICAgICk7XG4gICAgICAvLyBlbmRyZWdpb25cbiAgICB9XG5cbiAgICBvcGVuVG9hc3ROb3RpZmljYXRpb24kKCk6IE9ic2VydmFibGU8VG9hc3ROb3RpZmljYXRpb25JbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZD4ge1xuICAgICAgaWYgKFxuICAgICAgICAhdGhpcy50b2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZy5EaXNwYXRjaC5UaXRsZSAmJlxuICAgICAgICAhdGhpcy50b2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZy5EaXNwYXRjaC5NZXNzYWdlXG4gICAgICApIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgXCJUb2FzdCBub3RpZmljYXRpb24gY2FuIG5vdCBiZSB3aXRob3V0IGJvdGggbWVzc2FnZSBhbmQgdGl0bGUuXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHNlcnZpY2U6IFRvYXN0Tm90aWZpY2F0aW9uU2VydmljZSA9IFNlcnZpY2VMb2NhdG9yLmluamVjdG9yLmdldChcbiAgICAgICAgVG9hc3ROb3RpZmljYXRpb25TZXJ2aWNlXG4gICAgICApO1xuICAgICAgcmV0dXJuIHNlcnZpY2Uub3BlblRvYXN0JCh0aGlzLnRvYXN0Tm90aWZpY2F0aW9uQmVsb25naW5nKTtcbiAgICB9XG4gIH1cblxuICBleHBvcnQgY2xhc3MgR2xvYmFsVG9hc3RTZXR0aW5nc1xuICAgIGltcGxlbWVudHMgVG9hc3ROb3RpZmljYXRpb25JbnRlcmZhY2UuSUdsb2JhbFRvYXN0U2V0dGluZ3Mge1xuICAgIEFsbG93ZWROb3RpZmljYXRpb25zQXRPbmNlOiBudW1iZXIgPSBudWxsO1xuICB9XG5cbiAgZXhwb3J0IGNsYXNzIFJlc2V0VG9hc3RHbG9iYWxTZXR0aW5ncyB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgICBnbG9iYWxUb2FzdENvbmZpZz86IFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklHbG9iYWxUb2FzdFNldHRpbmdzXG4gICAgKSB7XG4gICAgICBjb25zdCBnbG9iYWxUb2FzdENvbmZpZ1NlcnZpY2U6IFRvYXN0Tm90aWZpY2F0aW9uQ29uZmlnU2VydmljZSA9IFNlcnZpY2VMb2NhdG9yLmluamVjdG9yLmdldChcbiAgICAgICAgVG9hc3ROb3RpZmljYXRpb25Db25maWdTZXJ2aWNlXG4gICAgICApO1xuICAgICAgaWYgKGdsb2JhbFRvYXN0Q29uZmlnU2VydmljZSkge1xuICAgICAgICBnbG9iYWxUb2FzdENvbmZpZ1NlcnZpY2Uuc2V0UmVzZXRHbG9iYWxUb2FzdENvbmZpZyhnbG9iYWxUb2FzdENvbmZpZyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBnbG9iYWxUb2FzdENvbmZpZ1NlcnZpY2Uuc2V0UmVzZXRHbG9iYWxUb2FzdENvbmZpZygpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGV4cG9ydCBjbGFzcyBTZXR0aW5ncyB7XG4gICAgQnV0dG9uczogR2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXSA9IFtdO1xuICAgIFRvYXN0Q29yZUNvbmZpZzogVG9hc3ROb3RpZmljYXRpb25JbnRlcmZhY2UuSVRvYXN0Q29yZUNvbmZpZyA9IG5ldyBUb2FzdENvcmVDb25maWcoKTtcbiAgICBEaXNwYXRjaDogR2xvYmFsSW50ZXJmYWNlLklEaXNwYXRjaCA9IG5ldyBHbG9iYWxDbGFzcy5EaXNwYXRjaCgpO1xuICAgIEdsb2JhbFNldHRpbmdzOiBHbG9iYWxUb2FzdFNldHRpbmdzID0gbmV3IEdsb2JhbFRvYXN0U2V0dGluZ3MoKTtcbiAgfVxuXG4gIGV4cG9ydCBjbGFzcyBUb2FzdENvcmVDb25maWdcbiAgICBpbXBsZW1lbnRzIFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklUb2FzdENvcmVDb25maWcge1xuICAgIFRvYXN0UG9zaXRpb246IFRvYXN0UG9zaXRpb25FbnVtID0gbnVsbDtcbiAgICBQcm9ncmVzc0JhcjogVG9hc3RQcm9ncmVzc0JhckVudW0gPSBudWxsO1xuICAgIFRvYXN0VXNlclZpZXdUeXBlOiBUb2FzdFVzZXJWaWV3VHlwZUVudW0gPSBudWxsO1xuICAgIE9wZW5JbkVsZW1lbnRJRDogc3RyaW5nID0gbnVsbDtcbiAgICBCdXR0b25Qb3NpdGlvbjogVmVydGljYWxQb3NpdGlvbiA9IG51bGw7XG4gICAgVGV4dFBvc2l0aW9uOiBWZXJ0aWNhbFBvc2l0aW9uID0gbnVsbDtcbiAgICBMYXlvdXRUeXBlOiBEaWFsb2dMYXlvdXREaXNwbGF5ID0gbnVsbDtcbiAgICBEaXNwYXRjaDogR2xvYmFsSW50ZXJmYWNlLklEaXNwYXRjaCA9IG51bGw7XG4gICAgQ29uZmlybUxhYmVsOiBzdHJpbmcgPSBudWxsO1xuICAgIERlY2xpbmVMYWJlbDogc3RyaW5nID0gbnVsbDtcbiAgICBBdXRvQ2xvc2VEZWxheTogbnVtYmVyID0gbnVsbDtcbiAgICBEaXNhYmxlSWNvbjogYm9vbGVhbiA9IG51bGw7XG4gICAgQWxsb3dIVE1MTWVzc2FnZTogYm9vbGVhbiA9IG51bGw7XG4gIH1cblxuICBleHBvcnQgY2xhc3MgVG9hc3ROb3RpZmljYXRpb25CZWxvbmdpbmdcbiAgICBleHRlbmRzIFRvYXN0Tm90aWZpY2F0aW9uQ2xhc3MuU2V0dGluZ3NcbiAgICBpbXBsZW1lbnRzIFRvYXN0Tm90aWZpY2F0aW9uSW50ZXJmYWNlLklUb2FzdE5vdGlmaWNhdGlvbkJlbG9uZ2luZyB7XG4gICAgRW50aXR5VW5pcXVlSUQ6IHN0cmluZyA9IFwiVFwiICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpO1xuICAgIEV2ZW50c0NvbnRyb2xsZXI6IFRvYXN0Tm90aWZpY2F0aW9uRXZlbnRzQ29udHJvbGxlcjtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgc3VwZXIoKTtcbiAgICAgIHRoaXMuRXZlbnRzQ29udHJvbGxlciA9IG5ldyBUb2FzdE5vdGlmaWNhdGlvbkV2ZW50c0NvbnRyb2xsZXIoXG4gICAgICAgIHRoaXMuRW50aXR5VW5pcXVlSURcbiAgICAgICk7XG4gICAgICBjb25zdCB0b2FzdE5vdGlmaWNhdGlvbkNvbmZpZ3VyYXRvcjogVG9hc3ROb3RpZmljYXRpb25Db25maWdTZXJ2aWNlID0gU2VydmljZUxvY2F0b3IuaW5qZWN0b3IuZ2V0KFxuICAgICAgICBUb2FzdE5vdGlmaWNhdGlvbkNvbmZpZ1NlcnZpY2VcbiAgICAgICk7XG4gICAgICBjb25zdCBiYXNlU2V0dGluZ3MgPSBuZXcgVG9hc3ROb3RpZmljYXRpb25DbGFzcy5TZXR0aW5ncygpO1xuICAgICAgY29uc3QgZGF0YUNvbnRyb2wgPSBuZXcgR2xvYmFsQ2xhc3MuRGF0YUNvbnRyb2woKTtcbiAgICAgIGRhdGFDb250cm9sLmNvcHlWYWx1ZXNGcm9tKFxuICAgICAgICB0b2FzdE5vdGlmaWNhdGlvbkNvbmZpZ3VyYXRvci5wcm9kdWN0aW9uQ29uZmlnLlRvYXN0Q29yZUNvbmZpZyxcbiAgICAgICAgYmFzZVNldHRpbmdzLlRvYXN0Q29yZUNvbmZpZ1xuICAgICAgKTtcbiAgICAgIHRoaXMuVG9hc3RDb3JlQ29uZmlnID0gYmFzZVNldHRpbmdzLlRvYXN0Q29yZUNvbmZpZztcbiAgICAgIHRoaXMuQnV0dG9ucyA9IHRvYXN0Tm90aWZpY2F0aW9uQ29uZmlndXJhdG9yLnByb2R1Y3Rpb25Db25maWcuQnV0dG9ucy5zbGljZSgpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZW51bSBUb2FzdFByb2dyZXNzQmFyRW51bSB7XG4gIE5PTkUgPSAwLFxuICBJTkNSRUFTRSA9IDEsXG4gIERFQ1JFQVNFID0gMixcbn1cblxuZXhwb3J0IGVudW0gVG9hc3RQb3NpdGlvbkVudW0ge1xuICBUT1BfTEVGVCA9IFwidG9wLWxlZnRcIixcbiAgVE9QX0NFTlRFUiA9IFwidG9wLWNlbnRlclwiLFxuICBUT1BfUklHSFQgPSBcInRvcC1yaWdodFwiLFxuICBUT1BfRlVMTF9XSURUSCA9IFwidG9wLWZ1bGx3aWR0aFwiLFxuICBCT1RUT01fTEVGVCA9IFwiYm90dG9tLWxlZnRcIixcbiAgQk9UVE9NX0NFTlRFUiA9IFwiYm90dG9tLWNlbnRlclwiLFxuICBCT1RUT01fUklHSFQgPSBcImJvdHRvbS1yaWdodFwiLFxuICBCT1RUT01fRlVMTF9XSURUSCA9IFwiYm90dG9tLWZ1bGx3aWR0aFwiLFxufVxuXG5leHBvcnQgZW51bSBUb2FzdFVzZXJWaWV3VHlwZUVudW0ge1xuICBTSU1QTEUgPSBcInNpbXBsZVwiLFxuICBTVEFOREFSRCA9IFwic3RhbmRhcmRcIixcbn1cbiJdfQ==