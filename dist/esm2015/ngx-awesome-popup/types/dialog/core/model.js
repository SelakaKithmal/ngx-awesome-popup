import { Subject } from 'rxjs';
import { ServiceLocator } from '../../../locator.service';
import { DialogConfigService } from './dialog-config.service';
import { map } from 'rxjs/operators';
import { GlobalClass } from '../../../core/global';
import { DialogService } from './dialog.service';
export var DialogClass;
(function (DialogClass) {
    // region *** Public ***
    class DialogInitializer {
        constructor(component) {
            this.component = component;
            this.dialogCarrier = new DialogClass.DialogCarrier();
            this.dialogCarrier.setComponent(this.component);
        }
        /** Generic method accept expected payload from dynamic child component.*/
        openDialog$() {
            return this.dialogCarrier.openDialog$().pipe(map(resp => {
                const basicDialogResponse = new DialogResponse();
                const dataControl = new GlobalClass.DataControl();
                dataControl.copyValuesFrom(resp, basicDialogResponse);
                return basicDialogResponse;
            }));
        }
        /** It accepts list of custom buttons */
        setButtons(_Buttons) {
            this.dialogCarrier.setButtons(_Buttons);
        }
        setCustomData(_CustomData) {
            this.dialogCarrier.setCustomData(_CustomData);
        }
        setConfig(_DialogConfig) {
            this.dialogCarrier.setConfig(_DialogConfig);
        }
    }
    DialogClass.DialogInitializer = DialogInitializer;
    class DialogResponse extends GlobalClass.DataControl {
        constructor() {
            super();
            // private Response: DialogPrepareResponse            = new DialogPrepareResponse();
            this.Payload = null;
            this.Success = null;
            this.ClickedButtonID = null;
        }
        /**
         * @ignore
         */
        setPayload(_Payload) {
            this.Payload = _Payload;
        }
        /**
         * @ignore
         */
        setSuccess(_IsSuccess) {
            this.Success = _IsSuccess;
        }
        /**
         * @ignore
         */
        setClickedButtonID(_ClickedButtonID) {
            this.ClickedButtonID = _ClickedButtonID;
        }
    }
    DialogClass.DialogResponse = DialogResponse;
    class DialogEventsController {
        constructor(EntityUniqueID) {
            this.EntityUniqueID = EntityUniqueID;
            this._afterClosed = new Subject();
            this.afterClosed$ = this._afterClosed.asObservable();
            this._afterLoader = new Subject();
            this.afterLoader$ = this._afterLoader.asObservable();
            this._onButtonClick = new Subject();
            this.onButtonClick$ = this._onButtonClick.asObservable();
            this._buttonList = new Subject();
            this.buttonList$ = this._buttonList.asObservable();
        }
        close(_Response) {
            const response = _Response ? _Response : this.defaultResponse;
            this._afterClosed.next(response);
        }
        onButtonClick(_Button) {
            this.defaultResponse.setClickedButtonID(_Button.ID);
            this._onButtonClick.next(_Button);
        }
        setButtonList(_ButtonList) {
            this._buttonList.next(_ButtonList);
        }
        closeLoader() {
            setTimeout(() => {
                this._afterLoader.next(this.EntityUniqueID);
            }, 0);
        }
        setDefaultResponse(_Response) {
            this.defaultResponse = _Response;
        }
    }
    DialogClass.DialogEventsController = DialogEventsController;
    // endregion
    class DialogDefaultResponse extends DialogResponse {
        constructor() {
            super();
            this.DialogBelonging = null;
        }
        setBelonging(_DialogBelonging) {
            this.DialogBelonging = _DialogBelonging;
        }
    }
    DialogClass.DialogDefaultResponse = DialogDefaultResponse;
    class DialogCarrier {
        constructor() {
            this.dialogBelonging = new DialogBelonging();
        }
        setComponent(_Component) {
            this.component = _Component;
        }
        setButtons(_Buttons) {
            if (_Buttons.length) {
                this.dialogBelonging.Buttons = _Buttons;
            }
        }
        setCustomData(_CustomData) {
            this.dialogBelonging.CustomData = _CustomData;
        }
        setConfig(_DialogConfig) {
            // region *** local UserConfig (defined on place where dialog is called) ***
            const dataControl = new GlobalClass.DataControl();
            dataControl.copyValuesFrom(_DialogConfig, this.dialogBelonging.DialogCoreConfig);
            // endregion
        }
        openDialog$() {
            const service = ServiceLocator.injector.get(DialogService);
            const dialogController = service.open(this.component, this.dialogBelonging);
            return dialogController.afterClosed$;
        }
    }
    DialogClass.DialogCarrier = DialogCarrier;
    class DialogCoreConfig {
        constructor() {
            this.Width = null;
            this.Height = null;
            this.ButtonPosition = null;
            this.LayoutType = null;
            this.DisplayLoader = null;
            this.LoaderComponent = null;
        }
    }
    DialogClass.DialogCoreConfig = DialogCoreConfig;
    class DialogSettings {
        constructor() {
            this.Buttons = [];
            this.DialogCoreConfig = new DialogCoreConfig();
        }
    }
    DialogClass.DialogSettings = DialogSettings;
    class DialogBelonging extends DialogSettings {
        constructor() {
            super();
            /** @internal */
            this.EntityUniqueID = 'D' + Math.random().toString(36).substr(2, 9);
            this.CustomData = null;
            this.EventsController = new DialogEventsController(this.EntityUniqueID);
            const dialogConfigurator = ServiceLocator.injector.get(DialogConfigService);
            const baseSettings = new DialogSettings();
            const dataControl = new GlobalClass.DataControl();
            dataControl.copyValuesFrom(dialogConfigurator.productionConfig.DialogCoreConfig, baseSettings.DialogCoreConfig);
            this.DialogCoreConfig = baseSettings.DialogCoreConfig;
            this.Buttons = dialogConfigurator.productionConfig.Buttons.slice();
        }
    }
    DialogClass.DialogBelonging = DialogBelonging;
})(DialogClass || (DialogClass = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9uZ3gtYXdlc29tZS1wb3B1cC90eXBlcy9kaWFsb2cvY29yZS9tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWEsT0FBTyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBRXpDLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUN4RCxPQUFPLEVBQUMsbUJBQW1CLEVBQUMsTUFBTSx5QkFBeUIsQ0FBQztBQUU1RCxPQUFPLEVBQUMsR0FBRyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDbkMsT0FBTyxFQUFDLFdBQVcsRUFBa0IsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRSxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sa0JBQWtCLENBQUM7QUFpRy9DLE1BQU0sS0FBVyxXQUFXLENBd00zQjtBQXhNRCxXQUFpQixXQUFXO0lBRXhCLHdCQUF3QjtJQUV4QixNQUFhLGlCQUFpQjtRQUkxQixZQUFvQixTQUFvQjtZQUFwQixjQUFTLEdBQVQsU0FBUyxDQUFXO1lBRmhDLGtCQUFhLEdBQWtCLElBQUksV0FBVyxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBR25FLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNwRCxDQUFDO1FBRUQsMEVBQTBFO1FBQzFFLFdBQVc7WUFDUCxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRTtnQkFDcEQsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO2dCQUNqRCxNQUFNLFdBQVcsR0FBVyxJQUFJLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDMUQsV0FBVyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztn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WUFDOUUsV0FBVyxDQUFDLGNBQWMsQ0FBQyxrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxnQkFBZ0IsRUFBRSxZQUFZLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztZQUNoSCxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsWUFBWSxDQUFDLGdCQUFnQixDQUFDO1lBQ3RELElBQUksQ0FBQyxPQUFPLEdBQVksa0JBQWtCLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2hGLENBQUM7S0FFSjtJQW5CWSwyQkFBZSxrQkFtQjNCLENBQUE7QUFDTCxDQUFDLEVBeE1nQixXQUFXLEtBQVgsV0FBVyxRQXdNM0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge09ic2VydmFibGUsIFN1YmplY3R9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtUeXBlfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7U2VydmljZUxvY2F0b3J9IGZyb20gJy4uLy4uLy4uL2xvY2F0b3Iuc2VydmljZSc7XG5pbXBvcnQge0RpYWxvZ0NvbmZpZ1NlcnZpY2V9IGZyb20gJy4vZGlhbG9nLWNvbmZpZy5zZXJ2aWNlJztcbmltcG9ydCB7RGlhbG9nTGF5b3V0RGlzcGxheSwgVmVydGljYWxQb3NpdGlvbn0gZnJvbSAnLi4vLi4vLi4vY29yZS9lbnVtcyc7XG5pbXBvcnQge21hcH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtHbG9iYWxDbGFzcywgR2xvYmFsSW50ZXJmYWNlfSBmcm9tICcuLi8uLi8uLi9jb3JlL2dsb2JhbCc7XG5pbXBvcnQge0RpYWxvZ1NlcnZpY2V9IGZyb20gJy4vZGlhbG9nLnNlcnZpY2UnO1xuXG5leHBvcnQgbmFtZXNwYWNlIERpYWxvZ0ludGVyZmFjZSB7XG4gICAgXG4gICAgLyoqXG4gICAgICogQ2hlY2sgaW50ZXJmYWNlIG9mIHByb3BlcnRpZXMuXG4gICAgICovXG4gICAgZXhwb3J0IGludGVyZmFjZSBJRGlhbG9nVXNlckNvbmZpZyB7XG4gICAgICAgIEJ1dHRvbnM/OiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdO1xuICAgICAgICBEaWFsb2dDb3JlQ29uZmlnPzogRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dDb3JlQ29uZmlnO1xuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBPcHRpb25hbCB1c2VyIGNvbmZpZ3VyYXRpb24uXG4gICAgICpcbiAgICAgKiBFeGFtcGxlOlxuICAgICAqIGBgYHR5cGVzY3JpcHRcbiAgICAgKiAvLyBEaWFsb2cgY29yZSBjb25maWcgb2JqZWN0IGV4YW1wbGUuXG4gICAgICogY29uc3QgZGlhbG9nQ29yZUNvbmZpZyA9IHtcbiAgICAgKiAgICAgRGlhbG9nQ29yZUNvbmZpZzoge1xuICAgICAqICAgICAgICBXaWR0aCAgICAgICAgIDogJzUwMHB4JyxcbiAgICAgKiAgICAgICAgSGVpZ2h0ICAgICAgICA6ICc1MDBweCcsXG4gICAgICogICAgICAgIEJ1dHRvblBvc2l0aW9uOiAncmlnaHQnLFxuICAgICAqICAgICAgICBMYXlvdXRUeXBlOiBEaWFsb2dMYXlvdXREaXNwbGF5LklORk8sXG4gICAgICogICAgICAgIExvYWRlckNvbXBvbmVudDogLy8gQW55IEFuZ3VsYXIgY29tcG9uZW50IGNsYXNzIG5hbWUgY2FuIGJlIGluY2x1ZGVkIGFzIGEgbG9hZGVyLlxuICAgICAqICAgICAgICBEaXNwbGF5TG9hZGVyOiBmYWxzZSAvLyBUaGlzIHdpbGwgb3ZlcnJpZGUgTG9hZGVyQ29tcG9uZW50LlxuICAgICAqICAgICB9XG4gICAgICogIH1cbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBleHBvcnQgaW50ZXJmYWNlIElEaWFsb2dDb3JlQ29uZmlnIHtcbiAgICAgICAgLyoqIEZpeGVkIHBvcHVwIHdpZHRoICovXG4gICAgICAgIFdpZHRoPzogc3RyaW5nO1xuICAgICAgICAvKiogRml4ZWQgcG9wdXAgaGVpZ2h0ICovXG4gICAgICAgIEhlaWdodD86IHN0cmluZztcbiAgICAgICAgQnV0dG9uUG9zaXRpb24/OiBWZXJ0aWNhbFBvc2l0aW9uO1xuICAgICAgICBMYXlvdXRUeXBlPzogRGlhbG9nTGF5b3V0RGlzcGxheTtcbiAgICAgICAgRGlzcGxheUxvYWRlcj86IGJvb2xlYW47XG4gICAgICAgIExvYWRlckNvbXBvbmVudD86IFR5cGU8YW55PjtcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGludGVyZmFjZSBJRGlhbG9nQmVsb25naW5nIHtcbiAgICAgICAgQnV0dG9uczogR2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXTtcbiAgICAgICAgRGlhbG9nQ29yZUNvbmZpZzogRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dDb3JlQ29uZmlnO1xuICAgICAgICBFbnRpdHlVbmlxdWVJRDogc3RyaW5nO1xuICAgICAgICBDdXN0b21EYXRhOiBhbnk7XG4gICAgICAgIEV2ZW50c0NvbnRyb2xsZXI6IERpYWxvZ0ludGVyZmFjZS5JRGlhbG9nRXZlbnRzQ29udHJvbGxlcjtcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGludGVyZmFjZSBJRGlhbG9nRXZlbnRzQ29udHJvbGxlciB7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgZGVmYXVsdFJlc3BvbnNlOiBEaWFsb2dJbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZDtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICBhZnRlckNsb3NlZCQ6IE9ic2VydmFibGU8RGlhbG9nSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQ+O1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIGFmdGVyTG9hZGVyJDogT2JzZXJ2YWJsZTxzdHJpbmc+O1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIG9uQnV0dG9uQ2xpY2skOiBPYnNlcnZhYmxlPEdsb2JhbEludGVyZmFjZS5JQnV0dG9uPjtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICBidXR0b25MaXN0JDogT2JzZXJ2YWJsZTxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdPjtcbiAgICAgICAgXG4gICAgICAgIGNsb3NlKF9SZXNwb25zZT86IERpYWxvZ0ludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkKTogdm9pZDtcbiAgICAgICAgXG4gICAgICAgIG9uQnV0dG9uQ2xpY2soX0J1dHRvbjogR2xvYmFsSW50ZXJmYWNlLklCdXR0b24pOiB2b2lkO1xuICAgICAgICBcbiAgICAgICAgc2V0QnV0dG9uTGlzdChfQnV0dG9uTGlzdDogR2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXSk6IHZvaWQ7XG4gICAgICAgIFxuICAgICAgICBjbG9zZUxvYWRlcigpOiB2b2lkO1xuICAgICAgICBcbiAgICAgICAgc2V0RGVmYXVsdFJlc3BvbnNlKF9SZXNwb25zZTogRGlhbG9nSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQpOiB2b2lkO1xuICAgIH1cbiAgICBcbiAgICBleHBvcnQgaW50ZXJmYWNlIElEaWFsb2dSZXNwb25zZSB7XG4gICAgICAgIFxuICAgICAgICBzZXRQYXlsb2FkKF9QYXlsb2FkOiBhbnkpOiB2b2lkO1xuICAgICAgICBcbiAgICAgICAgc2V0U3VjY2VzcyhfSXNTdWNjZXNzOiBib29sZWFuKTogdm9pZDtcbiAgICAgICAgXG4gICAgICAgIHNldENsaWNrZWRCdXR0b25JRChfQ2xpY2tlZEJ1dHRvbklEKTogdm9pZDtcbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSURpYWxvZ1B1YmxpY1Jlc3BvbnNlPFJlc3BvbnNlUGF5bG9hZD4ge1xuICAgICAgICAvKiogR2VuZXJpYyBwcm9wZXJ0eSB0eXBlLCBhY2NlcHQgZXhwZWN0ZWQgcGF5bG9hZCBmcm9tIGR5bmFtaWMgY2hpbGQgY29tcG9uZW50LiAqL1xuICAgICAgICBQYXlsb2FkOiBSZXNwb25zZVBheWxvYWQ7XG4gICAgICAgIFN1Y2Nlc3M6IGJvb2xlYW47XG4gICAgICAgIENsaWNrZWRCdXR0b25JRDogc3RyaW5nXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSVByaXZhdGVSZXNwb25zZU1lcmdlZCBleHRlbmRzIElEaWFsb2dSZXNwb25zZSwgR2xvYmFsSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2Uge1xuICAgICAgICBcbiAgICAgICAgRGlhbG9nQmVsb25naW5nOiBEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ0JlbG9uZ2luZztcbiAgICB9XG4gICAgXG4gICAgXG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgRGlhbG9nQ2xhc3Mge1xuICAgIFxuICAgIC8vIHJlZ2lvbiAqKiogUHVibGljICoqKlxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBEaWFsb2dJbml0aWFsaXplciB7XG4gICAgICAgIFxuICAgICAgICBwcml2YXRlIGRpYWxvZ0NhcnJpZXI6IERpYWxvZ0NhcnJpZXIgPSBuZXcgRGlhbG9nQ2xhc3MuRGlhbG9nQ2FycmllcigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3RydWN0b3IocHJpdmF0ZSBjb21wb25lbnQ6IFR5cGU8YW55Pikge1xuICAgICAgICAgICAgdGhpcy5kaWFsb2dDYXJyaWVyLnNldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8qKiBHZW5lcmljIG1ldGhvZCBhY2NlcHQgZXhwZWN0ZWQgcGF5bG9hZCBmcm9tIGR5bmFtaWMgY2hpbGQgY29tcG9uZW50LiovXG4gICAgICAgIG9wZW5EaWFsb2ckPFJlc3BvbnNlUGF5bG9hZCA9IGFueT4oKTogT2JzZXJ2YWJsZTxEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ1B1YmxpY1Jlc3BvbnNlPFJlc3BvbnNlUGF5bG9hZD4+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRpYWxvZ0NhcnJpZXIub3BlbkRpYWxvZyQoKS5waXBlKG1hcChyZXNwID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBiYXNpY0RpYWxvZ1Jlc3BvbnNlID0gbmV3IERpYWxvZ1Jlc3BvbnNlKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YUNvbnRyb2wgICAgICAgICA9IG5ldyBHbG9iYWxDbGFzcy5EYXRhQ29udHJvbCgpO1xuICAgICAgICAgICAgICAgIGRhdGFDb250cm9sLmNvcHlWYWx1ZXNGcm9tKHJlc3AsIGJhc2ljRGlhbG9nUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybiBiYXNpY0RpYWxvZ1Jlc3BvbnNlO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvKiogSXQgYWNjZXB0cyBsaXN0IG9mIGN1c3RvbSBidXR0b25zICovXG4gICAgICAgIHNldEJ1dHRvbnMoX0J1dHRvbnM6IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10pOiB2b2lkIHtcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nQ2Fycmllci5zZXRCdXR0b25zKF9CdXR0b25zKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgc2V0Q3VzdG9tRGF0YShfQ3VzdG9tRGF0YTogYW55KSB7XG4gICAgICAgICAgICB0aGlzLmRpYWxvZ0NhcnJpZXIuc2V0Q3VzdG9tRGF0YShfQ3VzdG9tRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldENvbmZpZyhfRGlhbG9nQ29uZmlnOiBEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ0NvcmVDb25maWcpIHtcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nQ2Fycmllci5zZXRDb25maWcoX0RpYWxvZ0NvbmZpZyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBEaWFsb2dSZXNwb25zZSBleHRlbmRzIEdsb2JhbENsYXNzLkRhdGFDb250cm9sIGltcGxlbWVudHMgRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dSZXNwb25zZSwgRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dQdWJsaWNSZXNwb25zZTxhbnk+IHtcbiAgICAgICAgLy8gcHJpdmF0ZSBSZXNwb25zZTogRGlhbG9nUHJlcGFyZVJlc3BvbnNlICAgICAgICAgICAgPSBuZXcgRGlhbG9nUHJlcGFyZVJlc3BvbnNlKCk7XG4gICAgICAgIFxuICAgICAgICBQYXlsb2FkOiBhbnkgICAgICAgICAgICA9IG51bGw7XG4gICAgICAgIFN1Y2Nlc3M6IGJvb2xlYW4gICAgICAgID0gbnVsbDtcbiAgICAgICAgQ2xpY2tlZEJ1dHRvbklEOiBzdHJpbmcgPSBudWxsO1xuICAgICAgICBcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgICAgICBzdXBlcigpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvKipcbiAgICAgICAgICogQGlnbm9yZVxuICAgICAgICAgKi9cbiAgICAgICAgc2V0UGF5bG9hZChfUGF5bG9hZDogYW55KTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLlBheWxvYWQgPSBfUGF5bG9hZDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBpZ25vcmVcbiAgICAgICAgICovXG4gICAgICAgIHNldFN1Y2Nlc3MoX0lzU3VjY2VzczogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICAgICAgdGhpcy5TdWNjZXNzID0gX0lzU3VjY2VzcztcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBpZ25vcmVcbiAgICAgICAgICovXG4gICAgICAgIHNldENsaWNrZWRCdXR0b25JRChfQ2xpY2tlZEJ1dHRvbklEKTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLkNsaWNrZWRCdXR0b25JRCA9IF9DbGlja2VkQnV0dG9uSUQ7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBEaWFsb2dFdmVudHNDb250cm9sbGVyIGltcGxlbWVudHMgRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dFdmVudHNDb250cm9sbGVyIHtcbiAgICAgICAgXG4gICAgICAgIGRlZmF1bHRSZXNwb25zZTogRGlhbG9nSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQ7XG4gICAgICAgIFxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IF9hZnRlckNsb3NlZDogU3ViamVjdDxEaWFsb2dJbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZD4gPSBuZXcgU3ViamVjdDxEaWFsb2dJbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZD4oKTtcbiAgICAgICAgYWZ0ZXJDbG9zZWQkOiBPYnNlcnZhYmxlPERpYWxvZ0ludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPiAgICAgICAgICAgICAgID0gdGhpcy5fYWZ0ZXJDbG9zZWQuYXNPYnNlcnZhYmxlKCk7XG4gICAgICAgIFxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IF9hZnRlckxvYWRlcjogYW55ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IG5ldyBTdWJqZWN0PHN0cmluZz4oKTtcbiAgICAgICAgYWZ0ZXJMb2FkZXIkOiBPYnNlcnZhYmxlPHN0cmluZz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPSB0aGlzLl9hZnRlckxvYWRlci5hc09ic2VydmFibGUoKTtcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBfb25CdXR0b25DbGljazogU3ViamVjdDxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbj4gPSBuZXcgU3ViamVjdDxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbj4oKTtcbiAgICAgICAgb25CdXR0b25DbGljayQ6IE9ic2VydmFibGU8R2xvYmFsSW50ZXJmYWNlLklCdXR0b24+ICAgICAgICAgICAgICAgPSB0aGlzLl9vbkJ1dHRvbkNsaWNrLmFzT2JzZXJ2YWJsZSgpO1xuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IF9idXR0b25MaXN0OiBTdWJqZWN0PEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10+ICA9IG5ldyBTdWJqZWN0PEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10+KCk7XG4gICAgICAgIGJ1dHRvbkxpc3QkOiBPYnNlcnZhYmxlPEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10+ICAgICAgICAgICAgICAgID0gdGhpcy5fYnV0dG9uTGlzdC5hc09ic2VydmFibGUoKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgRW50aXR5VW5pcXVlSUQ6IHN0cmluZykge1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjbG9zZShfUmVzcG9uc2U/OiBEaWFsb2dJbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZCk6IHZvaWQge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBfUmVzcG9uc2UgPyBfUmVzcG9uc2UgOiB0aGlzLmRlZmF1bHRSZXNwb25zZTtcbiAgICAgICAgICAgIHRoaXMuX2FmdGVyQ2xvc2VkLm5leHQocmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBvbkJ1dHRvbkNsaWNrKF9CdXR0b246IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uKTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRSZXNwb25zZS5zZXRDbGlja2VkQnV0dG9uSUQoX0J1dHRvbi5JRCk7XG4gICAgICAgICAgICB0aGlzLl9vbkJ1dHRvbkNsaWNrLm5leHQoX0J1dHRvbik7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldEJ1dHRvbkxpc3QoX0J1dHRvbkxpc3Q6IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10pOiB2b2lkIHtcbiAgICAgICAgICAgIHRoaXMuX2J1dHRvbkxpc3QubmV4dChfQnV0dG9uTGlzdCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNsb3NlTG9hZGVyKCk6IHZvaWQge1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYWZ0ZXJMb2FkZXIubmV4dCh0aGlzLkVudGl0eVVuaXF1ZUlEKTtcbiAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldERlZmF1bHRSZXNwb25zZShfUmVzcG9uc2U6IERpYWxvZ0ludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkKTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRSZXNwb25zZSA9IF9SZXNwb25zZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBlbmRyZWdpb25cbiAgICBcbiAgICBleHBvcnQgY2xhc3MgRGlhbG9nRGVmYXVsdFJlc3BvbnNlIGV4dGVuZHMgRGlhbG9nUmVzcG9uc2UgaW1wbGVtZW50cyBEaWFsb2dJbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZCB7XG4gICAgICAgIERpYWxvZ0JlbG9uZ2luZzogRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dCZWxvbmdpbmcgPSBudWxsO1xuICAgICAgICBcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgICAgICBzdXBlcigpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBzZXRCZWxvbmdpbmcoX0RpYWxvZ0JlbG9uZ2luZyk6IHZvaWQge1xuICAgICAgICAgICAgdGhpcy5EaWFsb2dCZWxvbmdpbmcgPSBfRGlhbG9nQmVsb25naW5nO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgIH1cbiAgICBcbiAgICBleHBvcnQgY2xhc3MgRGlhbG9nQ2FycmllciB7XG4gICAgICAgIFxuICAgICAgICBkaWFsb2dCZWxvbmdpbmc6IERpYWxvZ0JlbG9uZ2luZyA9IG5ldyBEaWFsb2dCZWxvbmdpbmcoKTtcbiAgICAgICAgcHJpdmF0ZSBjb21wb25lbnQ6IFR5cGU8YW55PjtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBzZXRDb21wb25lbnQoX0NvbXBvbmVudDogVHlwZTxhbnk+KTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLmNvbXBvbmVudCA9IF9Db21wb25lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldEJ1dHRvbnMoX0J1dHRvbnM6IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10pIHtcbiAgICAgICAgICAgIGlmIChfQnV0dG9ucy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpYWxvZ0JlbG9uZ2luZy5CdXR0b25zID0gX0J1dHRvbnM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldEN1c3RvbURhdGEoX0N1c3RvbURhdGE6IGFueSkge1xuICAgICAgICAgICAgdGhpcy5kaWFsb2dCZWxvbmdpbmcuQ3VzdG9tRGF0YSA9IF9DdXN0b21EYXRhO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBzZXRDb25maWcoX0RpYWxvZ0NvbmZpZzogRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dDb3JlQ29uZmlnKSB7XG4gICAgICAgICAgICAvLyByZWdpb24gKioqIGxvY2FsIFVzZXJDb25maWcgKGRlZmluZWQgb24gcGxhY2Ugd2hlcmUgZGlhbG9nIGlzIGNhbGxlZCkgKioqXG4gICAgICAgICAgICBjb25zdCBkYXRhQ29udHJvbCA9IG5ldyBHbG9iYWxDbGFzcy5EYXRhQ29udHJvbCgpO1xuICAgICAgICAgICAgZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20oX0RpYWxvZ0NvbmZpZywgdGhpcy5kaWFsb2dCZWxvbmdpbmcuRGlhbG9nQ29yZUNvbmZpZyk7XG4gICAgICAgICAgICAvLyBlbmRyZWdpb25cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgb3BlbkRpYWxvZyQoKTogT2JzZXJ2YWJsZTxEaWFsb2dJbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZD4ge1xuICAgICAgICAgICAgY29uc3Qgc2VydmljZTogRGlhbG9nU2VydmljZSA9IFNlcnZpY2VMb2NhdG9yLmluamVjdG9yLmdldChEaWFsb2dTZXJ2aWNlKTtcbiAgICAgICAgICAgIGNvbnN0IGRpYWxvZ0NvbnRyb2xsZXIgICAgICAgPSBzZXJ2aWNlLm9wZW4odGhpcy5jb21wb25lbnQsIHRoaXMuZGlhbG9nQmVsb25naW5nKTtcbiAgICAgICAgICAgIHJldHVybiBkaWFsb2dDb250cm9sbGVyLmFmdGVyQ2xvc2VkJDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGNsYXNzIERpYWxvZ0NvcmVDb25maWcgaW1wbGVtZW50cyBEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ0NvcmVDb25maWcge1xuICAgICAgICBXaWR0aDogc3RyaW5nICAgICAgICAgICAgICAgICAgICA9IG51bGw7XG4gICAgICAgIEhlaWdodDogc3RyaW5nICAgICAgICAgICAgICAgICAgID0gbnVsbDtcbiAgICAgICAgQnV0dG9uUG9zaXRpb246IFZlcnRpY2FsUG9zaXRpb24gPSBudWxsO1xuICAgICAgICBMYXlvdXRUeXBlOiBEaWFsb2dMYXlvdXREaXNwbGF5ICA9IG51bGw7XG4gICAgICAgIERpc3BsYXlMb2FkZXI6IGJvb2xlYW4gICAgICAgICAgID0gbnVsbDtcbiAgICAgICAgTG9hZGVyQ29tcG9uZW50OiBUeXBlPGFueT4gICAgICAgPSBudWxsO1xuICAgIH1cbiAgICBcbiAgICBleHBvcnQgY2xhc3MgRGlhbG9nU2V0dGluZ3Mge1xuICAgICAgICBCdXR0b25zOiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdICAgICAgICAgICAgICAgICAgPSBbXTtcbiAgICAgICAgRGlhbG9nQ29yZUNvbmZpZzogRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dDb3JlQ29uZmlnID0gbmV3IERpYWxvZ0NvcmVDb25maWcoKTtcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGNsYXNzIERpYWxvZ0JlbG9uZ2luZzxDdXN0b21EYXRhID0gYW55PiBleHRlbmRzIERpYWxvZ1NldHRpbmdzIGltcGxlbWVudHMgRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dCZWxvbmdpbmcge1xuICAgICAgICBcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICBFbnRpdHlVbmlxdWVJRDogc3RyaW5nID0gJ0QnICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpO1xuICAgICAgICBcbiAgICAgICAgQ3VzdG9tRGF0YTogQ3VzdG9tRGF0YSA9IG51bGw7XG4gICAgICAgIEV2ZW50c0NvbnRyb2xsZXI6IERpYWxvZ0ludGVyZmFjZS5JRGlhbG9nRXZlbnRzQ29udHJvbGxlcjtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgICAgIHRoaXMuRXZlbnRzQ29udHJvbGxlciAgICAgICAgICAgICAgICAgICAgICAgICA9IG5ldyBEaWFsb2dFdmVudHNDb250cm9sbGVyKHRoaXMuRW50aXR5VW5pcXVlSUQpO1xuICAgICAgICAgICAgY29uc3QgZGlhbG9nQ29uZmlndXJhdG9yOiBEaWFsb2dDb25maWdTZXJ2aWNlID0gU2VydmljZUxvY2F0b3IuaW5qZWN0b3IuZ2V0KERpYWxvZ0NvbmZpZ1NlcnZpY2UpO1xuICAgICAgICAgICAgY29uc3QgYmFzZVNldHRpbmdzICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gbmV3IERpYWxvZ1NldHRpbmdzKCk7XG4gICAgICAgICAgICBjb25zdCBkYXRhQ29udHJvbCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPSBuZXcgR2xvYmFsQ2xhc3MuRGF0YUNvbnRyb2woKTtcbiAgICAgICAgICAgIGRhdGFDb250cm9sLmNvcHlWYWx1ZXNGcm9tKGRpYWxvZ0NvbmZpZ3VyYXRvci5wcm9kdWN0aW9uQ29uZmlnLkRpYWxvZ0NvcmVDb25maWcsIGJhc2VTZXR0aW5ncy5EaWFsb2dDb3JlQ29uZmlnKTtcbiAgICAgICAgICAgIHRoaXMuRGlhbG9nQ29yZUNvbmZpZyA9IGJhc2VTZXR0aW5ncy5EaWFsb2dDb3JlQ29uZmlnO1xuICAgICAgICAgICAgdGhpcy5CdXR0b25zICAgICAgICAgID0gZGlhbG9nQ29uZmlndXJhdG9yLnByb2R1Y3Rpb25Db25maWcuQnV0dG9ucy5zbGljZSgpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgIH1cbn1cblxuXG5cbiJdfQ==