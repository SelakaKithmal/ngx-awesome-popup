import { Subject } from 'rxjs';
import { ServiceLocator } from '../../../locator.service';
import { DialogConfigService } from './dialog-config.service';
import { map } from 'rxjs/operators';
import { GlobalClass } from '../../../core/global';
import { DialogService } from './dialog.service';
export var DialogClass;
(function (DialogClass) {
    // region *** Public ***
    class DialogInitializer {
        constructor(component) {
            this.component = component;
            this.dialogCarrier = new DialogClass.DialogCarrier();
            this.dialogCarrier.setComponent(this.component);
        }
        /** Generic method accept expected payload from dynamic child component.*/
        openDialog$() {
            return this.dialogCarrier.openDialog$().pipe(map(resp => {
                const basicDialogResponse = new DialogResponse();
                const dataControl = new GlobalClass.DataControl();
                dataControl.copyValuesFrom(resp, basicDialogResponse);
                return basicDialogResponse;
            }));
        }
        /** It accepts list of custom buttons */
        setButtons(_Buttons) {
            this.dialogCarrier.setButtons(_Buttons);
        }
        setCustomData(_CustomData) {
            this.dialogCarrier.setCustomData(_CustomData);
        }
        setConfig(_DialogConfig) {
            this.dialogCarrier.setConfig(_DialogConfig);
        }
    }
    DialogClass.DialogInitializer = DialogInitializer;
    class DialogResponse extends GlobalClass.DataControl {
        constructor() {
            super();
            // private Response: DialogPrepareResponse            = new DialogPrepareResponse();
            this.Payload = null;
            this.Success = null;
            this.ClickedButtonID = null;
        }
        /**
         * @ignore
         */
        setPayload(_Payload) {
            this.Payload = _Payload;
        }
        /**
         * @ignore
         */
        setClickedButtonID(_ClickedButtonID) {
            this.ClickedButtonID = _ClickedButtonID;
        }
    }
    DialogClass.DialogResponse = DialogResponse;
    class DialogEventsController {
        constructor(EntityUniqueID) {
            this.EntityUniqueID = EntityUniqueID;
            this._afterClosed = new Subject();
            this.afterClosed$ = this._afterClosed.asObservable();
            this._afterLoader = new Subject();
            this.afterLoader$ = this._afterLoader.asObservable();
            this._onButtonClick = new Subject();
            this.onButtonClick$ = this._onButtonClick.asObservable();
            this._buttonList = new Subject();
            this.buttonList$ = this._buttonList.asObservable();
        }
        close(_Payload = null) {
            this.defaultResponse.setPayload(_Payload);
            this._afterClosed.next(this.defaultResponse);
        }
        onButtonClick(_Button) {
            this.defaultResponse.setClickedButtonID(_Button.ID);
            this._onButtonClick.next(_Button);
        }
        setButtonList(_ButtonList) {
            this._buttonList.next(_ButtonList);
        }
        closeLoader() {
            setTimeout(() => {
                this._afterLoader.next(this.EntityUniqueID);
            }, 0);
        }
        setDefaultResponse(_Response) {
            this.defaultResponse = _Response;
        }
    }
    DialogClass.DialogEventsController = DialogEventsController;
    // endregion
    class DialogDefaultResponse extends DialogResponse {
        constructor() {
            super();
            this.DialogBelonging = null;
        }
        setBelonging(_DialogBelonging) {
            this.DialogBelonging = _DialogBelonging;
        }
    }
    DialogClass.DialogDefaultResponse = DialogDefaultResponse;
    class DialogCarrier {
        constructor() {
            this.dialogBelonging = new DialogBelonging();
        }
        setComponent(_Component) {
            this.component = _Component;
        }
        setButtons(_Buttons) {
            if (_Buttons.length) {
                this.dialogBelonging.Buttons = _Buttons;
            }
        }
        setCustomData(_CustomData) {
            this.dialogBelonging.CustomData = _CustomData;
        }
        setConfig(_DialogConfig) {
            // region *** local UserConfig (defined on place where dialog is called) ***
            const dataControl = new GlobalClass.DataControl();
            dataControl.copyValuesFrom(_DialogConfig, this.dialogBelonging.DialogCoreConfig);
            if (_DialogConfig === null || _DialogConfig === void 0 ? void 0 : _DialogConfig.LoaderComponent) {
                this.dialogBelonging.DialogCoreConfig.DisplayLoader = true;
            }
            // endregion
        }
        openDialog$() {
            const service = ServiceLocator.injector.get(DialogService);
            const dialogController = service.open(this.component, this.dialogBelonging);
            return dialogController.afterClosed$;
        }
    }
    DialogClass.DialogCarrier = DialogCarrier;
    class DialogCoreConfig {
        constructor() {
            this.Width = null;
            this.Height = null;
            this.ButtonPosition = null;
            this.LayoutType = null;
            this.DisplayLoader = null;
            this.LoaderComponent = null;
        }
    }
    DialogClass.DialogCoreConfig = DialogCoreConfig;
    class DialogSettings {
        constructor() {
            this.Buttons = [];
            this.DialogCoreConfig = new DialogCoreConfig();
        }
    }
    DialogClass.DialogSettings = DialogSettings;
    class DialogBelonging extends DialogSettings {
        constructor() {
            super();
            /** @internal */
            this.EntityUniqueID = 'D' + Math.random().toString(36).substr(2, 9);
            this.CustomData = null;
            this.EventsController = new DialogEventsController(this.EntityUniqueID);
            const dialogConfigurator = ServiceLocator.injector.get(DialogConfigService);
            const baseSettings = new DialogSettings();
            const dataControl = new GlobalClass.DataControl();
            dataControl.copyValuesFrom(dialogConfigurator.productionConfig.DialogCoreConfig, baseSettings.DialogCoreConfig);
            this.DialogCoreConfig = baseSettings.DialogCoreConfig;
            this.Buttons = dialogConfigurator.productionConfig.Buttons.slice();
        }
    }
    DialogClass.DialogBelonging = DialogBelonging;
})(DialogClass || (DialogClass = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9uZ3gtYXdlc29tZS1wb3B1cC90eXBlcy9kaWFsb2cvY29yZS9tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWEsT0FBTyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBRXpDLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUN4RCxPQUFPLEVBQUMsbUJBQW1CLEVBQUMsTUFBTSx5QkFBeUIsQ0FBQztBQUU1RCxPQUFPLEVBQUMsR0FBRyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDbkMsT0FBTyxFQUFDLFdBQVcsRUFBa0IsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRSxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sa0JBQWtCLENBQUM7QUFpRy9DLE1BQU0sS0FBVyxXQUFXLENBb00zQjtBQXBNRCxXQUFpQixXQUFXO0lBRXhCLHdCQUF3QjtJQUV4QixNQUFhLGlCQUFpQjtRQUkxQixZQUFvQixTQUFvQjtZQUFwQixjQUFTLEdBQVQsU0FBUyxDQUFXO1lBRmhDLGtCQUFhLEdBQWtCLElBQUksV0FBVyxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBR25FLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNwRCxDQUFDO1FBRUQsMEVBQTBFO1FBQzFFLFdBQVc7WUFDUCxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRTtnQkFDcEQsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO2dCQUNqRCxNQUFNLFdBQVcsR0FBVyxJQUFJLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDMUQsV0FBVyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztn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VyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzlFLFdBQVcsQ0FBQyxjQUFjLENBQUMsa0JBQWtCLENBQUMsZ0JBQWdCLENBQUMsZ0JBQWdCLEVBQUUsWUFBWSxDQUFDLGdCQUFnQixDQUFDLENBQUM7WUFDaEgsSUFBSSxDQUFDLGdCQUFnQixHQUFHLFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQztZQUN0RCxJQUFJLENBQUMsT0FBTyxHQUFZLGtCQUFrQixDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNoRixDQUFDO0tBRUo7SUFuQlksMkJBQWUsa0JBbUIzQixDQUFBO0FBQ0wsQ0FBQyxFQXBNZ0IsV0FBVyxLQUFYLFdBQVcsUUFvTTNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtPYnNlcnZhYmxlLCBTdWJqZWN0fSBmcm9tICdyeGpzJztcbmltcG9ydCB7VHlwZX0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1NlcnZpY2VMb2NhdG9yfSBmcm9tICcuLi8uLi8uLi9sb2NhdG9yLnNlcnZpY2UnO1xuaW1wb3J0IHtEaWFsb2dDb25maWdTZXJ2aWNlfSBmcm9tICcuL2RpYWxvZy1jb25maWcuc2VydmljZSc7XG5pbXBvcnQge0RpYWxvZ0xheW91dERpc3BsYXksIFZlcnRpY2FsUG9zaXRpb259IGZyb20gJy4uLy4uLy4uL2NvcmUvZW51bXMnO1xuaW1wb3J0IHttYXB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7R2xvYmFsQ2xhc3MsIEdsb2JhbEludGVyZmFjZX0gZnJvbSAnLi4vLi4vLi4vY29yZS9nbG9iYWwnO1xuaW1wb3J0IHtEaWFsb2dTZXJ2aWNlfSBmcm9tICcuL2RpYWxvZy5zZXJ2aWNlJztcblxuZXhwb3J0IG5hbWVzcGFjZSBEaWFsb2dJbnRlcmZhY2Uge1xuICAgIFxuICAgIC8qKlxuICAgICAqIENoZWNrIGludGVyZmFjZSBvZiBwcm9wZXJ0aWVzLlxuICAgICAqL1xuICAgIGV4cG9ydCBpbnRlcmZhY2UgSURpYWxvZ1VzZXJDb25maWcge1xuICAgICAgICBCdXR0b25zPzogR2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXTtcbiAgICAgICAgRGlhbG9nQ29yZUNvbmZpZz86IERpYWxvZ0ludGVyZmFjZS5JRGlhbG9nQ29yZUNvbmZpZztcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogT3B0aW9uYWwgdXNlciBjb25maWd1cmF0aW9uLlxuICAgICAqXG4gICAgICogRXhhbXBsZTpcbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogLy8gRGlhbG9nIGNvcmUgY29uZmlnIG9iamVjdCBleGFtcGxlLlxuICAgICAqIGNvbnN0IGRpYWxvZ0NvcmVDb25maWcgPSB7XG4gICAgICogICAgIERpYWxvZ0NvcmVDb25maWc6IHtcbiAgICAgKiAgICAgICAgV2lkdGggICAgICAgICA6ICc1MDBweCcsXG4gICAgICogICAgICAgIEhlaWdodCAgICAgICAgOiAnNTAwcHgnLFxuICAgICAqICAgICAgICBCdXR0b25Qb3NpdGlvbjogJ3JpZ2h0JyxcbiAgICAgKiAgICAgICAgTGF5b3V0VHlwZTogRGlhbG9nTGF5b3V0RGlzcGxheS5JTkZPLFxuICAgICAqICAgICAgICBMb2FkZXJDb21wb25lbnQ6IC8vIEFueSBBbmd1bGFyIGNvbXBvbmVudCBjbGFzcyBuYW1lIGNhbiBiZSBpbmNsdWRlZCBhcyBhIGxvYWRlci5cbiAgICAgKiAgICAgICAgRGlzcGxheUxvYWRlcjogZmFsc2UgLy8gVGhpcyB3aWxsIG92ZXJyaWRlIExvYWRlckNvbXBvbmVudC5cbiAgICAgKiAgICAgfVxuICAgICAqICB9XG4gICAgICogYGBgXG4gICAgICovXG4gICAgZXhwb3J0IGludGVyZmFjZSBJRGlhbG9nQ29yZUNvbmZpZyB7XG4gICAgICAgIC8qKiBGaXhlZCBwb3B1cCB3aWR0aCAqL1xuICAgICAgICBXaWR0aD86IHN0cmluZztcbiAgICAgICAgLyoqIEZpeGVkIHBvcHVwIGhlaWdodCAqL1xuICAgICAgICBIZWlnaHQ/OiBzdHJpbmc7XG4gICAgICAgIEJ1dHRvblBvc2l0aW9uPzogVmVydGljYWxQb3NpdGlvbjtcbiAgICAgICAgTGF5b3V0VHlwZT86IERpYWxvZ0xheW91dERpc3BsYXk7XG4gICAgICAgIERpc3BsYXlMb2FkZXI/OiBib29sZWFuO1xuICAgICAgICBMb2FkZXJDb21wb25lbnQ/OiBUeXBlPGFueT47XG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSURpYWxvZ0JlbG9uZ2luZyB7XG4gICAgICAgIEJ1dHRvbnM6IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW107XG4gICAgICAgIERpYWxvZ0NvcmVDb25maWc6IERpYWxvZ0ludGVyZmFjZS5JRGlhbG9nQ29yZUNvbmZpZztcbiAgICAgICAgRW50aXR5VW5pcXVlSUQ6IHN0cmluZztcbiAgICAgICAgQ3VzdG9tRGF0YTogYW55O1xuICAgICAgICBFdmVudHNDb250cm9sbGVyOiBEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ0V2ZW50c0NvbnRyb2xsZXI7XG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSURpYWxvZ0V2ZW50c0NvbnRyb2xsZXIge1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIGRlZmF1bHRSZXNwb25zZTogRGlhbG9nSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQ7XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgYWZ0ZXJDbG9zZWQkOiBPYnNlcnZhYmxlPERpYWxvZ0ludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPjtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICBhZnRlckxvYWRlciQ6IE9ic2VydmFibGU8c3RyaW5nPjtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICBvbkJ1dHRvbkNsaWNrJDogT2JzZXJ2YWJsZTxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbj47XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgYnV0dG9uTGlzdCQ6IE9ic2VydmFibGU8R2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXT47XG4gICAgXG4gICAgICAgIGNsb3NlKF9QYXlsb2FkPzogYW55KTogdm9pZDtcbiAgICBcbiAgICAgICAgb25CdXR0b25DbGljayhfQnV0dG9uOiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbik6IHZvaWQ7XG4gICAgXG4gICAgICAgIHNldEJ1dHRvbkxpc3QoX0J1dHRvbkxpc3Q6IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10pOiB2b2lkO1xuICAgIFxuICAgICAgICBjbG9zZUxvYWRlcigpOiB2b2lkO1xuICAgIFxuICAgICAgICBzZXREZWZhdWx0UmVzcG9uc2UoX1Jlc3BvbnNlOiBEaWFsb2dJbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZCk6IHZvaWQ7XG4gICAgXG4gICAgICAgIHNldERlZmF1bHRSZXNwb25zZShfUmVzcG9uc2U6IERpYWxvZ0ludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkKTogdm9pZDtcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGludGVyZmFjZSBJRGlhbG9nUmVzcG9uc2Uge1xuICAgICAgICBcbiAgICAgICAgc2V0UGF5bG9hZChfUGF5bG9hZDogYW55KTogdm9pZDtcbiAgICAgICAgXG4gICAgICAgIHNldENsaWNrZWRCdXR0b25JRChfQ2xpY2tlZEJ1dHRvbklEKTogdm9pZDtcbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSURpYWxvZ1B1YmxpY1Jlc3BvbnNlPFJlc3BvbnNlUGF5bG9hZD4ge1xuICAgICAgICAvKiogR2VuZXJpYyBwcm9wZXJ0eSB0eXBlLCBhY2NlcHQgZXhwZWN0ZWQgcGF5bG9hZCBmcm9tIGR5bmFtaWMgY2hpbGQgY29tcG9uZW50LiAqL1xuICAgICAgICBQYXlsb2FkOiBSZXNwb25zZVBheWxvYWQ7XG4gICAgICAgIFN1Y2Nlc3M6IGJvb2xlYW47XG4gICAgICAgIENsaWNrZWRCdXR0b25JRDogc3RyaW5nXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSVByaXZhdGVSZXNwb25zZU1lcmdlZCBleHRlbmRzIElEaWFsb2dSZXNwb25zZSwgR2xvYmFsSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2Uge1xuICAgICAgICBcbiAgICAgICAgRGlhbG9nQmVsb25naW5nOiBEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ0JlbG9uZ2luZztcbiAgICB9XG4gICAgXG4gICAgXG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgRGlhbG9nQ2xhc3Mge1xuICAgIFxuICAgIC8vIHJlZ2lvbiAqKiogUHVibGljICoqKlxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBEaWFsb2dJbml0aWFsaXplciB7XG4gICAgICAgIFxuICAgICAgICBwcml2YXRlIGRpYWxvZ0NhcnJpZXI6IERpYWxvZ0NhcnJpZXIgPSBuZXcgRGlhbG9nQ2xhc3MuRGlhbG9nQ2FycmllcigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3RydWN0b3IocHJpdmF0ZSBjb21wb25lbnQ6IFR5cGU8YW55Pikge1xuICAgICAgICAgICAgdGhpcy5kaWFsb2dDYXJyaWVyLnNldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8qKiBHZW5lcmljIG1ldGhvZCBhY2NlcHQgZXhwZWN0ZWQgcGF5bG9hZCBmcm9tIGR5bmFtaWMgY2hpbGQgY29tcG9uZW50LiovXG4gICAgICAgIG9wZW5EaWFsb2ckPFJlc3BvbnNlUGF5bG9hZCA9IGFueT4oKTogT2JzZXJ2YWJsZTxEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ1B1YmxpY1Jlc3BvbnNlPFJlc3BvbnNlUGF5bG9hZD4+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRpYWxvZ0NhcnJpZXIub3BlbkRpYWxvZyQoKS5waXBlKG1hcChyZXNwID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBiYXNpY0RpYWxvZ1Jlc3BvbnNlID0gbmV3IERpYWxvZ1Jlc3BvbnNlKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YUNvbnRyb2wgICAgICAgICA9IG5ldyBHbG9iYWxDbGFzcy5EYXRhQ29udHJvbCgpO1xuICAgICAgICAgICAgICAgIGRhdGFDb250cm9sLmNvcHlWYWx1ZXNGcm9tKHJlc3AsIGJhc2ljRGlhbG9nUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybiBiYXNpY0RpYWxvZ1Jlc3BvbnNlO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvKiogSXQgYWNjZXB0cyBsaXN0IG9mIGN1c3RvbSBidXR0b25zICovXG4gICAgICAgIHNldEJ1dHRvbnMoX0J1dHRvbnM6IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10pOiB2b2lkIHtcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nQ2Fycmllci5zZXRCdXR0b25zKF9CdXR0b25zKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgc2V0Q3VzdG9tRGF0YShfQ3VzdG9tRGF0YTogYW55KSB7XG4gICAgICAgICAgICB0aGlzLmRpYWxvZ0NhcnJpZXIuc2V0Q3VzdG9tRGF0YShfQ3VzdG9tRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldENvbmZpZyhfRGlhbG9nQ29uZmlnOiBEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ0NvcmVDb25maWcpIHtcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nQ2Fycmllci5zZXRDb25maWcoX0RpYWxvZ0NvbmZpZyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBEaWFsb2dSZXNwb25zZSBleHRlbmRzIEdsb2JhbENsYXNzLkRhdGFDb250cm9sIGltcGxlbWVudHMgRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dSZXNwb25zZSwgRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dQdWJsaWNSZXNwb25zZTxhbnk+IHtcbiAgICAgICAgLy8gcHJpdmF0ZSBSZXNwb25zZTogRGlhbG9nUHJlcGFyZVJlc3BvbnNlICAgICAgICAgICAgPSBuZXcgRGlhbG9nUHJlcGFyZVJlc3BvbnNlKCk7XG4gICAgICAgIFxuICAgICAgICBQYXlsb2FkOiBhbnkgICAgICAgICAgICA9IG51bGw7XG4gICAgICAgIFN1Y2Nlc3M6IGJvb2xlYW4gICAgICAgID0gbnVsbDtcbiAgICAgICAgQ2xpY2tlZEJ1dHRvbklEOiBzdHJpbmcgPSBudWxsO1xuICAgICAgICBcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgICAgICBzdXBlcigpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvKipcbiAgICAgICAgICogQGlnbm9yZVxuICAgICAgICAgKi9cbiAgICAgICAgc2V0UGF5bG9hZChfUGF5bG9hZDogYW55KTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLlBheWxvYWQgPSBfUGF5bG9hZDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBpZ25vcmVcbiAgICAgICAgICovXG4gICAgICAgIHNldENsaWNrZWRCdXR0b25JRChfQ2xpY2tlZEJ1dHRvbklEKTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLkNsaWNrZWRCdXR0b25JRCA9IF9DbGlja2VkQnV0dG9uSUQ7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBEaWFsb2dFdmVudHNDb250cm9sbGVyIGltcGxlbWVudHMgRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dFdmVudHNDb250cm9sbGVyIHtcbiAgICAgICAgXG4gICAgICAgIGRlZmF1bHRSZXNwb25zZTogRGlhbG9nSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQ7XG4gICAgICAgIFxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IF9hZnRlckNsb3NlZDogU3ViamVjdDxEaWFsb2dJbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZD4gPSBuZXcgU3ViamVjdDxEaWFsb2dJbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZD4oKTtcbiAgICAgICAgYWZ0ZXJDbG9zZWQkOiBPYnNlcnZhYmxlPERpYWxvZ0ludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPiAgICAgICAgICAgICAgID0gdGhpcy5fYWZ0ZXJDbG9zZWQuYXNPYnNlcnZhYmxlKCk7XG4gICAgXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgX2FmdGVyTG9hZGVyOiBhbnkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gbmV3IFN1YmplY3Q8c3RyaW5nPigpO1xuICAgICAgICBhZnRlckxvYWRlciQ6IE9ic2VydmFibGU8c3RyaW5nPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IHRoaXMuX2FmdGVyTG9hZGVyLmFzT2JzZXJ2YWJsZSgpO1xuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IF9vbkJ1dHRvbkNsaWNrOiBTdWJqZWN0PEdsb2JhbEludGVyZmFjZS5JQnV0dG9uPiA9IG5ldyBTdWJqZWN0PEdsb2JhbEludGVyZmFjZS5JQnV0dG9uPigpO1xuICAgICAgICBvbkJ1dHRvbkNsaWNrJDogT2JzZXJ2YWJsZTxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbj4gICAgICAgICAgICAgICA9IHRoaXMuX29uQnV0dG9uQ2xpY2suYXNPYnNlcnZhYmxlKCk7XG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgX2J1dHRvbkxpc3Q6IFN1YmplY3Q8R2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXT4gID0gbmV3IFN1YmplY3Q8R2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXT4oKTtcbiAgICAgICAgYnV0dG9uTGlzdCQ6IE9ic2VydmFibGU8R2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXT4gICAgICAgICAgICAgICAgPSB0aGlzLl9idXR0b25MaXN0LmFzT2JzZXJ2YWJsZSgpO1xuICAgIFxuICAgICAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIEVudGl0eVVuaXF1ZUlEOiBzdHJpbmcpIHtcbiAgICAgICAgfVxuICAgIFxuICAgICAgICBjbG9zZShfUGF5bG9hZDogYW55ID0gbnVsbCk6IHZvaWQge1xuICAgICAgICAgICAgdGhpcy5kZWZhdWx0UmVzcG9uc2Uuc2V0UGF5bG9hZChfUGF5bG9hZCk7XG4gICAgICAgICAgICB0aGlzLl9hZnRlckNsb3NlZC5uZXh0KHRoaXMuZGVmYXVsdFJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgIFxuICAgICAgICBvbkJ1dHRvbkNsaWNrKF9CdXR0b246IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uKTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRSZXNwb25zZS5zZXRDbGlja2VkQnV0dG9uSUQoX0J1dHRvbi5JRCk7XG4gICAgICAgICAgICB0aGlzLl9vbkJ1dHRvbkNsaWNrLm5leHQoX0J1dHRvbik7XG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgc2V0QnV0dG9uTGlzdChfQnV0dG9uTGlzdDogR2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXSk6IHZvaWQge1xuICAgICAgICAgICAgdGhpcy5fYnV0dG9uTGlzdC5uZXh0KF9CdXR0b25MaXN0KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY2xvc2VMb2FkZXIoKTogdm9pZCB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLl9hZnRlckxvYWRlci5uZXh0KHRoaXMuRW50aXR5VW5pcXVlSUQpO1xuICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICBcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgc2V0RGVmYXVsdFJlc3BvbnNlKF9SZXNwb25zZTogRGlhbG9nSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQpOiB2b2lkIHtcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdFJlc3BvbnNlID0gX1Jlc3BvbnNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIGVuZHJlZ2lvblxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBEaWFsb2dEZWZhdWx0UmVzcG9uc2UgZXh0ZW5kcyBEaWFsb2dSZXNwb25zZSBpbXBsZW1lbnRzIERpYWxvZ0ludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkIHtcbiAgICAgICAgRGlhbG9nQmVsb25naW5nOiBEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ0JlbG9uZ2luZyA9IG51bGw7XG4gICAgICAgIFxuICAgICAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgICAgIHN1cGVyKCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldEJlbG9uZ2luZyhfRGlhbG9nQmVsb25naW5nKTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLkRpYWxvZ0JlbG9uZ2luZyA9IF9EaWFsb2dCZWxvbmdpbmc7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBEaWFsb2dDYXJyaWVyIHtcbiAgICAgICAgXG4gICAgICAgIGRpYWxvZ0JlbG9uZ2luZzogRGlhbG9nQmVsb25naW5nID0gbmV3IERpYWxvZ0JlbG9uZ2luZygpO1xuICAgICAgICBwcml2YXRlIGNvbXBvbmVudDogVHlwZTxhbnk+O1xuICAgICAgICBcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldENvbXBvbmVudChfQ29tcG9uZW50OiBUeXBlPGFueT4pOiB2b2lkIHtcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50ID0gX0NvbXBvbmVudDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgc2V0QnV0dG9ucyhfQnV0dG9uczogR2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXSkge1xuICAgICAgICAgICAgaWYgKF9CdXR0b25zLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlhbG9nQmVsb25naW5nLkJ1dHRvbnMgPSBfQnV0dG9ucztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgc2V0Q3VzdG9tRGF0YShfQ3VzdG9tRGF0YTogYW55KSB7XG4gICAgICAgICAgICB0aGlzLmRpYWxvZ0JlbG9uZ2luZy5DdXN0b21EYXRhID0gX0N1c3RvbURhdGE7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldENvbmZpZyhfRGlhbG9nQ29uZmlnOiBEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ0NvcmVDb25maWcpIHtcbiAgICAgICAgICAgIC8vIHJlZ2lvbiAqKiogbG9jYWwgVXNlckNvbmZpZyAoZGVmaW5lZCBvbiBwbGFjZSB3aGVyZSBkaWFsb2cgaXMgY2FsbGVkKSAqKipcbiAgICAgICAgICAgIGNvbnN0IGRhdGFDb250cm9sID0gbmV3IEdsb2JhbENsYXNzLkRhdGFDb250cm9sKCk7XG4gICAgICAgICAgICBkYXRhQ29udHJvbC5jb3B5VmFsdWVzRnJvbShfRGlhbG9nQ29uZmlnLCB0aGlzLmRpYWxvZ0JlbG9uZ2luZy5EaWFsb2dDb3JlQ29uZmlnKTtcbiAgICAgICAgICAgIGlmIChfRGlhbG9nQ29uZmlnPy5Mb2FkZXJDb21wb25lbnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpYWxvZ0JlbG9uZ2luZy5EaWFsb2dDb3JlQ29uZmlnLkRpc3BsYXlMb2FkZXIgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZW5kcmVnaW9uXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIG9wZW5EaWFsb2ckKCk6IE9ic2VydmFibGU8RGlhbG9nSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQ+IHtcbiAgICAgICAgICAgIGNvbnN0IHNlcnZpY2U6IERpYWxvZ1NlcnZpY2UgPSBTZXJ2aWNlTG9jYXRvci5pbmplY3Rvci5nZXQoRGlhbG9nU2VydmljZSk7XG4gICAgICAgICAgICBjb25zdCBkaWFsb2dDb250cm9sbGVyICAgICAgID0gc2VydmljZS5vcGVuKHRoaXMuY29tcG9uZW50LCB0aGlzLmRpYWxvZ0JlbG9uZ2luZyk7XG4gICAgICAgICAgICByZXR1cm4gZGlhbG9nQ29udHJvbGxlci5hZnRlckNsb3NlZCQ7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBEaWFsb2dDb3JlQ29uZmlnIGltcGxlbWVudHMgRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dDb3JlQ29uZmlnIHtcbiAgICAgICAgV2lkdGg6IHN0cmluZyAgICAgICAgICAgICAgICAgICAgPSBudWxsO1xuICAgICAgICBIZWlnaHQ6IHN0cmluZyAgICAgICAgICAgICAgICAgICA9IG51bGw7XG4gICAgICAgIEJ1dHRvblBvc2l0aW9uOiBWZXJ0aWNhbFBvc2l0aW9uID0gbnVsbDtcbiAgICAgICAgTGF5b3V0VHlwZTogRGlhbG9nTGF5b3V0RGlzcGxheSAgPSBudWxsO1xuICAgICAgICBEaXNwbGF5TG9hZGVyOiBib29sZWFuICAgICAgICAgICA9IG51bGw7XG4gICAgICAgIExvYWRlckNvbXBvbmVudDogVHlwZTxhbnk+ICAgICAgID0gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGNsYXNzIERpYWxvZ1NldHRpbmdzIHtcbiAgICAgICAgQnV0dG9uczogR2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXSAgICAgICAgICAgICAgICAgID0gW107XG4gICAgICAgIERpYWxvZ0NvcmVDb25maWc6IERpYWxvZ0ludGVyZmFjZS5JRGlhbG9nQ29yZUNvbmZpZyA9IG5ldyBEaWFsb2dDb3JlQ29uZmlnKCk7XG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBEaWFsb2dCZWxvbmdpbmc8Q3VzdG9tRGF0YSA9IGFueT4gZXh0ZW5kcyBEaWFsb2dTZXR0aW5ncyBpbXBsZW1lbnRzIERpYWxvZ0ludGVyZmFjZS5JRGlhbG9nQmVsb25naW5nIHtcbiAgICAgICAgXG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgRW50aXR5VW5pcXVlSUQ6IHN0cmluZyA9ICdEJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KTtcbiAgICAgICAgXG4gICAgICAgIEN1c3RvbURhdGE6IEN1c3RvbURhdGEgPSBudWxsO1xuICAgICAgICBFdmVudHNDb250cm9sbGVyOiBEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ0V2ZW50c0NvbnRyb2xsZXI7XG4gICAgICAgIFxuICAgICAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgICAgIHN1cGVyKCk7XG4gICAgICAgICAgICB0aGlzLkV2ZW50c0NvbnRyb2xsZXIgICAgICAgICAgICAgICAgICAgICAgICAgPSBuZXcgRGlhbG9nRXZlbnRzQ29udHJvbGxlcih0aGlzLkVudGl0eVVuaXF1ZUlEKTtcbiAgICAgICAgICAgIGNvbnN0IGRpYWxvZ0NvbmZpZ3VyYXRvcjogRGlhbG9nQ29uZmlnU2VydmljZSA9IFNlcnZpY2VMb2NhdG9yLmluamVjdG9yLmdldChEaWFsb2dDb25maWdTZXJ2aWNlKTtcbiAgICAgICAgICAgIGNvbnN0IGJhc2VTZXR0aW5ncyAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IG5ldyBEaWFsb2dTZXR0aW5ncygpO1xuICAgICAgICAgICAgY29uc3QgZGF0YUNvbnRyb2wgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gbmV3IEdsb2JhbENsYXNzLkRhdGFDb250cm9sKCk7XG4gICAgICAgICAgICBkYXRhQ29udHJvbC5jb3B5VmFsdWVzRnJvbShkaWFsb2dDb25maWd1cmF0b3IucHJvZHVjdGlvbkNvbmZpZy5EaWFsb2dDb3JlQ29uZmlnLCBiYXNlU2V0dGluZ3MuRGlhbG9nQ29yZUNvbmZpZyk7XG4gICAgICAgICAgICB0aGlzLkRpYWxvZ0NvcmVDb25maWcgPSBiYXNlU2V0dGluZ3MuRGlhbG9nQ29yZUNvbmZpZztcbiAgICAgICAgICAgIHRoaXMuQnV0dG9ucyAgICAgICAgICA9IGRpYWxvZ0NvbmZpZ3VyYXRvci5wcm9kdWN0aW9uQ29uZmlnLkJ1dHRvbnMuc2xpY2UoKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9XG59XG5cblxuXG4iXX0=