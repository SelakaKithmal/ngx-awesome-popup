import { Subject } from 'rxjs';
import { ServiceLocator } from '../../../locator.service';
import { DialogConfigService } from './dialog-config.service';
import { map } from 'rxjs/operators';
import { GlobalClass } from '../../../core/global';
import { DialogService } from './dialog.service';
export var DialogClass;
(function (DialogClass) {
    // region *** Public ***
    class DialogInitializer {
        constructor(component) {
            this.component = component;
            this.dialogCarrier = new DialogClass.DialogCarrier();
            this.dialogCarrier.setComponent(this.component);
        }
        /** Generic method accept expected payload from dynamic child component.*/
        openDialog$() {
            return this.dialogCarrier.openDialog$().pipe(map(resp => {
                const basicDialogResponse = new DialogResponse();
                const dataControl = new GlobalClass.DataControl();
                dataControl.copyValuesFrom(resp, basicDialogResponse);
                return basicDialogResponse;
            }));
        }
        /** It accepts list of custom buttons */
        setButtons(_Buttons) {
            this.dialogCarrier.setButtons(_Buttons);
        }
        setCustomData(_CustomData) {
            this.dialogCarrier.setCustomData(_CustomData);
        }
        setConfig(_DialogConfig) {
            this.dialogCarrier.setConfig(_DialogConfig);
        }
    }
    DialogClass.DialogInitializer = DialogInitializer;
    class DialogResponse extends GlobalClass.DataControl {
        constructor() {
            super();
            // private Response: DialogPrepareResponse            = new DialogPrepareResponse();
            this.Payload = null;
            this.Success = null;
            this.ClickedButtonID = null;
        }
        /**
         * @ignore
         */
        setPayload(_Payload) {
            this.Payload = _Payload;
        }
        /**
         * @ignore
         */
        setSuccess(_IsSuccess) {
            this.Success = _IsSuccess;
        }
        /**
         * @ignore
         */
        setClickedButtonID(_ClickedButtonID) {
            this.ClickedButtonID = _ClickedButtonID;
        }
    }
    DialogClass.DialogResponse = DialogResponse;
    class DialogEventsController {
        constructor(EntityUniqueID) {
            this.EntityUniqueID = EntityUniqueID;
            this._afterClosed = new Subject();
            this.afterClosed$ = this._afterClosed.asObservable();
            this._afterLoader = new Subject();
            this.afterLoader$ = this._afterLoader.asObservable();
            this._onButtonClick = new Subject();
            this.onButtonClick$ = this._onButtonClick.asObservable();
            this._buttonList = new Subject();
            this.buttonList$ = this._buttonList.asObservable();
        }
        close(_Response) {
            const response = _Response ? _Response : this.defaultResponse;
            this._afterClosed.next(response);
        }
        onButtonClick(_Button) {
            this.defaultResponse.setClickedButtonID(_Button.ID);
            this._onButtonClick.next(_Button);
        }
        setButtonList(_ButtonList) {
            this._buttonList.next(_ButtonList);
        }
        closeLoader() {
            setTimeout(() => {
                this._afterLoader.next(this.EntityUniqueID);
            }, 0);
        }
        setDefaultResponse(_Response) {
            this.defaultResponse = _Response;
        }
    }
    DialogClass.DialogEventsController = DialogEventsController;
    // endregion
    class DialogDefaultResponse extends DialogResponse {
        constructor() {
            super();
            this.DialogBelonging = null;
        }
        setBelonging(_DialogBelonging) {
            this.DialogBelonging = _DialogBelonging;
        }
    }
    DialogClass.DialogDefaultResponse = DialogDefaultResponse;
    class DialogCarrier {
        constructor() {
            this.dialogBelonging = new DialogBelonging();
        }
        setComponent(_Component) {
            this.component = _Component;
        }
        setButtons(_Buttons) {
            if (_Buttons.length) {
                this.dialogBelonging.Buttons = _Buttons;
            }
        }
        setCustomData(_CustomData) {
            this.dialogBelonging.CustomData = _CustomData;
        }
        setConfig(_DialogConfig) {
            // region *** local UserConfig (defined on place where dialog is called) ***
            const dataControl = new GlobalClass.DataControl();
            dataControl.copyValuesFrom(_DialogConfig, this.dialogBelonging.DialogCoreConfig);
            // endregion
        }
        openDialog$() {
            const service = ServiceLocator.injector.get(DialogService);
            const dialogController = service.open(this.component, this.dialogBelonging);
            return dialogController.afterClosed$;
        }
    }
    DialogClass.DialogCarrier = DialogCarrier;
    class DialogCoreConfig {
        constructor() {
            this.Width = null;
            this.Height = null;
            this.ButtonPosition = null;
            this.LayoutType = null;
            this.DisplayLoader = null;
            this.LoaderComponent = null;
        }
    }
    DialogClass.DialogCoreConfig = DialogCoreConfig;
    class DialogSettings {
        constructor() {
            this.Buttons = [];
            this.DialogCoreConfig = new DialogCoreConfig();
        }
    }
    DialogClass.DialogSettings = DialogSettings;
    class DialogBelonging extends DialogSettings {
        constructor() {
            super();
            /** @internal */
            this.EntityUniqueID = 'D' + Math.random().toString(36).substr(2, 9);
            this.CustomData = null;
            this.EventsController = new DialogEventsController(this.EntityUniqueID);
            const dialogConfigurator = ServiceLocator.injector.get(DialogConfigService);
            const baseSettings = new DialogSettings();
            const dataControl = new GlobalClass.DataControl();
            dataControl.copyValuesFrom(dialogConfigurator.productionConfig.DialogCoreConfig, baseSettings.DialogCoreConfig);
            this.DialogCoreConfig = baseSettings.DialogCoreConfig;
            this.Buttons = dialogConfigurator.productionConfig.Buttons.slice();
        }
    }
    DialogClass.DialogBelonging = DialogBelonging;
})(DialogClass || (DialogClass = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9uZ3gtYXdlc29tZS1wb3B1cC90eXBlcy9kaWFsb2cvY29yZS9tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWEsT0FBTyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBRXpDLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUN4RCxPQUFPLEVBQUMsbUJBQW1CLEVBQUMsTUFBTSx5QkFBeUIsQ0FBQztBQUU1RCxPQUFPLEVBQUMsR0FBRyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDbkMsT0FBTyxFQUFDLFdBQVcsRUFBa0IsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRSxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sa0JBQWtCLENBQUM7QUEwRS9DLE1BQU0sS0FBVyxXQUFXLENBdU0zQjtBQXZNRCxXQUFpQixXQUFXO0lBRXhCLHdCQUF3QjtJQUV4QixNQUFhLGlCQUFpQjtRQUkxQixZQUFvQixTQUFvQjtZQUFwQixjQUFTLEdBQVQsU0FBUyxDQUFXO1lBRmhDLGtCQUFhLEdBQWtCLElBQUksV0FBVyxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBR25FLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNwRCxDQUFDO1FBQ0QsMEVBQTBFO1FBQzFFLFdBQVc7WUFDUCxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRTtnQkFDcEQsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO2dCQUNqRCxNQUFNLFdBQVcsR0FBVyxJQUFJLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDMUQsV0FBVyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztn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QUM5RSxXQUFXLENBQUMsY0FBYyxDQUFDLGtCQUFrQixDQUFDLGdCQUFnQixDQUFDLGdCQUFnQixFQUFFLFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBQ2hILElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxZQUFZLENBQUMsZ0JBQWdCLENBQUM7WUFDdEQsSUFBSSxDQUFDLE9BQU8sR0FBWSxrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDaEYsQ0FBQztLQUVKO0lBbkJZLDJCQUFlLGtCQW1CM0IsQ0FBQTtBQUNMLENBQUMsRUF2TWdCLFdBQVcsS0FBWCxXQUFXLFFBdU0zQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7T2JzZXJ2YWJsZSwgU3ViamVjdH0gZnJvbSAncnhqcyc7XG5pbXBvcnQge1R5cGV9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtTZXJ2aWNlTG9jYXRvcn0gZnJvbSAnLi4vLi4vLi4vbG9jYXRvci5zZXJ2aWNlJztcbmltcG9ydCB7RGlhbG9nQ29uZmlnU2VydmljZX0gZnJvbSAnLi9kaWFsb2ctY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHtEaWFsb2dMYXlvdXREaXNwbGF5LCBWZXJ0aWNhbFBvc2l0aW9ufSBmcm9tICcuLi8uLi8uLi9jb3JlL2VudW1zJztcbmltcG9ydCB7bWFwfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge0dsb2JhbENsYXNzLCBHbG9iYWxJbnRlcmZhY2V9IGZyb20gJy4uLy4uLy4uL2NvcmUvZ2xvYmFsJztcbmltcG9ydCB7RGlhbG9nU2VydmljZX0gZnJvbSAnLi9kaWFsb2cuc2VydmljZSc7XG5cbmV4cG9ydCBuYW1lc3BhY2UgRGlhbG9nSW50ZXJmYWNlIHtcbiAgICBcbiAgICAvKipcbiAgICAgKiBDaGVjayBpbnRlcmZhY2Ugb2YgcHJvcGVydGllcy5cbiAgICAgKi9cbiAgICBleHBvcnQgaW50ZXJmYWNlIElEaWFsb2dVc2VyQ29uZmlnIHtcbiAgICAgICAgQnV0dG9ucz86IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW107XG4gICAgICAgIERpYWxvZ0NvcmVDb25maWc/OiBEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ0NvcmVDb25maWc7XG4gICAgfVxuICAgIFxuICAgIC8qKlxuICAgICAqIE9wdGlvbmFsIHVzZXIgY29uZmlndXJhdGlvbi5cbiAgICAgKlxuICAgICAqIEV4YW1wbGU6XG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIC8vIERpYWxvZyBjb3JlIGNvbmZpZyBvYmplY3QgZXhhbXBsZS5cbiAgICAgKiBjb25zdCBkaWFsb2dDb3JlQ29uZmlnID0ge1xuICAgICAqICAgICBEaWFsb2dDb3JlQ29uZmlnOiB7XG4gICAgICogICAgICAgIFdpZHRoICAgICAgICAgOiAnNTAwcHgnLFxuICAgICAqICAgICAgICBIZWlnaHQgICAgICAgIDogJzUwMHB4JyxcbiAgICAgKiAgICAgICAgQnV0dG9uUG9zaXRpb246ICdyaWdodCcsXG4gICAgICogICAgICAgIExheW91dFR5cGU6IERpYWxvZ0xheW91dERpc3BsYXkuSU5GTyxcbiAgICAgKiAgICAgICAgTG9hZGVyQ29tcG9uZW50OiAvLyBBbnkgQW5ndWxhciBjb21wb25lbnQgY2xhc3MgbmFtZSBjYW4gYmUgaW5jbHVkZWQgYXMgYSBsb2FkZXIuXG4gICAgICogICAgICAgIERpc3BsYXlMb2FkZXI6IGZhbHNlIC8vIFRoaXMgd2lsbCBvdmVycmlkZSBMb2FkZXJDb21wb25lbnQuXG4gICAgICogICAgIH1cbiAgICAgKiAgfVxuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGV4cG9ydCBpbnRlcmZhY2UgSURpYWxvZ0NvcmVDb25maWcge1xuICAgICAgICAvKiogRml4ZWQgcG9wdXAgd2lkdGggKi9cbiAgICAgICAgV2lkdGg/OiBzdHJpbmc7XG4gICAgICAgIC8qKiBGaXhlZCBwb3B1cCBoZWlnaHQgKi9cbiAgICAgICAgSGVpZ2h0Pzogc3RyaW5nO1xuICAgICAgICBCdXR0b25Qb3NpdGlvbj86IFZlcnRpY2FsUG9zaXRpb247XG4gICAgICAgIExheW91dFR5cGU/OiBEaWFsb2dMYXlvdXREaXNwbGF5O1xuICAgICAgICBEaXNwbGF5TG9hZGVyPzogYm9vbGVhbjtcbiAgICAgICAgTG9hZGVyQ29tcG9uZW50PzogVHlwZTxhbnk+O1xuICAgIH1cbiAgICBcbiAgICBleHBvcnQgaW50ZXJmYWNlIElEaWFsb2dCZWxvbmdpbmcge1xuICAgICAgICBCdXR0b25zOiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdO1xuICAgICAgICBEaWFsb2dDb3JlQ29uZmlnOiBEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ0NvcmVDb25maWc7XG4gICAgICAgIEVudGl0eVVuaXF1ZUlEOiBzdHJpbmc7XG4gICAgICAgIEN1c3RvbURhdGE6IGFueTtcbiAgICAgICAgRXZlbnRzQ29udHJvbGxlcjogRGlhbG9nQ2xhc3MuRGlhbG9nRXZlbnRzQ29udHJvbGxlcjtcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGludGVyZmFjZSBJRGlhbG9nUmVzcG9uc2Uge1xuICAgICAgICBcbiAgICAgICAgc2V0UGF5bG9hZChfUGF5bG9hZDogYW55KTogdm9pZDtcbiAgICAgICAgXG4gICAgICAgIHNldFN1Y2Nlc3MoX0lzU3VjY2VzczogYm9vbGVhbik6IHZvaWQ7XG4gICAgICAgIFxuICAgICAgICBzZXRDbGlja2VkQnV0dG9uSUQoX0NsaWNrZWRCdXR0b25JRCk6IHZvaWQ7XG4gICAgICAgIFxuICAgIH1cbiAgICBcbiAgICBleHBvcnQgaW50ZXJmYWNlIElEaWFsb2dQdWJsaWNSZXNwb25zZTxSZXNwb25zZVBheWxvYWQ+IHtcbiAgICAgICAgLyoqIEdlbmVyaWMgcHJvcGVydHkgdHlwZSwgYWNjZXB0IGV4cGVjdGVkIHBheWxvYWQgZnJvbSBkeW5hbWljIGNoaWxkIGNvbXBvbmVudC4gKi9cbiAgICAgICAgUGF5bG9hZDogUmVzcG9uc2VQYXlsb2FkO1xuICAgICAgICBTdWNjZXNzOiBib29sZWFuO1xuICAgICAgICBDbGlja2VkQnV0dG9uSUQ6IHN0cmluZ1xuICAgIH1cbiAgICBcbiAgICBleHBvcnQgaW50ZXJmYWNlIElQcml2YXRlUmVzcG9uc2VNZXJnZWQgZXh0ZW5kcyBJRGlhbG9nUmVzcG9uc2UsIEdsb2JhbEludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlIHtcbiAgICAgICAgXG4gICAgICAgIERpYWxvZ0JlbG9uZ2luZzogRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dCZWxvbmdpbmc7XG4gICAgfVxuICAgIFxuICAgIFxufVxuXG5leHBvcnQgbmFtZXNwYWNlIERpYWxvZ0NsYXNzIHtcbiAgICBcbiAgICAvLyByZWdpb24gKioqIFB1YmxpYyAqKipcbiAgICBcbiAgICBleHBvcnQgY2xhc3MgRGlhbG9nSW5pdGlhbGl6ZXIge1xuICAgICAgICBcbiAgICAgICAgcHJpdmF0ZSBkaWFsb2dDYXJyaWVyOiBEaWFsb2dDYXJyaWVyID0gbmV3IERpYWxvZ0NsYXNzLkRpYWxvZ0NhcnJpZXIoKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgY29tcG9uZW50OiBUeXBlPGFueT4pIHtcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nQ2Fycmllci5zZXRDb21wb25lbnQodGhpcy5jb21wb25lbnQpO1xuICAgICAgICB9XG4gICAgICAgIC8qKiBHZW5lcmljIG1ldGhvZCBhY2NlcHQgZXhwZWN0ZWQgcGF5bG9hZCBmcm9tIGR5bmFtaWMgY2hpbGQgY29tcG9uZW50LiovXG4gICAgICAgIG9wZW5EaWFsb2ckPFJlc3BvbnNlUGF5bG9hZCA9IGFueT4oKTogT2JzZXJ2YWJsZTxEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ1B1YmxpY1Jlc3BvbnNlPFJlc3BvbnNlUGF5bG9hZD4+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRpYWxvZ0NhcnJpZXIub3BlbkRpYWxvZyQoKS5waXBlKG1hcChyZXNwID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBiYXNpY0RpYWxvZ1Jlc3BvbnNlID0gbmV3IERpYWxvZ1Jlc3BvbnNlKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YUNvbnRyb2wgICAgICAgICA9IG5ldyBHbG9iYWxDbGFzcy5EYXRhQ29udHJvbCgpO1xuICAgICAgICAgICAgICAgIGRhdGFDb250cm9sLmNvcHlWYWx1ZXNGcm9tKHJlc3AsIGJhc2ljRGlhbG9nUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybiBiYXNpY0RpYWxvZ1Jlc3BvbnNlO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvKiogSXQgYWNjZXB0cyBsaXN0IG9mIGN1c3RvbSBidXR0b25zICovXG4gICAgICAgIHNldEJ1dHRvbnMoX0J1dHRvbnM6IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10pOiB2b2lkIHtcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nQ2Fycmllci5zZXRCdXR0b25zKF9CdXR0b25zKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgc2V0Q3VzdG9tRGF0YShfQ3VzdG9tRGF0YTogYW55KSB7XG4gICAgICAgICAgICB0aGlzLmRpYWxvZ0NhcnJpZXIuc2V0Q3VzdG9tRGF0YShfQ3VzdG9tRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldENvbmZpZyhfRGlhbG9nQ29uZmlnOiBEaWFsb2dJbnRlcmZhY2UuSURpYWxvZ0NvcmVDb25maWcpIHtcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nQ2Fycmllci5zZXRDb25maWcoX0RpYWxvZ0NvbmZpZyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBEaWFsb2dSZXNwb25zZSBleHRlbmRzIEdsb2JhbENsYXNzLkRhdGFDb250cm9sIGltcGxlbWVudHMgRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dSZXNwb25zZSwgRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dQdWJsaWNSZXNwb25zZTxhbnk+IHtcbiAgICAgICAgLy8gcHJpdmF0ZSBSZXNwb25zZTogRGlhbG9nUHJlcGFyZVJlc3BvbnNlICAgICAgICAgICAgPSBuZXcgRGlhbG9nUHJlcGFyZVJlc3BvbnNlKCk7XG4gICAgICAgIFxuICAgICAgICBQYXlsb2FkOiBhbnkgPSBudWxsO1xuICAgICAgICBTdWNjZXNzOiBib29sZWFuICAgICAgICAgPSBudWxsO1xuICAgICAgICBDbGlja2VkQnV0dG9uSUQ6IHN0cmluZyAgPSBudWxsO1xuICAgICAgICBcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgICAgICBzdXBlcigpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvKipcbiAgICAgICAgICogQGlnbm9yZVxuICAgICAgICAgKi9cbiAgICAgICAgc2V0UGF5bG9hZChfUGF5bG9hZDogYW55KTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLlBheWxvYWQgPSBfUGF5bG9hZDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBpZ25vcmVcbiAgICAgICAgICovXG4gICAgICAgIHNldFN1Y2Nlc3MoX0lzU3VjY2VzczogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICAgICAgdGhpcy5TdWNjZXNzID0gX0lzU3VjY2VzcztcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBpZ25vcmVcbiAgICAgICAgICovXG4gICAgICAgIHNldENsaWNrZWRCdXR0b25JRChfQ2xpY2tlZEJ1dHRvbklEKTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLkNsaWNrZWRCdXR0b25JRCA9IF9DbGlja2VkQnV0dG9uSUQ7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBEaWFsb2dFdmVudHNDb250cm9sbGVyIHtcbiAgICAgICAgXG4gICAgICAgIGRlZmF1bHRSZXNwb25zZTogRGlhbG9nSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQ7XG4gICAgICAgIFxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IF9hZnRlckNsb3NlZDogU3ViamVjdDxEaWFsb2dJbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZD4gPSBuZXcgU3ViamVjdDxEaWFsb2dJbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZD4oKTtcbiAgICAgICAgYWZ0ZXJDbG9zZWQkOiBPYnNlcnZhYmxlPERpYWxvZ0ludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkPiAgICAgICAgICAgICAgID0gdGhpcy5fYWZ0ZXJDbG9zZWQuYXNPYnNlcnZhYmxlKCk7XG4gICAgICAgIFxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IF9hZnRlckxvYWRlcjogYW55ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IG5ldyBTdWJqZWN0PHN0cmluZz4oKTtcbiAgICAgICAgYWZ0ZXJMb2FkZXIkOiBPYnNlcnZhYmxlPHN0cmluZz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPSB0aGlzLl9hZnRlckxvYWRlci5hc09ic2VydmFibGUoKTtcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBfb25CdXR0b25DbGljazogU3ViamVjdDxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbj4gPSBuZXcgU3ViamVjdDxHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbj4oKTtcbiAgICAgICAgb25CdXR0b25DbGljayQ6IE9ic2VydmFibGU8R2xvYmFsSW50ZXJmYWNlLklCdXR0b24+ICAgICAgICAgICAgICAgPSB0aGlzLl9vbkJ1dHRvbkNsaWNrLmFzT2JzZXJ2YWJsZSgpO1xuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IF9idXR0b25MaXN0OiBTdWJqZWN0PEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10+ICA9IG5ldyBTdWJqZWN0PEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10+KCk7XG4gICAgICAgIGJ1dHRvbkxpc3QkOiBPYnNlcnZhYmxlPEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10+ICAgICAgICAgICAgICAgID0gdGhpcy5fYnV0dG9uTGlzdC5hc09ic2VydmFibGUoKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgRW50aXR5VW5pcXVlSUQ6IHN0cmluZykge1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjbG9zZShfUmVzcG9uc2U/OiBEaWFsb2dJbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZCk6IHZvaWQge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBfUmVzcG9uc2UgPyBfUmVzcG9uc2UgOiB0aGlzLmRlZmF1bHRSZXNwb25zZTtcbiAgICAgICAgICAgIHRoaXMuX2FmdGVyQ2xvc2VkLm5leHQocmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBvbkJ1dHRvbkNsaWNrKF9CdXR0b246IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uKTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRSZXNwb25zZS5zZXRDbGlja2VkQnV0dG9uSUQoX0J1dHRvbi5JRCk7XG4gICAgICAgICAgICB0aGlzLl9vbkJ1dHRvbkNsaWNrLm5leHQoX0J1dHRvbik7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldEJ1dHRvbkxpc3QoX0J1dHRvbkxpc3Q6IEdsb2JhbEludGVyZmFjZS5JQnV0dG9uW10pOiB2b2lkIHtcbiAgICAgICAgICAgIHRoaXMuX2J1dHRvbkxpc3QubmV4dChfQnV0dG9uTGlzdCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNsb3NlTG9hZGVyKCk6IHZvaWQge1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYWZ0ZXJMb2FkZXIubmV4dCh0aGlzLkVudGl0eVVuaXF1ZUlEKTtcbiAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNldERlZmF1bHRSZXNwb25zZShfUmVzcG9uc2U6IERpYWxvZ0ludGVyZmFjZS5JUHJpdmF0ZVJlc3BvbnNlTWVyZ2VkKTogdm9pZCB7XG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRSZXNwb25zZSA9IF9SZXNwb25zZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBlbmRyZWdpb25cbiAgICBcbiAgICBleHBvcnQgY2xhc3MgRGlhbG9nRGVmYXVsdFJlc3BvbnNlIGV4dGVuZHMgRGlhbG9nUmVzcG9uc2UgaW1wbGVtZW50cyBEaWFsb2dJbnRlcmZhY2UuSVByaXZhdGVSZXNwb25zZU1lcmdlZCB7XG4gICAgICAgIERpYWxvZ0JlbG9uZ2luZzogRGlhbG9nQmVsb25naW5nID0gbnVsbDtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgc2V0QmVsb25naW5nKF9EaWFsb2dCZWxvbmdpbmcpOiB2b2lkIHtcbiAgICAgICAgICAgIHRoaXMuRGlhbG9nQmVsb25naW5nID0gX0RpYWxvZ0JlbG9uZ2luZztcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGNsYXNzIERpYWxvZ0NhcnJpZXIge1xuICAgICAgICBcbiAgICAgICAgZGlhbG9nQmVsb25naW5nOiBEaWFsb2dCZWxvbmdpbmcgPSBuZXcgRGlhbG9nQmVsb25naW5nKCk7XG4gICAgICAgIHByaXZhdGUgY29tcG9uZW50OiBUeXBlPGFueT47XG4gICAgICAgIFxuICAgICAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgc2V0Q29tcG9uZW50KF9Db21wb25lbnQ6IFR5cGU8YW55Pik6IHZvaWQge1xuICAgICAgICAgICAgdGhpcy5jb21wb25lbnQgPSBfQ29tcG9uZW50O1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBzZXRCdXR0b25zKF9CdXR0b25zOiBHbG9iYWxJbnRlcmZhY2UuSUJ1dHRvbltdKSB7XG4gICAgICAgICAgICBpZiAoX0J1dHRvbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaWFsb2dCZWxvbmdpbmcuQnV0dG9ucyA9IF9CdXR0b25zO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBzZXRDdXN0b21EYXRhKF9DdXN0b21EYXRhOiBhbnkpIHtcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nQmVsb25naW5nLkN1c3RvbURhdGEgPSBfQ3VzdG9tRGF0YTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgc2V0Q29uZmlnKF9EaWFsb2dDb25maWc6IERpYWxvZ0ludGVyZmFjZS5JRGlhbG9nQ29yZUNvbmZpZykge1xuICAgICAgICAgICAgLy8gcmVnaW9uICoqKiBsb2NhbCBVc2VyQ29uZmlnIChkZWZpbmVkIG9uIHBsYWNlIHdoZXJlIGRpYWxvZyBpcyBjYWxsZWQpICoqKlxuICAgICAgICAgICAgY29uc3QgZGF0YUNvbnRyb2wgPSBuZXcgR2xvYmFsQ2xhc3MuRGF0YUNvbnRyb2woKTtcbiAgICAgICAgICAgIGRhdGFDb250cm9sLmNvcHlWYWx1ZXNGcm9tKF9EaWFsb2dDb25maWcsIHRoaXMuZGlhbG9nQmVsb25naW5nLkRpYWxvZ0NvcmVDb25maWcpO1xuICAgICAgICAgICAgLy8gZW5kcmVnaW9uXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIG9wZW5EaWFsb2ckKCk6IE9ic2VydmFibGU8RGlhbG9nSW50ZXJmYWNlLklQcml2YXRlUmVzcG9uc2VNZXJnZWQ+IHtcbiAgICAgICAgICAgIGNvbnN0IHNlcnZpY2U6IERpYWxvZ1NlcnZpY2UgPSBTZXJ2aWNlTG9jYXRvci5pbmplY3Rvci5nZXQoRGlhbG9nU2VydmljZSk7XG4gICAgICAgICAgICBjb25zdCBkaWFsb2dDb250cm9sbGVyICAgICAgID0gc2VydmljZS5vcGVuKHRoaXMuY29tcG9uZW50LCB0aGlzLmRpYWxvZ0JlbG9uZ2luZyk7XG4gICAgICAgICAgICByZXR1cm4gZGlhbG9nQ29udHJvbGxlci5hZnRlckNsb3NlZCQ7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBEaWFsb2dDb3JlQ29uZmlnIGltcGxlbWVudHMgRGlhbG9nSW50ZXJmYWNlLklEaWFsb2dDb3JlQ29uZmlnIHtcbiAgICAgICAgV2lkdGg6IHN0cmluZyAgICAgICAgICAgICAgICAgICAgPSBudWxsO1xuICAgICAgICBIZWlnaHQ6IHN0cmluZyAgICAgICAgICAgICAgICAgICA9IG51bGw7XG4gICAgICAgIEJ1dHRvblBvc2l0aW9uOiBWZXJ0aWNhbFBvc2l0aW9uID0gbnVsbDtcbiAgICAgICAgTGF5b3V0VHlwZTogRGlhbG9nTGF5b3V0RGlzcGxheSAgPSBudWxsO1xuICAgICAgICBEaXNwbGF5TG9hZGVyOiBib29sZWFuICAgICAgICAgICA9IG51bGw7XG4gICAgICAgIExvYWRlckNvbXBvbmVudDogVHlwZTxhbnk+ICAgICAgID0gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgZXhwb3J0IGNsYXNzIERpYWxvZ1NldHRpbmdzIHtcbiAgICAgICAgQnV0dG9uczogR2xvYmFsSW50ZXJmYWNlLklCdXR0b25bXSAgICAgICAgICAgICAgICAgID0gW107XG4gICAgICAgIERpYWxvZ0NvcmVDb25maWc6IERpYWxvZ0ludGVyZmFjZS5JRGlhbG9nQ29yZUNvbmZpZyA9IG5ldyBEaWFsb2dDb3JlQ29uZmlnKCk7XG4gICAgfVxuICAgIFxuICAgIGV4cG9ydCBjbGFzcyBEaWFsb2dCZWxvbmdpbmc8Q3VzdG9tRGF0YSA9IGFueT4gZXh0ZW5kcyBEaWFsb2dTZXR0aW5ncyBpbXBsZW1lbnRzIERpYWxvZ0ludGVyZmFjZS5JRGlhbG9nQmVsb25naW5nIHtcbiAgICAgICAgXG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgRW50aXR5VW5pcXVlSUQ6IHN0cmluZyA9ICdEJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KTtcbiAgICAgICAgXG4gICAgICAgIEN1c3RvbURhdGE6IEN1c3RvbURhdGEgPSBudWxsO1xuICAgICAgICBFdmVudHNDb250cm9sbGVyOiBEaWFsb2dFdmVudHNDb250cm9sbGVyO1xuICAgICAgICBcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgICAgICBzdXBlcigpO1xuICAgICAgICAgICAgdGhpcy5FdmVudHNDb250cm9sbGVyICAgICAgICAgICAgICAgICAgICAgICAgID0gbmV3IERpYWxvZ0V2ZW50c0NvbnRyb2xsZXIodGhpcy5FbnRpdHlVbmlxdWVJRCk7XG4gICAgICAgICAgICBjb25zdCBkaWFsb2dDb25maWd1cmF0b3I6IERpYWxvZ0NvbmZpZ1NlcnZpY2UgPSBTZXJ2aWNlTG9jYXRvci5pbmplY3Rvci5nZXQoRGlhbG9nQ29uZmlnU2VydmljZSk7XG4gICAgICAgICAgICBjb25zdCBiYXNlU2V0dGluZ3MgICAgICAgICAgICAgICAgICAgICAgICAgICAgPSBuZXcgRGlhbG9nU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIGNvbnN0IGRhdGFDb250cm9sICAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IG5ldyBHbG9iYWxDbGFzcy5EYXRhQ29udHJvbCgpO1xuICAgICAgICAgICAgZGF0YUNvbnRyb2wuY29weVZhbHVlc0Zyb20oZGlhbG9nQ29uZmlndXJhdG9yLnByb2R1Y3Rpb25Db25maWcuRGlhbG9nQ29yZUNvbmZpZywgYmFzZVNldHRpbmdzLkRpYWxvZ0NvcmVDb25maWcpO1xuICAgICAgICAgICAgdGhpcy5EaWFsb2dDb3JlQ29uZmlnID0gYmFzZVNldHRpbmdzLkRpYWxvZ0NvcmVDb25maWc7XG4gICAgICAgICAgICB0aGlzLkJ1dHRvbnMgICAgICAgICAgPSBkaWFsb2dDb25maWd1cmF0b3IucHJvZHVjdGlvbkNvbmZpZy5CdXR0b25zLnNsaWNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxufVxuXG5cblxuIl19